{
    "url": "https://api.github.com/repos/dask/dask/issues/6956",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/6956/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/6956/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/6956/events",
    "html_url": "https://github.com/dask/dask/issues/6956",
    "id": 762291307,
    "node_id": "MDU6SXNzdWU3NjIyOTEzMDc=",
    "number": 6956,
    "title": "Dask worker tasks allocation",
    "user": {
        "login": "ben10he",
        "id": 31155357,
        "node_id": "MDQ6VXNlcjMxMTU1MzU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31155357?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ben10he",
        "html_url": "https://github.com/ben10he",
        "followers_url": "https://api.github.com/users/ben10he/followers",
        "following_url": "https://api.github.com/users/ben10he/following{/other_user}",
        "gists_url": "https://api.github.com/users/ben10he/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ben10he/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ben10he/subscriptions",
        "organizations_url": "https://api.github.com/users/ben10he/orgs",
        "repos_url": "https://api.github.com/users/ben10he/repos",
        "events_url": "https://api.github.com/users/ben10he/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ben10he/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 1342320181,
            "node_id": "MDU6TGFiZWwxMzQyMzIwMTgx",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20info",
            "name": "needs info",
            "color": "d0cfcc",
            "default": false,
            "description": "Needs further information from the user"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2020-12-11T12:17:01Z",
    "updated_at": "2021-08-11T22:04:44Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "By default, looks like dask would distribute tasks at the time when they are submitted. If we have a task run time depends on input and some input may cause the task run much longer than other, we may end up with all long running tasks assigned to one worker. Here is an example to illustrate the issue: \r\n\r\n```\r\nimport time\r\nfrom distributed import Client, wait\r\n\r\n\r\ndef uneven_task(num):\r\n    \"\"\"If num is odd number, it will take much longer to complete\"\"\"\r\n    print(f\"Running task {num}\")\r\n    if num % 2 != 0:\r\n        time.sleep(num*100)\r\n    print(f\"Task {num} has finished. Worker is free.\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    client = Client(address=\"xx.xxx.xx.xx:8786\")\r\n    futures = []\r\n    for i in range(10):\r\n        future = client.submit(uneven_task, i, priority=1)\r\n        futures.append(future)\r\n\r\n    wait(futures)\r\n```\r\n2 workers started. 10 tasks submitted. Odd number input will lead to a long task, but even number task will be quick. I can see all 5 short tasks allocate to one worker and the other 5 long running tasks all allocate to the other workers. \r\n![image](https://user-images.githubusercontent.com/31155357/101902515-aeea4580-3baa-11eb-8f41-0a2463023fa0.png)\r\n\r\nIs there any way we can config dask only assign task when worker is free instead of allocate them at the time when tasks are submitted?",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/6956/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/6956/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}