{
    "url": "https://api.github.com/repos/dask/dask/issues/5361",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/5361/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/5361/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/5361/events",
    "html_url": "https://github.com/dask/dask/issues/5361",
    "id": 488705404,
    "node_id": "MDU6SXNzdWU0ODg3MDU0MDQ=",
    "number": 5361,
    "title": "Filesystem transactions",
    "user": {
        "login": "martindurant",
        "id": 6042212,
        "node_id": "MDQ6VXNlcjYwNDIyMTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6042212?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martindurant",
        "html_url": "https://github.com/martindurant",
        "followers_url": "https://api.github.com/users/martindurant/followers",
        "following_url": "https://api.github.com/users/martindurant/following{/other_user}",
        "gists_url": "https://api.github.com/users/martindurant/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/martindurant/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/martindurant/subscriptions",
        "organizations_url": "https://api.github.com/users/martindurant/orgs",
        "repos_url": "https://api.github.com/users/martindurant/repos",
        "events_url": "https://api.github.com/users/martindurant/events{/privacy}",
        "received_events_url": "https://api.github.com/users/martindurant/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 365513534,
            "node_id": "MDU6TGFiZWwzNjU1MTM1MzQ=",
            "url": "https://api.github.com/repos/dask/dask/labels/io",
            "name": "io",
            "color": "6f871c",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2019-09-03T16:27:50Z",
    "updated_at": "2021-10-13T02:09:41Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "Right now, Dask uses the various implementations of fsspec for writing. Since each task writes one file, the creation of any chunks on a remote server and finalising of the file happen serially in a single thread. However, if there is an exception, then finalising should happen anyway, resulting in partial content (as you would expect when writing to a local file too). This happens upon `del`, so it's timing cannot be guaranteed. \r\n\r\nIf there are retries, this should then be over-written, but I can imagine that with the eventual-consistency of S3/GCS, you are not guaranteed as to which version you end up with. The existing transactions mechanism in fsspec could be used to prevent automatically committing whatever was written, but requires some coordination. An additional wrinkle, is that filesystem instances persist, and are shared between threads. \r\n\r\nDask (and fsspec users in general) would like to have more guarantees about the state of writing, and the ability to commit/discard whole sets of files across a cluster, as well as, ideally, verification that writes/retries did indeed succeed. Also, it might be nice to distribute filesystem configuration globally.",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/5361/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/5361/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}