{
    "url": "https://api.github.com/repos/dask/dask/issues/4763",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/4763/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/4763/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/4763/events",
    "html_url": "https://github.com/dask/dask/issues/4763",
    "id": 439023501,
    "node_id": "MDU6SXNzdWU0MzkwMjM1MDE=",
    "number": 4763,
    "title": "Rechunk in unify_chunks",
    "user": {
        "login": "mrocklin",
        "id": 306380,
        "node_id": "MDQ6VXNlcjMwNjM4MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mrocklin",
        "html_url": "https://github.com/mrocklin",
        "followers_url": "https://api.github.com/users/mrocklin/followers",
        "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
        "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
        "organizations_url": "https://api.github.com/users/mrocklin/orgs",
        "repos_url": "https://api.github.com/users/mrocklin/repos",
        "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mrocklin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862305,
            "node_id": "MDU6TGFiZWwyNDI4NjIzMDU=",
            "url": "https://api.github.com/repos/dask/dask/labels/array",
            "name": "array",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2019-04-30T23:48:08Z",
    "updated_at": "2019-04-30T23:48:08Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "When multiple dask arrays with different chunking combine we need to align their chunks.  We do that today in the unify_chunks function.  \r\n\r\nWhen chunking is particularly out of alignment, we get many more output chunks than input chunks, triggering a warning to users:\r\n\r\n```python\r\nIn [1]: import dask.array as da\r\n\r\nIn [2]: x = da.ones((1000, 1000), chunks=(1000, 10))\r\n\r\nIn [3]: x + x.T\r\n/Users/mrocklin/workspace/dask/dask/array/core.py:3233: PerformanceWarning: Increasing number of chunks by factor of 100\r\n  **blockwise_kwargs)\r\nOut[3]: dask.array<add, shape=(1000, 1000), dtype=float64, chunksize=(10, 10)>\r\n```\r\n\r\nUnfortunately, this warning doesn't give users a good idea of how to change things.  Indeed, this function is used in enough places that it's often tricky to tell them which array to rechunk how.\r\n\r\nHowever, we might rechunk for them automatically in some naive way.  For example in the example above things would be better if we first rechunked to `(100, 100)`\r\n\r\n```python\r\nIn [4]: y = x.rechunk((100, 100))\r\n\r\nIn [5]: y + y.T\r\nOut[5]: dask.array<add, shape=(1000, 1000), dtype=float64, chunksize=(100, 100)>\r\n```\r\n\r\nThere is a larger conversation about auto-rechunking for particular operations in https://github.com/dask/dask/issues/3587 .  This might be a lower level stopgap for many operations, particularly those that rely on `blockwise` (previously called `atop`).\r\n\r\nMaybe we have enough information in `unify_chunks` to always improve the situation?  I'm not sure.  I haven't gotten too deeply into this problem.  \r\n\r\ncc @shoyer @birdsarah",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/4763/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/4763/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}