{
    "url": "https://api.github.com/repos/dask/dask/issues/10628",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/10628/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/10628/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/10628/events",
    "html_url": "https://github.com/dask/dask/issues/10628",
    "id": 1989330763,
    "node_id": "I_kwDOAbcwm852ksdL",
    "number": 10628,
    "title": "DataFrame.apply(meta=(None, 'object')) converts to pyarrow's string",
    "user": {
        "login": "idanhazan",
        "id": 19217750,
        "node_id": "MDQ6VXNlcjE5MjE3NzUw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19217750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/idanhazan",
        "html_url": "https://github.com/idanhazan",
        "followers_url": "https://api.github.com/users/idanhazan/followers",
        "following_url": "https://api.github.com/users/idanhazan/following{/other_user}",
        "gists_url": "https://api.github.com/users/idanhazan/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/idanhazan/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/idanhazan/subscriptions",
        "organizations_url": "https://api.github.com/users/idanhazan/orgs",
        "repos_url": "https://api.github.com/users/idanhazan/repos",
        "events_url": "https://api.github.com/users/idanhazan/events{/privacy}",
        "received_events_url": "https://api.github.com/users/idanhazan/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 3468123446,
            "node_id": "LA_kwDOAbcwm87Ot102",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20attention",
            "name": "needs attention",
            "color": "6d626c",
            "default": false,
            "description": "It's been a while since this was pushed on. Needs attention from the owner or a maintainer."
        },
        {
            "id": 3798450413,
            "node_id": "LA_kwDOAbcwm87iZ8Dt",
            "url": "https://api.github.com/repos/dask/dask/labels/bug",
            "name": "bug",
            "color": "faadaf",
            "default": true,
            "description": "Something is broken"
        },
        {
            "id": 6137710172,
            "node_id": "LA_kwDOAbcwm88AAAABbdYGXA",
            "url": "https://api.github.com/repos/dask/dask/labels/convert-string",
            "name": "convert-string",
            "color": "d93f0b",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2023-11-12T09:56:23Z",
    "updated_at": "2024-01-19T15:08:20Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "**Describe the issue**:\r\n\r\nUsing `dask.dataframe.DataFrame.apply(..., meta=(None, 'object'), ...)` converts to pyarrow's string\r\n\r\n**Minimal Complete Verifiable Example**:\r\n\r\n```python\r\nimport dask.dataframe as dd\r\nimport pandas as pd\r\n\r\ndef as_tuple(series):\r\n    return series['int'], series['str'], series['datetime']\r\n\r\ndf = pd.DataFrame(\r\n    data={\r\n        'int': range(1, 4),\r\n        'str': list('ABC'),\r\n        'datetime': pd.date_range(start='2023-01-01', periods=3, freq='D')\r\n    },\r\n)\r\nddf = dd.from_pandas(data=df, npartitions=1)\r\n```\r\n```python\r\n>> df\r\n     int    str    datetime\r\n0    1      A      2023-01-01\r\n1    2      B      2023-01-02\r\n2    3      C      2023-01-03\r\n\r\n>> ddf\r\nDask DataFrame Structure:\r\n     int      str       datetime\r\nnpartitions=1\r\n0    int64    string    datetime64[ns]\r\n2    ...      ...       ...\r\nDask Name: to_pyarrow_string, 2 graph layers\r\n```\r\n\r\n```python\r\n>> df.apply(func=as_tuple, axis='columns')\r\n0    (1, A, 2023-01-01 00:00:00)\r\n1    (2, B, 2023-01-02 00:00:00)\r\n2    (3, C, 2023-01-03 00:00:00)\r\ndtype: object\r\n\r\n>> df.apply(func=as_tuple, axis='columns').dtype\r\ndtype('O')\r\n```\r\n```python\r\n>> ddf.apply(func=as_tuple, axis='columns', meta=(None, 'object'))\r\nDask Series Structure:\r\nnpartitions=1\r\n0    string\r\n2       ...\r\ndtype: string\r\nDask Name: to_pyarrow_string, 4 graph layers\r\n\r\n>> ddf.apply(func=as_tuple, axis='columns', meta=(None, 'object')).dtype\r\nstring[pyarrow]\r\n```\r\n```python\r\n>> ddf.apply(func=as_tuple, axis='columns', meta=(None, 'object')).compute()\r\n0    (1, 'A', Timestamp('2023-01-01 00:00:00'))\r\n1    (2, 'B', Timestamp('2023-01-02 00:00:00'))\r\n2    (3, 'C', Timestamp('2023-01-03 00:00:00'))\r\ndtype: string\r\n\r\n>> ddf.apply(func=as_tuple, axis='columns', meta=(None, 'object')).compute().dtype\r\nstring[pyarrow]\r\n```\r\n\r\n**Environment**:\r\n\r\n| Name                          | Version      | Build                 | Channel     |\r\n|:------------------------------|:-------------|:----------------------|:------------|\r\n| _libgcc_mutex                 | 0.1          | conda_forge           | conda-forge |\r\n| _openmp_mutex                 | 4.5          | 2_gnu                 | conda-forge |\r\n| asttokens                     | 2.4.1        | pyhd8ed1ab_0          | conda-forge |\r\n| aws-c-auth                    | 0.7.6        | h37ad1db_0            | conda-forge |\r\n| aws-c-cal                     | 0.6.9        | h3b91eb8_1            | conda-forge |\r\n| aws-c-common                  | 0.9.8        | hd590300_0            | conda-forge |\r\n| aws-c-compression             | 0.2.17       | hfd9eb17_6            | conda-forge |\r\n| aws-c-event-stream            | 0.3.2        | hae413d4_6            | conda-forge |\r\n| aws-c-http                    | 0.7.14       | h162056d_1            | conda-forge |\r\n| aws-c-io                      | 0.13.35      | hc23c90e_8            | conda-forge |\r\n| aws-c-mqtt                    | 0.9.9        | h1387108_0            | conda-forge |\r\n| aws-c-s3                      | 0.3.23       | h7630044_1            | conda-forge |\r\n| aws-c-sdkutils                | 0.1.12       | hfd9eb17_5            | conda-forge |\r\n| aws-checksums                 | 0.1.17       | hfd9eb17_5            | conda-forge |\r\n| aws-crt-cpp                   | 0.24.5       | h270613d_5            | conda-forge |\r\n| aws-sdk-cpp                   | 1.11.182     | h8df25a1_5            | conda-forge |\r\n| backports                     | 1.0          | pyhd8ed1ab_3          | conda-forge |\r\n| backports.functools_lru_cache | 1.6.5        | pyhd8ed1ab_0          | conda-forge |\r\n| bokeh                         | 3.3.1        | pyhd8ed1ab_0          | conda-forge |\r\n| boto3                         | 1.28.84      | pyhd8ed1ab_0          | conda-forge |\r\n| botocore                      | 1.31.84      | pyhd8ed1ab_0          | conda-forge |\r\n| bottleneck                    | 1.3.7        | py311h1f0f07a_1       | conda-forge |\r\n| brotli-python                 | 1.1.0        | py311hb755f60_1       | conda-forge |\r\n| bzip2                         | 1.0.8        | hd590300_5            | conda-forge |\r\n| c-ares                        | 1.21.0       | hd590300_0            | conda-forge |\r\n| ca-certificates               | 2023.7.22    | hbcca054_0            | conda-forge |\r\n| certifi                       | 2023.7.22    | pyhd8ed1ab_0          | conda-forge |\r\n| charset-normalizer            | 3.3.2        | pyhd8ed1ab_0          | conda-forge |\r\n| click                         | 8.1.7        | unix_pyh707e725_0     | conda-forge |\r\n| cloudpickle                   | 3.0.0        | pyhd8ed1ab_0          | conda-forge |\r\n| comm                          | 0.1.4        | pyhd8ed1ab_0          | conda-forge |\r\n| contourpy                     | 1.2.0        | py311h9547e67_0       | conda-forge |\r\n| cytoolz                       | 0.12.2       | py311h459d7ec_1       | conda-forge |\r\n| daal4py                       | 2023.2.1     | py311he14880b_0       | conda-forge |\r\n| dal                           | 2023.2.1     | ha770c72_1033         | conda-forge |\r\n| dask                          | 2023.11.0    | pyhd8ed1ab_0          | conda-forge |\r\n| dask-core                     | 2023.11.0    | pyhd8ed1ab_0          | conda-forge |\r\n| debugpy                       | 1.8.0        | py311hb755f60_1       | conda-forge |\r\n| decorator                     | 5.1.1        | pyhd8ed1ab_0          | conda-forge |\r\n| distributed                   | 2023.11.0    | pyhd8ed1ab_0          | conda-forge |\r\n| exceptiongroup                | 1.1.3        | pyhd8ed1ab_0          | conda-forge |\r\n| executing                     | 2.0.1        | pyhd8ed1ab_0          | conda-forge |\r\n| freetype                      | 2.12.1       | h267a509_2            | conda-forge |\r\n| fsspec                        | 2023.10.0    | pyhca7485f_0          | conda-forge |\r\n| gflags                        | 2.2.2        | he1b5a44_1004         | conda-forge |\r\n| glog                          | 0.6.0        | h6f12383_0            | conda-forge |\r\n| greenlet                      | 3.0.1        | py311hb755f60_0       | conda-forge |\r\n| icu                           | 73.2         | h59595ed_0            | conda-forge |\r\n| idna                          | 3.4          | pyhd8ed1ab_0          | conda-forge |\r\n| importlib-metadata            | 6.8.0        | pyha770c72_0          | conda-forge |\r\n| importlib_metadata            | 6.8.0        | hd8ed1ab_0            | conda-forge |\r\n| ipykernel                     | 6.26.0       | pyhf8b6a83_0          | conda-forge |\r\n| ipython                       | 8.17.2       | pyh41d4057_0          | conda-forge |\r\n| jedi                          | 0.19.1       | pyhd8ed1ab_0          | conda-forge |\r\n| jinja2                        | 3.1.2        | pyhd8ed1ab_1          | conda-forge |\r\n| jmespath                      | 1.0.1        | pyhd8ed1ab_0          | conda-forge |\r\n| joblib                        | 1.3.2        | pyhd8ed1ab_0          | conda-forge |\r\n| jupyter_client                | 8.6.0        | pyhd8ed1ab_0          | conda-forge |\r\n| jupyter_core                  | 5.5.0        | py311h38be061_0       | conda-forge |\r\n| keyutils                      | 1.6.1        | h166bdaf_0            | conda-forge |\r\n| krb5                          | 1.21.2       | h659d440_0            | conda-forge |\r\n| lcms2                         | 2.15         | hb7c19ff_3            | conda-forge |\r\n| ld_impl_linux-64              | 2.40         | h41732ed_0            | conda-forge |\r\n| lerc                          | 4.0.0        | h27087fc_0            | conda-forge |\r\n| libabseil                     | 20230802.1   | cxx17_h59595ed_0      | conda-forge |\r\n| libarrow                      | 14.0.1       | h0406937_1_cpu        | conda-forge |\r\n| libarrow-acero                | 14.0.1       | h59595ed_1_cpu        | conda-forge |\r\n| libarrow-dataset              | 14.0.1       | h59595ed_1_cpu        | conda-forge |\r\n| libarrow-flight               | 14.0.1       | h120cb0d_1_cpu        | conda-forge |\r\n| libarrow-flight-sql           | 14.0.1       | h61ff412_1_cpu        | conda-forge |\r\n| libarrow-gandiva              | 14.0.1       | hacb8726_1_cpu        | conda-forge |\r\n| libarrow-substrait            | 14.0.1       | h61ff412_1_cpu        | conda-forge |\r\n| libblas                       | 3.9.0        | 19_linux64_openblas   | conda-forge |\r\n| libbrotlicommon               | 1.1.0        | hd590300_1            | conda-forge |\r\n| libbrotlidec                  | 1.1.0        | hd590300_1            | conda-forge |\r\n| libbrotlienc                  | 1.1.0        | hd590300_1            | conda-forge |\r\n| libcblas                      | 3.9.0        | 19_linux64_openblas   | conda-forge |\r\n| libcrc32c                     | 1.1.2        | h9c3ff4c_0            | conda-forge |\r\n| libcurl                       | 8.4.0        | hca28451_0            | conda-forge |\r\n| libdeflate                    | 1.19         | hd590300_0            | conda-forge |\r\n| libedit                       | 3.1.20191231 | he28a2e2_2            | conda-forge |\r\n| libev                         | 4.33         | h516909a_1            | conda-forge |\r\n| libevent                      | 2.1.12       | hf998b51_1            | conda-forge |\r\n| libexpat                      | 2.5.0        | hcb278e6_1            | conda-forge |\r\n| libffi                        | 3.4.2        | h7f98852_5            | conda-forge |\r\n| libgcc-ng                     | 13.2.0       | h807b86a_3            | conda-forge |\r\n| libgfortran-ng                | 13.2.0       | h69a702a_3            | conda-forge |\r\n| libgfortran5                  | 13.2.0       | ha4646dd_3            | conda-forge |\r\n| libgomp                       | 13.2.0       | h807b86a_3            | conda-forge |\r\n| libgoogle-cloud               | 2.12.0       | h5206363_4            | conda-forge |\r\n| libgrpc                       | 1.59.2       | hd6c4280_0            | conda-forge |\r\n| libhwloc                      | 2.9.3        | default_h554bfaf_1009 | conda-forge |\r\n| libiconv                      | 1.17         | h166bdaf_0            | conda-forge |\r\n| libjpeg-turbo                 | 3.0.0        | hd590300_1            | conda-forge |\r\n| liblapack                     | 3.9.0        | 19_linux64_openblas   | conda-forge |\r\n| libllvm14                     | 14.0.6       | hcd5def8_4            | conda-forge |\r\n| libllvm15                     | 15.0.7       | h5cf9203_3            | conda-forge |\r\n| libnghttp2                    | 1.58.0       | h47da74e_0            | conda-forge |\r\n| libnsl                        | 2.0.1        | hd590300_0            | conda-forge |\r\n| libnuma                       | 2.0.16       | h0b41bf4_1            | conda-forge |\r\n| libopenblas                   | 0.3.24       | pthreads_h413a1c8_0   | conda-forge |\r\n| libparquet                    | 14.0.1       | h352af49_1_cpu        | conda-forge |\r\n| libpng                        | 1.6.39       | h753d276_0            | conda-forge |\r\n| libpq                         | 16.1         | hfc447b1_0            | conda-forge |\r\n| libprotobuf                   | 4.24.4       | hf27288f_0            | conda-forge |\r\n| libre2-11                     | 2023.06.02   | h7a70373_0            | conda-forge |\r\n| libsodium                     | 1.0.18       | h36c2ea0_1            | conda-forge |\r\n| libsqlite                     | 3.44.0       | h2797004_0            | conda-forge |\r\n| libssh2                       | 1.11.0       | h0841786_0            | conda-forge |\r\n| libstdcxx-ng                  | 13.2.0       | h7e041cc_3            | conda-forge |\r\n| libthrift                     | 0.19.0       | hb90f79a_1            | conda-forge |\r\n| libtiff                       | 4.6.0        | ha9c0a0a_2            | conda-forge |\r\n| libutf8proc                   | 2.8.0        | h166bdaf_0            | conda-forge |\r\n| libuuid                       | 2.38.1       | h0b41bf4_0            | conda-forge |\r\n| libwebp-base                  | 1.3.2        | hd590300_0            | conda-forge |\r\n| libxcb                        | 1.15         | h0b41bf4_0            | conda-forge |\r\n| libxml2                       | 2.11.5       | h232c23b_1            | conda-forge |\r\n| libzlib                       | 1.2.13       | hd590300_5            | conda-forge |\r\n| llvmlite                      | 0.41.1       | py311ha6695c7_0       | conda-forge |\r\n| locket                        | 1.0.0        | pyhd8ed1ab_0          | conda-forge |\r\n| lz4                           | 4.3.2        | py311h38e4bf4_1       | conda-forge |\r\n| lz4-c                         | 1.9.4        | hcb278e6_0            | conda-forge |\r\n| markupsafe                    | 2.1.3        | py311h459d7ec_1       | conda-forge |\r\n| matplotlib-inline             | 0.1.6        | pyhd8ed1ab_0          | conda-forge |\r\n| mpi                           | 1.0          | mpich                 | conda-forge |\r\n| mpich                         | 4.1.2        | h846660c_100          | conda-forge |\r\n| msgpack-python                | 1.0.6        | py311h9547e67_0       | conda-forge |\r\n| ncurses                       | 6.4          | h59595ed_2            | conda-forge |\r\n| nest-asyncio                  | 1.5.8        | pyhd8ed1ab_0          | conda-forge |\r\n| nomkl                         | 1.0          | h5ca1d4c_0            | conda-forge |\r\n| numba                         | 0.58.1       | py311h96b013e_0       | conda-forge |\r\n| numexpr                       | 2.8.7        | py311h039bad6_104     | conda-forge |\r\n| numpy                         | 1.26.0       | py311h64a7726_0       | conda-forge |\r\n| openjpeg                      | 2.5.0        | h488ebb8_3            | conda-forge |\r\n| openssl                       | 3.1.4        | hd590300_0            | conda-forge |\r\n| orc                           | 1.9.0        | h4b38347_4            | conda-forge |\r\n| packaging                     | 23.2         | pyhd8ed1ab_0          | conda-forge |\r\n| pandas                        | 2.1.3        | py311h320fe9a_0       | conda-forge |\r\n| parso                         | 0.8.3        | pyhd8ed1ab_0          | conda-forge |\r\n| partd                         | 1.4.1        | pyhd8ed1ab_0          | conda-forge |\r\n| pexpect                       | 4.8.0        | pyh1a96a4e_2          | conda-forge |\r\n| pickleshare                   | 0.7.5        | py_1003               | conda-forge |\r\n| pillow                        | 10.1.0       | py311ha6c5da5_0       | conda-forge |\r\n| pip                           | 23.3.1       | pyhd8ed1ab_0          | conda-forge |\r\n| platformdirs                  | 4.0.0        | pyhd8ed1ab_0          | conda-forge |\r\n| prompt-toolkit                | 3.0.40       | pyha770c72_0          | conda-forge |\r\n| prompt_toolkit                | 3.0.40       | hd8ed1ab_0            | conda-forge |\r\n| psutil                        | 5.9.5        | py311h459d7ec_1       | conda-forge |\r\n| psycopg2                      | 2.9.7        | py311h03dec38_1       | conda-forge |\r\n| psycopg2-binary               | 2.9.7        | pyhd8ed1ab_1          | conda-forge |\r\n| pthread-stubs                 | 0.4          | h36c2ea0_1001         | conda-forge |\r\n| ptyprocess                    | 0.7.0        | pyhd3deb0d_0          | conda-forge |\r\n| pure_eval                     | 0.2.2        | pyhd8ed1ab_0          | conda-forge |\r\n| pyarrow                       | 14.0.1       | py311h39c9aba_1_cpu   | conda-forge |\r\n| pyarrow-hotfix                | 0.4          | pyhd8ed1ab_0          | conda-forge |\r\n| pygments                      | 2.16.1       | pyhd8ed1ab_0          | conda-forge |\r\n| pysocks                       | 1.7.1        | pyha2e5f31_6          | conda-forge |\r\n| python                        | 3.11.6       | hab00c5b_0_cpython    | conda-forge |\r\n| python-dateutil               | 2.8.2        | pyhd8ed1ab_0          | conda-forge |\r\n| python-tzdata                 | 2023.3       | pyhd8ed1ab_0          | conda-forge |\r\n| python_abi                    | 3.11         | 4_cp311               | conda-forge |\r\n| pytz                          | 2023.3.post1 | pyhd8ed1ab_0          | conda-forge |\r\n| pyyaml                        | 6.0.1        | py311h459d7ec_1       | conda-forge |\r\n| pyzmq                         | 25.1.1       | py311h34ded2d_2       | conda-forge |\r\n| rdma-core                     | 28.9         | h59595ed_1            | conda-forge |\r\n| re2                           | 2023.06.02   | h2873b5e_0            | conda-forge |\r\n| readline                      | 8.2          | h8228510_1            | conda-forge |\r\n| requests                      | 2.31.0       | pyhd8ed1ab_0          | conda-forge |\r\n| s2n                           | 1.3.56       | h06160fa_0            | conda-forge |\r\n| s3transfer                    | 0.7.0        | pyhd8ed1ab_0          | conda-forge |\r\n| scikit-learn                  | 1.3.2        | py311hc009520_1       | conda-forge |\r\n| scikit-learn-intelex          | 2023.2.1     | py311h38be061_0       | conda-forge |\r\n| scipy                         | 1.11.3       | py311h64a7726_1       | conda-forge |\r\n| setuptools                    | 68.2.2       | pyhd8ed1ab_0          | conda-forge |\r\n| six                           | 1.16.0       | pyh6c4a22f_0          | conda-forge |\r\n| snappy                        | 1.1.10       | h9fff704_0            | conda-forge |\r\n| sortedcontainers              | 2.4.0        | pyhd8ed1ab_0          | conda-forge |\r\n| sqlalchemy                    | 2.0.23       | py311h459d7ec_0       | conda-forge |\r\n| stack_data                    | 0.6.2        | pyhd8ed1ab_0          | conda-forge |\r\n| tabulate                      | 0.9.0        | pyhd8ed1ab_1          | conda-forge |\r\n| tbb                           | 2021.10.0    | h00ab1b0_2            | conda-forge |\r\n| tblib                         | 2.0.0        | pyhd8ed1ab_0          | conda-forge |\r\n| threadpoolctl                 | 3.2.0        | pyha21a80b_0          | conda-forge |\r\n| tk                            | 8.6.13       | noxft_h4845f30_101    | conda-forge |\r\n| toolz                         | 0.12.0       | pyhd8ed1ab_0          | conda-forge |\r\n| tornado                       | 6.3.3        | py311h459d7ec_1       | conda-forge |\r\n| traitlets                     | 5.13.0       | pyhd8ed1ab_0          | conda-forge |\r\n| typing-extensions             | 4.8.0        | hd8ed1ab_0            | conda-forge |\r\n| typing_extensions             | 4.8.0        | pyha770c72_0          | conda-forge |\r\n| tzdata                        | 2023c        | h71feb2d_0            | conda-forge |\r\n| ucx                           | 1.15.0       | h64cca9d_0            | conda-forge |\r\n| urllib3                       | 1.26.18      | pyhd8ed1ab_0          | conda-forge |\r\n| wcwidth                       | 0.2.9        | pyhd8ed1ab_0          | conda-forge |\r\n| wheel                         | 0.41.3       | pyhd8ed1ab_0          | conda-forge |\r\n| xorg-libxau                   | 1.0.11       | hd590300_0            | conda-forge |\r\n| xorg-libxdmcp                 | 1.1.3        | h7f98852_0            | conda-forge |\r\n| xyzservices                   | 2023.10.1    | pyhd8ed1ab_0          | conda-forge |\r\n| xz                            | 5.2.6        | h166bdaf_0            | conda-forge |\r\n| yaml                          | 0.2.5        | h7f98852_2            | conda-forge |\r\n| zeromq                        | 4.3.5        | h59595ed_0            | conda-forge |\r\n| zict                          | 3.0.0        | pyhd8ed1ab_0          | conda-forge |\r\n| zipp                          | 3.17.0       | pyhd8ed1ab_0          | conda-forge |\r\n| zstd                          | 1.5.5        | hfc55251_0            | conda-forge |",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/10628/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/10628/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}