[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/529418628",
        "html_url": "https://github.com/dask/dask/issues/5377#issuecomment-529418628",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5377",
        "id": 529418628,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTQxODYyOA==",
        "user": {
            "login": "TomAugspurger",
            "id": 1312546,
            "node_id": "MDQ6VXNlcjEzMTI1NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1312546?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomAugspurger",
            "html_url": "https://github.com/TomAugspurger",
            "followers_url": "https://api.github.com/users/TomAugspurger/followers",
            "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
            "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
            "repos_url": "https://api.github.com/users/TomAugspurger/repos",
            "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-09T11:03:03Z",
        "updated_at": "2019-09-09T11:03:03Z",
        "author_association": "MEMBER",
        "body": "Hmmm it's raises at https://github.com/dask/dask/blob/a4b5a1deb0c910fc5b851f856d64f98639010779/dask/array/routines.py#L887-L888.\r\n\r\n> I think that it should work theoretically\r\n\r\nPerhaps, but do you have an alternative implementation in mind? Nothing comes to me immediately. Do you have thoughts @jakirkham?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/529418628/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/529498851",
        "html_url": "https://github.com/dask/dask/issues/5377#issuecomment-529498851",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5377",
        "id": 529498851,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTQ5ODg1MQ==",
        "user": {
            "login": "quasiben",
            "id": 1403768,
            "node_id": "MDQ6VXNlcjE0MDM3Njg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1403768?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/quasiben",
            "html_url": "https://github.com/quasiben",
            "followers_url": "https://api.github.com/users/quasiben/followers",
            "following_url": "https://api.github.com/users/quasiben/following{/other_user}",
            "gists_url": "https://api.github.com/users/quasiben/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/quasiben/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/quasiben/subscriptions",
            "organizations_url": "https://api.github.com/users/quasiben/orgs",
            "repos_url": "https://api.github.com/users/quasiben/repos",
            "events_url": "https://api.github.com/users/quasiben/events{/privacy}",
            "received_events_url": "https://api.github.com/users/quasiben/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-09T14:21:55Z",
        "updated_at": "2019-09-09T14:21:55Z",
        "author_association": "MEMBER",
        "body": "Hmm, why does the filter have unknown shape ?\r\n\r\n```\r\nIn [26]: a[a>0]\r\nOut[26]: dask.array<getitem, shape=(nan,), dtype=float64, chunksize=(nan,), chunktype=numpy.ndarray>\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/529498851/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/529500218",
        "html_url": "https://github.com/dask/dask/issues/5377#issuecomment-529500218",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5377",
        "id": 529500218,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTUwMDIxOA==",
        "user": {
            "login": "jakirkham",
            "id": 3019665,
            "node_id": "MDQ6VXNlcjMwMTk2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jakirkham",
            "html_url": "https://github.com/jakirkham",
            "followers_url": "https://api.github.com/users/jakirkham/followers",
            "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
            "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
            "organizations_url": "https://api.github.com/users/jakirkham/orgs",
            "repos_url": "https://api.github.com/users/jakirkham/repos",
            "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jakirkham/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-09T14:24:46Z",
        "updated_at": "2019-09-09T14:24:46Z",
        "author_association": "MEMBER",
        "body": "> Do you have thoughts @jakirkham?\r\n\r\nNot really no. Though no objections to others thinking about this :)\r\n\r\n> Hmm, why does the filter have unknown shape ?\r\n\r\nBecause we don't know how many values are greater than 0.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/529500218/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/529577584",
        "html_url": "https://github.com/dask/dask/issues/5377#issuecomment-529577584",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5377",
        "id": 529577584,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTU3NzU4NA==",
        "user": {
            "login": "sjperkins",
            "id": 3530212,
            "node_id": "MDQ6VXNlcjM1MzAyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3530212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sjperkins",
            "html_url": "https://github.com/sjperkins",
            "followers_url": "https://api.github.com/users/sjperkins/followers",
            "following_url": "https://api.github.com/users/sjperkins/following{/other_user}",
            "gists_url": "https://api.github.com/users/sjperkins/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sjperkins/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sjperkins/subscriptions",
            "organizations_url": "https://api.github.com/users/sjperkins/orgs",
            "repos_url": "https://api.github.com/users/sjperkins/repos",
            "events_url": "https://api.github.com/users/sjperkins/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sjperkins/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-09T17:12:06Z",
        "updated_at": "2019-09-09T17:12:06Z",
        "author_association": "MEMBER",
        "body": "> Hmmm it's raises at\r\n> \r\n> https://github.com/dask/dask/blob/a4b5a1deb0c910fc5b851f856d64f98639010779/dask/array/routines.py#L887-L888\r\n> .\r\n> \r\n> > I think that it should work theoretically\r\n> \r\n> Perhaps, but do you have an alternative implementation in mind? Nothing comes to me immediately. Do you have thoughts @jakirkham?\r\n\r\nSomething like this has worked for me:\r\n\r\n```python\r\ndef _ones_unknown_chunks(array):\r\n    return np.ones_like(array)\r\n\r\n\r\ndef ones_unknown(exemplar):\r\n    \"\"\" ones_like that handles nan chunk sizes \"\"\"\r\n    return exemplar.map_blocks(_ones_unknown_chunks, dtype=exemplar.dtype)\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/529577584/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/529578583",
        "html_url": "https://github.com/dask/dask/issues/5377#issuecomment-529578583",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5377",
        "id": 529578583,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTU3ODU4Mw==",
        "user": {
            "login": "sjperkins",
            "id": 3530212,
            "node_id": "MDQ6VXNlcjM1MzAyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3530212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sjperkins",
            "html_url": "https://github.com/sjperkins",
            "followers_url": "https://api.github.com/users/sjperkins/followers",
            "following_url": "https://api.github.com/users/sjperkins/following{/other_user}",
            "gists_url": "https://api.github.com/users/sjperkins/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sjperkins/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sjperkins/subscriptions",
            "organizations_url": "https://api.github.com/users/sjperkins/orgs",
            "repos_url": "https://api.github.com/users/sjperkins/repos",
            "events_url": "https://api.github.com/users/sjperkins/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sjperkins/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-09T17:14:25Z",
        "updated_at": "2019-09-09T17:14:25Z",
        "author_association": "MEMBER",
        "body": "In fact this might be even simpler?\r\n\r\n```python\r\ndef ones_unknown(exemplar):\r\n    return exemplar.map_blocks(np.ones_like, dtype=examplar.dtype)\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/529578583/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/529598839",
        "html_url": "https://github.com/dask/dask/issues/5377#issuecomment-529598839",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5377",
        "id": 529598839,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTU5ODgzOQ==",
        "user": {
            "login": "jakirkham",
            "id": 3019665,
            "node_id": "MDQ6VXNlcjMwMTk2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jakirkham",
            "html_url": "https://github.com/jakirkham",
            "followers_url": "https://api.github.com/users/jakirkham/followers",
            "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
            "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
            "organizations_url": "https://api.github.com/users/jakirkham/orgs",
            "repos_url": "https://api.github.com/users/jakirkham/repos",
            "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jakirkham/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-09T18:06:42Z",
        "updated_at": "2019-09-09T18:06:42Z",
        "author_association": "MEMBER",
        "body": "I think those lines are mainly mimicking these with `arange`.\r\n\r\nhttps://github.com/dask/dask/blob/a4b5a1deb0c910fc5b851f856d64f98639010779/dask/array/routines.py#L882-L883\r\n\r\nThat said, there may be some clever way to get these lines to work with unknown chunk sizes too.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/529598839/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/529615775",
        "html_url": "https://github.com/dask/dask/issues/5377#issuecomment-529615775",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5377",
        "id": 529615775,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTYxNTc3NQ==",
        "user": {
            "login": "sjperkins",
            "id": 3530212,
            "node_id": "MDQ6VXNlcjM1MzAyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3530212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sjperkins",
            "html_url": "https://github.com/sjperkins",
            "followers_url": "https://api.github.com/users/sjperkins/followers",
            "following_url": "https://api.github.com/users/sjperkins/following{/other_user}",
            "gists_url": "https://api.github.com/users/sjperkins/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sjperkins/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sjperkins/subscriptions",
            "organizations_url": "https://api.github.com/users/sjperkins/orgs",
            "repos_url": "https://api.github.com/users/sjperkins/repos",
            "events_url": "https://api.github.com/users/sjperkins/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sjperkins/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-09T18:49:42Z",
        "updated_at": "2019-09-09T18:49:42Z",
        "author_association": "MEMBER",
        "body": "> I think those lines are mainly mimicking these with `arange`.\r\n> \r\n> https://github.com/dask/dask/blob/a4b5a1deb0c910fc5b851f856d64f98639010779/dask/array/routines.py#L882-L883\r\n> \r\n> That said, there may be some clever way to get these lines to work with unknown chunk sizes too.\r\n\r\n```python\r\nimport dask\r\nimport dask.array as da\r\nfrom dask.base import tokenize\r\nfrom dask.highlevelgraph import HighLevelGraph\r\nimport numpy as np\r\nfrom numpy.testing import assert_array_equal\r\n\r\n\r\ndef input_array():\r\n    \"\"\" Create a nan chunk array \"\"\"\r\n    name = 'a-' + tokenize()\r\n\r\n    layers = {\r\n        (name, 0): np.array([0, 1, 2]),\r\n        (name, 1): np.array([3, 4]),\r\n        (name, 2): np.array([5, 6, 7, 8]),\r\n        (name, 3): np.array([9, 10])\r\n    }\r\n\r\n    graph = HighLevelGraph.from_collections(name, layers, [])\r\n    chunks = (tuple(np.nan for _ in range(len(layers))),)\r\n    return da.Array(graph, name, chunks, dtype=np.int32)\r\n\r\n\r\ndef _chunk_runs(data, prev=None):\r\n    start = prev[1] if prev is not None else 0\r\n    return (start, start + data.shape[0])\r\n\r\n\r\ndef _chunk_arange(runs):\r\n    return np.arange(runs[0], runs[1])\r\n\r\n\r\ndef nan_arange(array):\r\n    name = 'nan-runs-' + tokenize(array)\r\n    prev_key = None\r\n    layers = {}\r\n\r\n    for c in range(len(array.chunks[0])):\r\n        key = (name, c)\r\n        layers[key] = (_chunk_runs, (array.name, c), prev_key)\r\n        prev_key = key\r\n\r\n    graph = HighLevelGraph.from_collections(name, layers, [array])\r\n    meta = np.empty((0,), dtype=tuple)\r\n    runs = da.Array(graph, name, array.chunks, meta=meta, dtype=tuple)\r\n\r\n    # TODO: Figure out how to use np.arange directly here:\r\n    return runs.map_blocks(_chunk_arange, dtype=np.int32)\r\n\r\n\r\nassert_array_equal(nan_arange(input_array()), np.arange(11))\r\n```\r\n\r\nThe only disadvantage I can see is that adds a linear dependency between calls to figure out the runs but I don't think it can be helped and I don't think its too bad.\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/529615775/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/529626890",
        "html_url": "https://github.com/dask/dask/issues/5377#issuecomment-529626890",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5377",
        "id": 529626890,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTYyNjg5MA==",
        "user": {
            "login": "jakirkham",
            "id": 3019665,
            "node_id": "MDQ6VXNlcjMwMTk2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jakirkham",
            "html_url": "https://github.com/jakirkham",
            "followers_url": "https://api.github.com/users/jakirkham/followers",
            "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
            "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
            "organizations_url": "https://api.github.com/users/jakirkham/orgs",
            "repos_url": "https://api.github.com/users/jakirkham/repos",
            "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jakirkham/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-09T19:20:06Z",
        "updated_at": "2019-09-09T19:20:06Z",
        "author_association": "MEMBER",
        "body": "Do you want to start a PR?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/529626890/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/529932491",
        "html_url": "https://github.com/dask/dask/issues/5377#issuecomment-529932491",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5377",
        "id": 529932491,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTkzMjQ5MQ==",
        "user": {
            "login": "sjperkins",
            "id": 3530212,
            "node_id": "MDQ6VXNlcjM1MzAyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3530212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sjperkins",
            "html_url": "https://github.com/sjperkins",
            "followers_url": "https://api.github.com/users/sjperkins/followers",
            "following_url": "https://api.github.com/users/sjperkins/following{/other_user}",
            "gists_url": "https://api.github.com/users/sjperkins/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sjperkins/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sjperkins/subscriptions",
            "organizations_url": "https://api.github.com/users/sjperkins/orgs",
            "repos_url": "https://api.github.com/users/sjperkins/repos",
            "events_url": "https://api.github.com/users/sjperkins/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sjperkins/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-10T13:23:28Z",
        "updated_at": "2019-09-10T13:23:28Z",
        "author_association": "MEMBER",
        "body": "> Do you want to start a PR?\r\n\r\nHey @jakirkham. Unfortunately, I don't have time at the moment. My schedule might clear in three weeks or so.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/529932491/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]