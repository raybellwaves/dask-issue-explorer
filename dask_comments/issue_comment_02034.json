[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/285062828",
        "html_url": "https://github.com/dask/dask/issues/2034#issuecomment-285062828",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2034",
        "id": 285062828,
        "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTA2MjgyOA==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-03-08T14:56:49Z",
        "updated_at": "2017-03-08T14:56:49Z",
        "author_association": "MEMBER",
        "body": "Sorry for the delay on this.  Can you explain the terms erf, dask-sq, size, and mops?  I think that size means chunksize and sq means sequential.  I'm unsure of the others.  ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/285062828/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/285233805",
        "html_url": "https://github.com/dask/dask/issues/2034#issuecomment-285233805",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2034",
        "id": 285233805,
        "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTIzMzgwNQ==",
        "user": {
            "login": "anton-malakhov",
            "id": 7475946,
            "node_id": "MDQ6VXNlcjc0NzU5NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7475946?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/anton-malakhov",
            "html_url": "https://github.com/anton-malakhov",
            "followers_url": "https://api.github.com/users/anton-malakhov/followers",
            "following_url": "https://api.github.com/users/anton-malakhov/following{/other_user}",
            "gists_url": "https://api.github.com/users/anton-malakhov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/anton-malakhov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/anton-malakhov/subscriptions",
            "organizations_url": "https://api.github.com/users/anton-malakhov/orgs",
            "repos_url": "https://api.github.com/users/anton-malakhov/repos",
            "events_url": "https://api.github.com/users/anton-malakhov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/anton-malakhov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-03-09T02:15:31Z",
        "updated_at": "2017-03-09T02:16:25Z",
        "author_association": "NONE",
        "body": "No problem, sorry that it took me some time to get back to this as well :)\r\nERF corresponds to the math used underneath but here it is the only math method, so you can just safely ignore it.\r\n\r\n`Dask-sq` means the name and method of the implementation which can be selected among several options. Here, you want to look at `Dask-sq`, which means pure Dask.array code running with async (serial) scheduler, and `Dask-agg-sq` which refers to similar function implemented with pure Numpy but executed with `map_blocks` on top of it.\r\n\r\n`MOPS` is \"millions options per second\", a measure of performance where grater value is better.\r\n\r\n`Size` refers to the problem size, not the chunk size.\r\n\r\nThe chunk size is not printed here and defaults to 2000000 (which might be too big) as implemented [here](https://github.com/IntelPython/BlackScholes_bench/blob/master/base_bs_erf.py#L80) or specified by `--chunk` argument. It is better to calibrate this value for particular platform you are running on so that results from `bs_erf_dask_numpy.py` should be eventually faster than for `bs_erf_numpy.py` (pure Numpy version). Choosing it right is tricky because with less chunk size, there are apparently more chunking overheads and less work to run in parallel with MKL. But if chunksize exceeds the last level cache, the performance can be drop as well.\r\n\r\nThe idea of this comparison is to understand overheads added by dask.array or Dask tasks because I assume that both cases are pretty much equivalent in terms of the sequence of operations and chunk sizes. Having small overheads for dask.array would allow us to extract additional performance comparing to plain Numpy through executing consequent operations by chunks which fit into last level cache (so, it is not even about Dask parallelism here).\r\n\r\nUnfortunately, I have to admit that stability of performance results (which I checked while writing this) still bothers me, especially results do not look comparable when I check runs with default settings (or rather with `--chunk=1048576`) against runs additionally specifying `--size=1048576 --steps=6`.. so, it is rather hard to separate one problem from another..\r\nAnyway, there is something wrong with Dask versions of benchmark and their results don't sound convincing to me. The reason is that either I don't see better or at least the same performance comparing to Numpy version even for big sizes, or there is visible gap between two Dask versions indicating the overheads I'm hunting for. Another indication is that Dask versions are significantly slower than Numpy version for small problem sizes, up to hundreds thousandth of options. I hope I just did something wrong.\r\n\r\nYou can also see how optimized NumExpr version runs 4-5x faster which is something Dask might want to repeat.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/285233805/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/285234504",
        "html_url": "https://github.com/dask/dask/issues/2034#issuecomment-285234504",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2034",
        "id": 285234504,
        "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTIzNDUwNA==",
        "user": {
            "login": "anton-malakhov",
            "id": 7475946,
            "node_id": "MDQ6VXNlcjc0NzU5NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7475946?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/anton-malakhov",
            "html_url": "https://github.com/anton-malakhov",
            "followers_url": "https://api.github.com/users/anton-malakhov/followers",
            "following_url": "https://api.github.com/users/anton-malakhov/following{/other_user}",
            "gists_url": "https://api.github.com/users/anton-malakhov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/anton-malakhov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/anton-malakhov/subscriptions",
            "organizations_url": "https://api.github.com/users/anton-malakhov/orgs",
            "repos_url": "https://api.github.com/users/anton-malakhov/repos",
            "events_url": "https://api.github.com/users/anton-malakhov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/anton-malakhov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-03-09T02:19:28Z",
        "updated_at": "2017-03-09T02:20:13Z",
        "author_association": "NONE",
        "body": "Here is the latest example of my runs which specify `--steps=1` in attempt to get rid of instability associated with consequent measurements on different sizes:\r\n```\r\n[20:15:00 fxsatlin04 BlackScholes_bench] (master)$ python bs_erf_numpy.py --chunk=1048576 --size=16777216 --steps=1\r\nUsing  Intel-erf-invsqrt  numpy  1.11.2\r\nERF: Numpy: Size: 16777216\r\nMOPS: 170.25445033217153\r\n[20:15:31 fxsatlin04 BlackScholes_bench] (master)$ python bs_erf_dask_numpy.py  --size=16777216 --steps=1\r\nUsing  Intel-erf-invsqrt  numpy  1.11.2\r\nERF: Dask-agg-sq: Size: 16777216\r\nMOPS: 206.78622152834865\r\n[20:16:06 fxsatlin04 BlackScholes_bench] (master)$ python bs_erf_dask.py  --size=16777216 --steps=1\r\nUsing  Intel-erf-invsqrt  numpy  1.11.2\r\nERF: Dask-sq: Size: 16777216\r\nintelpython3/lib/python3.5/site-packages/dask/array/core.py:457: RuntimeWarning: overflow encountered in true_divide\r\n  o = func(*args, **kwargs)\r\nMOPS: 137.96024696752727\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/285234504/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/285235775",
        "html_url": "https://github.com/dask/dask/issues/2034#issuecomment-285235775",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2034",
        "id": 285235775,
        "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTIzNTc3NQ==",
        "user": {
            "login": "anton-malakhov",
            "id": 7475946,
            "node_id": "MDQ6VXNlcjc0NzU5NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7475946?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/anton-malakhov",
            "html_url": "https://github.com/anton-malakhov",
            "followers_url": "https://api.github.com/users/anton-malakhov/followers",
            "following_url": "https://api.github.com/users/anton-malakhov/following{/other_user}",
            "gists_url": "https://api.github.com/users/anton-malakhov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/anton-malakhov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/anton-malakhov/subscriptions",
            "organizations_url": "https://api.github.com/users/anton-malakhov/orgs",
            "repos_url": "https://api.github.com/users/anton-malakhov/repos",
            "events_url": "https://api.github.com/users/anton-malakhov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/anton-malakhov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-03-09T02:27:43Z",
        "updated_at": "2017-03-09T02:27:43Z",
        "author_association": "NONE",
        "body": "One more thing, the Numpy version is further aligned with Dask versions by the following modification:\r\n```\r\ndiff --git a/bs_erf_numpy.py b/bs_erf_numpy.py\r\nindex 92a19fe..e51ac01 100644\r\n--- a/bs_erf_numpy.py\r\n+++ b/bs_erf_numpy.py\r\n@@ -29,6 +29,6 @@ def black_scholes ( nopt, price, strike, t, rate, vol ):\r\n        call = P * d1 - Se * d2\r\n        put = call - P + Se\r\n\r\n-       return (call, put)\r\n+       return np.stack((call, put))\r\n```\r\nI had to add `stack` operation to Dask version because it is impossible to return two arrays otherwise.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/285235775/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/285345083",
        "html_url": "https://github.com/dask/dask/issues/2034#issuecomment-285345083",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2034",
        "id": 285345083,
        "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTM0NTA4Mw==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-03-09T13:01:09Z",
        "updated_at": "2017-03-09T13:01:09Z",
        "author_association": "MEMBER",
        "body": "I used the cProfile module to profile times on the first few sizes. \r\n\r\n    $ python -m cProfile -o profile.out bs_erf_dask.py\r\n    $ snakeviz profile.out   # need to pip install snakeviz\r\n\r\n I found that most of the cost in the first few rounds was graph construction.  This isn't that surprising for smallish datasets, historically Dask.array has been used more to enable  larger-than-memory computations more than to accelerate smaller ones.\r\n\r\nI optimized things for about half an hour and was able to reduce overhead by around 40%.\r\nSee https://github.com/dask/dask/pull/2058 and #1943 \r\n\r\nThere are probably other optimizations out there that we could do with more effort.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/285345083/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/285507200",
        "html_url": "https://github.com/dask/dask/issues/2034#issuecomment-285507200",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2034",
        "id": 285507200,
        "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTUwNzIwMA==",
        "user": {
            "login": "anton-malakhov",
            "id": 7475946,
            "node_id": "MDQ6VXNlcjc0NzU5NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7475946?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/anton-malakhov",
            "html_url": "https://github.com/anton-malakhov",
            "followers_url": "https://api.github.com/users/anton-malakhov/followers",
            "following_url": "https://api.github.com/users/anton-malakhov/following{/other_user}",
            "gists_url": "https://api.github.com/users/anton-malakhov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/anton-malakhov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/anton-malakhov/subscriptions",
            "organizations_url": "https://api.github.com/users/anton-malakhov/orgs",
            "repos_url": "https://api.github.com/users/anton-malakhov/repos",
            "events_url": "https://api.github.com/users/anton-malakhov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/anton-malakhov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-03-09T22:41:24Z",
        "updated_at": "2017-03-09T22:41:24Z",
        "author_association": "NONE",
        "body": "That's great news, thank you. I hope this bench will be helpful for further optimizations as well.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/285507200/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]