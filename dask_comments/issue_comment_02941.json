[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/348326008",
        "html_url": "https://github.com/dask/dask/issues/2941#issuecomment-348326008",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2941",
        "id": 348326008,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM0ODMyNjAwOA==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-11-30T21:27:01Z",
        "updated_at": "2017-11-30T21:27:01Z",
        "author_association": "MEMBER",
        "body": "Thank you for the reproducible example.  Taking a look now.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/348326008/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/348332683",
        "html_url": "https://github.com/dask/dask/issues/2941#issuecomment-348332683",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2941",
        "id": 348332683,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM0ODMzMjY4Mw==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-11-30T21:52:22Z",
        "updated_at": "2017-11-30T21:52:22Z",
        "author_association": "MEMBER",
        "body": "OK, so we have several dataframes with slightly overlapping divisions\r\n\r\n```\r\n|     | |\r\n|     |  |\r\n|     |   |\r\n|     |    |\r\n```\r\n\r\nWhen we align these divisions we come up with the following output divisions\r\n```\r\n|     | ||||\r\n```\r\n\r\nWhich we then tell everyone to match\r\n```\r\n|     | |\r\n|     | ||\r\n|     | |||\r\n|     | ||||\r\n```\r\n\r\nEach repartitioning has about as many divisions as we have dataframes, so this is roughly `O(n^2)`.\r\n\r\nOne solution here would be to change the `align_partitions` function to be less conservative, and willing to merge partitions a bit more.  This is a bit dangerous (merging partitions here may overwhelm memory) but might be ok to do a bit.  \r\n\r\nIn this particular case we probably wanted to convert these divisions\r\n\r\n```\r\n|     | |\r\n|     |  |\r\n|     |   |\r\n|     |    |\r\n```\r\n\r\nInto this output\r\n\r\n```\r\n|     |    |\r\n```\r\n\r\nOr, if we wanted to be safe, maybe something like the following:\r\n\r\n```\r\n|     |  |  |\r\n```\r\n\r\nThe relevant code is `align_partitions` in [dataframe/multi.py](https://github.com/dask/dask/blob/master/dask/dataframe/multi.py)\r\n\r\nI don't immediately see an obvious clean way to do this that is decent in all situations.  I imagine this might take some thought.  @shughes-uk if you have any interest in diving in here that would be welcome.  The `align_partitions` code is not trivial, but is well separated from the rest of dask.dataframe.\r\n\r\nThe line to change is this one:\r\n\r\n```python\r\n    divisions = list(unique(merge_sorted(*[df.divisions for df in dfs1])))\r\n```\r\n\r\nWe would need to be a bit more clever there",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/348332683/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/348587606",
        "html_url": "https://github.com/dask/dask/issues/2941#issuecomment-348587606",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2941",
        "id": 348587606,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM0ODU4NzYwNg==",
        "user": {
            "login": "shughes-uk",
            "id": 546891,
            "node_id": "MDQ6VXNlcjU0Njg5MQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/546891?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/shughes-uk",
            "html_url": "https://github.com/shughes-uk",
            "followers_url": "https://api.github.com/users/shughes-uk/followers",
            "following_url": "https://api.github.com/users/shughes-uk/following{/other_user}",
            "gists_url": "https://api.github.com/users/shughes-uk/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/shughes-uk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/shughes-uk/subscriptions",
            "organizations_url": "https://api.github.com/users/shughes-uk/orgs",
            "repos_url": "https://api.github.com/users/shughes-uk/repos",
            "events_url": "https://api.github.com/users/shughes-uk/events{/privacy}",
            "received_events_url": "https://api.github.com/users/shughes-uk/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-12-01T19:12:45Z",
        "updated_at": "2017-12-01T19:12:45Z",
        "author_association": "CONTRIBUTOR",
        "body": "I feel a little in over my head but i'll have a look ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/348587606/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/348640786",
        "html_url": "https://github.com/dask/dask/issues/2941#issuecomment-348640786",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2941",
        "id": 348640786,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM0ODY0MDc4Ng==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-12-01T23:23:57Z",
        "updated_at": "2017-12-01T23:23:57Z",
        "author_association": "MEMBER",
        "body": "@eriknw you might enjoy this problem.  It's interesting, not clear how best to handle all situations, and well isolated.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/348640786/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/349021555",
        "html_url": "https://github.com/dask/dask/issues/2941#issuecomment-349021555",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/2941",
        "id": 349021555,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTAyMTU1NQ==",
        "user": {
            "login": "eriknw",
            "id": 2058401,
            "node_id": "MDQ6VXNlcjIwNTg0MDE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2058401?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/eriknw",
            "html_url": "https://github.com/eriknw",
            "followers_url": "https://api.github.com/users/eriknw/followers",
            "following_url": "https://api.github.com/users/eriknw/following{/other_user}",
            "gists_url": "https://api.github.com/users/eriknw/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/eriknw/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/eriknw/subscriptions",
            "organizations_url": "https://api.github.com/users/eriknw/orgs",
            "repos_url": "https://api.github.com/users/eriknw/repos",
            "events_url": "https://api.github.com/users/eriknw/events{/privacy}",
            "received_events_url": "https://api.github.com/users/eriknw/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2017-12-04T16:42:58Z",
        "updated_at": "2017-12-04T16:42:58Z",
        "author_association": "MEMBER",
        "body": "ping received, thanks!",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/349021555/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]