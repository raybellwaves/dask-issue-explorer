[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1014634207",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1014634207",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1014634207,
        "node_id": "IC_kwDOAbcwm848ehbf",
        "user": {
            "login": "madsbk",
            "id": 1041088,
            "node_id": "MDQ6VXNlcjEwNDEwODg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1041088?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/madsbk",
            "html_url": "https://github.com/madsbk",
            "followers_url": "https://api.github.com/users/madsbk/followers",
            "following_url": "https://api.github.com/users/madsbk/following{/other_user}",
            "gists_url": "https://api.github.com/users/madsbk/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/madsbk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/madsbk/subscriptions",
            "organizations_url": "https://api.github.com/users/madsbk/orgs",
            "repos_url": "https://api.github.com/users/madsbk/repos",
            "events_url": "https://api.github.com/users/madsbk/events{/privacy}",
            "received_events_url": "https://api.github.com/users/madsbk/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-01-17T15:02:52Z",
        "updated_at": "2022-01-17T15:02:52Z",
        "author_association": "MEMBER",
        "body": "> Why is it necessary for HLG.cull to ask the layer for all its keys, intersect them itself, then pass that back into the layer? \r\n\r\nI don't think this is necessary, we did it to make the implementation of `layer.cull()` simpler. \r\n\r\n> And why is it necessary for cull functions to take `all_hlg_keys`?\r\n\r\nThe cull functions use `all_hlg_keys` to identify keys.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1014634207/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1017073540",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1017073540",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1017073540,
        "node_id": "IC_kwDOAbcwm848n0-E",
        "user": {
            "login": "gjoseph92",
            "id": 3309802,
            "node_id": "MDQ6VXNlcjMzMDk4MDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3309802?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/gjoseph92",
            "html_url": "https://github.com/gjoseph92",
            "followers_url": "https://api.github.com/users/gjoseph92/followers",
            "following_url": "https://api.github.com/users/gjoseph92/following{/other_user}",
            "gists_url": "https://api.github.com/users/gjoseph92/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/gjoseph92/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/gjoseph92/subscriptions",
            "organizations_url": "https://api.github.com/users/gjoseph92/orgs",
            "repos_url": "https://api.github.com/users/gjoseph92/repos",
            "events_url": "https://api.github.com/users/gjoseph92/events{/privacy}",
            "received_events_url": "https://api.github.com/users/gjoseph92/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-01-20T03:04:08Z",
        "updated_at": "2022-01-20T03:04:08Z",
        "author_association": "MEMBER",
        "body": "So would it be possible to rewrite the culling process to not require any layers to generate all their keys?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1017073540/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1035366303",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1035366303",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1035366303,
        "node_id": "IC_kwDOAbcwm849tm-f",
        "user": {
            "login": "martindurant",
            "id": 6042212,
            "node_id": "MDQ6VXNlcjYwNDIyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6042212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/martindurant",
            "html_url": "https://github.com/martindurant",
            "followers_url": "https://api.github.com/users/martindurant/followers",
            "following_url": "https://api.github.com/users/martindurant/following{/other_user}",
            "gists_url": "https://api.github.com/users/martindurant/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/martindurant/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/martindurant/subscriptions",
            "organizations_url": "https://api.github.com/users/martindurant/orgs",
            "repos_url": "https://api.github.com/users/martindurant/repos",
            "events_url": "https://api.github.com/users/martindurant/events{/privacy}",
            "received_events_url": "https://api.github.com/users/martindurant/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-10T19:13:29Z",
        "updated_at": "2022-02-10T19:13:29Z",
        "author_association": "MEMBER",
        "body": "Totally agree with @gjoseph92 , I was under the impression that there were two major benefits of HLGs in general:\r\n- smaller transfer size, since we do something similar to using a generator/comprehension rather than a concrete set of keys and tasks\r\n- that you can select/update from a large graph at no cost, effectively changing the start/end of the comprehension implied in the first bullet.\r\n- (possibilities for higher-level optimisations)\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1035366303/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1035480722",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1035480722",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1035480722,
        "node_id": "IC_kwDOAbcwm849uC6S",
        "user": {
            "login": "jakirkham",
            "id": 3019665,
            "node_id": "MDQ6VXNlcjMwMTk2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jakirkham",
            "html_url": "https://github.com/jakirkham",
            "followers_url": "https://api.github.com/users/jakirkham/followers",
            "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
            "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
            "organizations_url": "https://api.github.com/users/jakirkham/orgs",
            "repos_url": "https://api.github.com/users/jakirkham/repos",
            "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jakirkham/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-10T20:35:04Z",
        "updated_at": "2022-02-10T20:35:04Z",
        "author_association": "MEMBER",
        "body": "I could be wrong about this, but given the proposed changes around HLG transfer ( https://github.com/dask/distributed/issues/5581 ) there is an opportunity to improve transfer size (if more work is still needed there)",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1035480722/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1036302286",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1036302286",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1036302286,
        "node_id": "IC_kwDOAbcwm849xLfO",
        "user": {
            "login": "martindurant",
            "id": 6042212,
            "node_id": "MDQ6VXNlcjYwNDIyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6042212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/martindurant",
            "html_url": "https://github.com/martindurant",
            "followers_url": "https://api.github.com/users/martindurant/followers",
            "following_url": "https://api.github.com/users/martindurant/following{/other_user}",
            "gists_url": "https://api.github.com/users/martindurant/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/martindurant/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/martindurant/subscriptions",
            "organizations_url": "https://api.github.com/users/martindurant/orgs",
            "repos_url": "https://api.github.com/users/martindurant/repos",
            "events_url": "https://api.github.com/users/martindurant/events{/privacy}",
            "received_events_url": "https://api.github.com/users/martindurant/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-11T15:00:17Z",
        "updated_at": "2022-02-11T15:00:17Z",
        "author_association": "MEMBER",
        "body": "@jakirkham , that seems like an orthogonal discussion. In the case here, the HLG is expensive to construct before even starting to send it, even though in principle the selection should result in a small graph without having to iterate over the original. So it's point 2 in my list which is the surprising omission.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1036302286/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1252729393",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1252729393",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1252729393,
        "node_id": "IC_kwDOAbcwm85KqyIx",
        "user": {
            "login": "timblakely",
            "id": 11380482,
            "node_id": "MDQ6VXNlcjExMzgwNDgy",
            "avatar_url": "https://avatars.githubusercontent.com/u/11380482?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/timblakely",
            "html_url": "https://github.com/timblakely",
            "followers_url": "https://api.github.com/users/timblakely/followers",
            "following_url": "https://api.github.com/users/timblakely/following{/other_user}",
            "gists_url": "https://api.github.com/users/timblakely/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/timblakely/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/timblakely/subscriptions",
            "organizations_url": "https://api.github.com/users/timblakely/orgs",
            "repos_url": "https://api.github.com/users/timblakely/repos",
            "events_url": "https://api.github.com/users/timblakely/events{/privacy}",
            "received_events_url": "https://api.github.com/users/timblakely/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-20T18:12:42Z",
        "updated_at": "2022-09-20T18:12:42Z",
        "author_association": "NONE",
        "body": "Ran into this as well. Was working with a 700k x 270k x 2k volume and even `__setitem__`-ing a small 5x5x5 slice was quite slow. Digging into it showed that it was enumerating >400k blocks to cull down to the single one it needed.\r\n\r\nSounds like #9216 may help, but I'm not familiar enough with the inner working of `Layer`s to know for sure. ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1252729393/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1252782366",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1252782366",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1252782366,
        "node_id": "IC_kwDOAbcwm85Kq_Ee",
        "user": {
            "login": "d-v-b",
            "id": 3805136,
            "node_id": "MDQ6VXNlcjM4MDUxMzY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3805136?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/d-v-b",
            "html_url": "https://github.com/d-v-b",
            "followers_url": "https://api.github.com/users/d-v-b/followers",
            "following_url": "https://api.github.com/users/d-v-b/following{/other_user}",
            "gists_url": "https://api.github.com/users/d-v-b/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/d-v-b/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/d-v-b/subscriptions",
            "organizations_url": "https://api.github.com/users/d-v-b/orgs",
            "repos_url": "https://api.github.com/users/d-v-b/repos",
            "events_url": "https://api.github.com/users/d-v-b/events{/privacy}",
            "received_events_url": "https://api.github.com/users/d-v-b/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-20T18:58:40Z",
        "updated_at": "2022-09-20T18:58:40Z",
        "author_association": "MEMBER",
        "body": "I'm also frequently running into this issue. In particular, slow slicing prevents dask arrays from being a performant backend for chunk-aware data visualization tools like neuroglancer. ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1252782366/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1252831261",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1252831261",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1252831261,
        "node_id": "IC_kwDOAbcwm85KrLAd",
        "user": {
            "login": "martindurant",
            "id": 6042212,
            "node_id": "MDQ6VXNlcjYwNDIyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6042212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/martindurant",
            "html_url": "https://github.com/martindurant",
            "followers_url": "https://api.github.com/users/martindurant/followers",
            "following_url": "https://api.github.com/users/martindurant/following{/other_user}",
            "gists_url": "https://api.github.com/users/martindurant/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/martindurant/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/martindurant/subscriptions",
            "organizations_url": "https://api.github.com/users/martindurant/orgs",
            "repos_url": "https://api.github.com/users/martindurant/repos",
            "events_url": "https://api.github.com/users/martindurant/events{/privacy}",
            "received_events_url": "https://api.github.com/users/martindurant/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-20T19:49:04Z",
        "updated_at": "2022-09-20T19:49:04Z",
        "author_association": "MEMBER",
        "body": "+1+1+1\r\n\r\nGiven that, conceptually, an array layer is like a dict comprehension\r\n```\r\nllg = {f\"name_{keys}\": (func, args) for keys in zip(axis_range0, axis_range1, ...)}\r\n```\r\nwhere how to make the args is layer-specific, it should be possible to cull by changing the start/stop/step of the axes ranges. We should never be materialising the full set of keys.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1252831261/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1252944144",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1252944144",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1252944144,
        "node_id": "IC_kwDOAbcwm85KrmkQ",
        "user": {
            "login": "gjoseph92",
            "id": 3309802,
            "node_id": "MDQ6VXNlcjMzMDk4MDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3309802?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/gjoseph92",
            "html_url": "https://github.com/gjoseph92",
            "followers_url": "https://api.github.com/users/gjoseph92/followers",
            "following_url": "https://api.github.com/users/gjoseph92/following{/other_user}",
            "gists_url": "https://api.github.com/users/gjoseph92/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/gjoseph92/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/gjoseph92/subscriptions",
            "organizations_url": "https://api.github.com/users/gjoseph92/orgs",
            "repos_url": "https://api.github.com/users/gjoseph92/repos",
            "events_url": "https://api.github.com/users/gjoseph92/events{/privacy}",
            "received_events_url": "https://api.github.com/users/gjoseph92/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-20T21:40:28Z",
        "updated_at": "2022-09-20T21:40:28Z",
        "author_association": "MEMBER",
        "body": "Yup, agreed this definitely shouldn't be the behavior, and the complexity of the current design makes this hard to avoid. I don't know if there's any upcoming work planned around this @jrbourbeau @ian-r-rose @rjzamora?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1252944144/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1252970524",
        "html_url": "https://github.com/dask/dask/issues/8570#issuecomment-1252970524",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8570",
        "id": 1252970524,
        "node_id": "IC_kwDOAbcwm85KrtAc",
        "user": {
            "login": "rjzamora",
            "id": 20461013,
            "node_id": "MDQ6VXNlcjIwNDYxMDEz",
            "avatar_url": "https://avatars.githubusercontent.com/u/20461013?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rjzamora",
            "html_url": "https://github.com/rjzamora",
            "followers_url": "https://api.github.com/users/rjzamora/followers",
            "following_url": "https://api.github.com/users/rjzamora/following{/other_user}",
            "gists_url": "https://api.github.com/users/rjzamora/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/rjzamora/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/rjzamora/subscriptions",
            "organizations_url": "https://api.github.com/users/rjzamora/orgs",
            "repos_url": "https://api.github.com/users/rjzamora/repos",
            "events_url": "https://api.github.com/users/rjzamora/events{/privacy}",
            "received_events_url": "https://api.github.com/users/rjzamora/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-20T22:12:50Z",
        "updated_at": "2022-09-20T22:12:50Z",
        "author_association": "MEMBER",
        "body": "> I don't know if there's any upcoming work planned around this @jrbourbeau @ian-r-rose @rjzamora?\r\n\r\nOnce serialization is simplified in https://github.com/dask/distributed/pull/6028 (or something else similar?), I'm planning to remove  the `Mapping` backend from `Layer` and remove both `Layer.cull` and `HighLevelGraph.cull` altogether.  My (strong-ish) opinion is that we should make it impossible to \"accidentally\" materialize a `Layer`, by not supporting `Mapping`-like attributes. Instead, the Layer should cull itself when it is explicitly materialized by the scheduler.  I think a simple but strict Layer API can go a long way.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1252970524/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]