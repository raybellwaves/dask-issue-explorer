{
    "url": "https://api.github.com/repos/dask/dask/issues/9434",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/9434/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/9434/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/9434/events",
    "html_url": "https://github.com/dask/dask/issues/9434",
    "id": 1351494590,
    "node_id": "I_kwDOAbcwm85Qjiu-",
    "number": 9434,
    "title": "Specifying `resources` kwarg in client.submit() prevents the job from completing",
    "user": {
        "login": "rweisman-efp",
        "id": 103955597,
        "node_id": "U_kgDOBjI8jQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/103955597?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rweisman-efp",
        "html_url": "https://github.com/rweisman-efp",
        "followers_url": "https://api.github.com/users/rweisman-efp/followers",
        "following_url": "https://api.github.com/users/rweisman-efp/following{/other_user}",
        "gists_url": "https://api.github.com/users/rweisman-efp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/rweisman-efp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rweisman-efp/subscriptions",
        "organizations_url": "https://api.github.com/users/rweisman-efp/orgs",
        "repos_url": "https://api.github.com/users/rweisman-efp/repos",
        "events_url": "https://api.github.com/users/rweisman-efp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/rweisman-efp/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 1342320181,
            "node_id": "MDU6TGFiZWwxMzQyMzIwMTgx",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20info",
            "name": "needs info",
            "color": "d0cfcc",
            "default": false,
            "description": "Needs further information from the user"
        },
        {
            "id": 3468123446,
            "node_id": "LA_kwDOAbcwm87Ot102",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20attention",
            "name": "needs attention",
            "color": "6d626c",
            "default": false,
            "description": "It's been a while since this was pushed on. Needs attention from the owner or a maintainer."
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2022-08-25T22:04:43Z",
    "updated_at": "2024-05-27T01:47:42Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!-- Please include a self-contained copy-pastable example that generates the issue if possible.\r\n\r\nPlease be concise with code posted. See guidelines below on how to provide a good bug report:\r\n\r\n- Craft Minimal Bug Reports http://matthewrocklin.com/blog/work/2018/02/28/minimal-bug-reports\r\n- Minimal Complete Verifiable Examples https://stackoverflow.com/help/mcve\r\n\r\nBug reports that follow these guidelines are easier to diagnose, and so are often handled much more quickly.\r\n-->\r\n\r\n**What happened**:\r\n- The future is put into the \"pending\" state and remains that way indefinitely.\r\n- Consequently, the call to `gather()` never returns.\r\n- No mentions of the job's existence appear in the web UI.\r\n- This behavior seems consistent regardless of how the \"MEMORY\" resource is configured on client workers (>20, <20, or not at all)\r\n\r\n**What you expected to happen**:\r\nIf \"MEMORY\" is a configured resource >=20 on at least one worker:\r\n- The job is assigned to that worker(s)\r\n- The future is put into a completed state shortly thereafter\r\n- The future's result is 42\r\n\r\nOtherwise:\r\n- The future is cancelled as the current state of the cluster will never be able to process the task given the resources available\r\n\r\n**Minimal Complete Verifiable Example**:\r\n\r\n```python\r\nfrom dask.distributed import Client\r\n\r\ndef some_task():\r\n    return 42\r\n\r\ndask_client = Client()\r\njob = dask_client.submit(some_task, resources={'MEMORY': 20})\r\ndask_client.gather(job)\r\nprint(job.result())\r\n```\r\n\r\n**Anything else we need to know?**:\r\n- Tried as well using dask annotations with same result\r\n- The issue persists even when requesting `resources={'MEMORY': 0}`\r\n- If you remove the \"resources\" kwarg entirely, this works as expected\r\n\r\n**Attempts**\r\n\r\nTried running against the local client as shown above, with no \"MEMORY\" resource configured:\r\n- The most recent log was:\r\n> distributed.scheduler - INFO - Receive client connection: Client-320f56ab-24b9-11ed-aaed-0233a8571446\r\n  - The cluster dump reports receipt of the task:\r\n```\r\n<TaskState 'some_task-b97c61448795b10cddb590d67d5cf67b' no-worker>\r\n```\r\n\r\nTried running against a cluster, whose workers were launched with the environment variable `DASK_DISTRIBUTED__WORKER__RESOURCES__MEMORY=32` per [the documentation](https://distributed.dask.org/en/stable/resources.html):\r\n- Identical symptoms\r\n\r\n**Environment**:\r\n\r\n- First try on Dask version: 2022.6.0, Python version: 3.9.7\r\n- Second try on Dask version: 2022.7.0, Python version: 3.10.4 (default install to new conda env on this distro as of writing)\r\n- Operating System: Ubuntu 20.04.4 LTS on AWS (GNU/Linux 5.13.0-1021-aws x86_64)\r\n- Install method (conda, pip, source): conda\r\n\r\n<!-- If you are reporting an issue such as scale stability, cluster deadlock.\r\nPlease provide a cluster dump state with this issue, by running client.dump_cluster_state()\r\n\r\nhttps://distributed.dask.org/en/stable/api.html?highlight=dump_cluster_state#distributed.Client.dump_cluster_state\r\n\r\n-->\r\n\r\n<details>\r\n<summary>Cluster Dump State:</summary>\r\n\r\n</details>",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/9434/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/9434/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}