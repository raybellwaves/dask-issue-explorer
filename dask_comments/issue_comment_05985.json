[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/595757369",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-595757369",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 595757369,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5NTc1NzM2OQ==",
        "user": {
            "login": "TomAugspurger",
            "id": 1312546,
            "node_id": "MDQ6VXNlcjEzMTI1NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1312546?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomAugspurger",
            "html_url": "https://github.com/TomAugspurger",
            "followers_url": "https://api.github.com/users/TomAugspurger/followers",
            "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
            "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
            "repos_url": "https://api.github.com/users/TomAugspurger/repos",
            "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-03-06T13:00:50Z",
        "updated_at": "2020-03-06T13:00:50Z",
        "author_association": "MEMBER",
        "body": "> resulting in a maximum memory usage of the size of a chunk, not that of the whole array. This seems like a possible bug?\r\n\r\nAre the results computed in parallel, leading to the high memory usage?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/595757369/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/595761338",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-595761338",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 595761338,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5NTc2MTMzOA==",
        "user": {
            "login": "astrofrog",
            "id": 314716,
            "node_id": "MDQ6VXNlcjMxNDcxNg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/314716?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/astrofrog",
            "html_url": "https://github.com/astrofrog",
            "followers_url": "https://api.github.com/users/astrofrog/followers",
            "following_url": "https://api.github.com/users/astrofrog/following{/other_user}",
            "gists_url": "https://api.github.com/users/astrofrog/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/astrofrog/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/astrofrog/subscriptions",
            "organizations_url": "https://api.github.com/users/astrofrog/orgs",
            "repos_url": "https://api.github.com/users/astrofrog/repos",
            "events_url": "https://api.github.com/users/astrofrog/events{/privacy}",
            "received_events_url": "https://api.github.com/users/astrofrog/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-03-06T13:12:20Z",
        "updated_at": "2020-03-06T13:12:20Z",
        "author_association": "CONTRIBUTOR",
        "body": "@TomAugspurger - no I still see the issue if I put:\r\n\r\n```\r\ndask.config.set(scheduler='single-threaded')\r\n```\r\n\r\nat the top\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/595761338/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/595869879",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-595869879",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 595869879,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5NTg2OTg3OQ==",
        "user": {
            "login": "astrofrog",
            "id": 314716,
            "node_id": "MDQ6VXNlcjMxNDcxNg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/314716?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/astrofrog",
            "html_url": "https://github.com/astrofrog",
            "followers_url": "https://api.github.com/users/astrofrog/followers",
            "following_url": "https://api.github.com/users/astrofrog/following{/other_user}",
            "gists_url": "https://api.github.com/users/astrofrog/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/astrofrog/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/astrofrog/subscriptions",
            "organizations_url": "https://api.github.com/users/astrofrog/orgs",
            "repos_url": "https://api.github.com/users/astrofrog/repos",
            "events_url": "https://api.github.com/users/astrofrog/events{/privacy}",
            "received_events_url": "https://api.github.com/users/astrofrog/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-03-06T17:14:50Z",
        "updated_at": "2020-03-06T17:14:50Z",
        "author_association": "CONTRIBUTOR",
        "body": "I think this might just be due to memory_profiler including the cache/buffer size in the memory usage. If I exclude cache size variations I think everything works fine.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/595869879/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/596135799",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-596135799",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 596135799,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5NjEzNTc5OQ==",
        "user": {
            "login": "d-v-b",
            "id": 3805136,
            "node_id": "MDQ6VXNlcjM4MDUxMzY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3805136?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/d-v-b",
            "html_url": "https://github.com/d-v-b",
            "followers_url": "https://api.github.com/users/d-v-b/followers",
            "following_url": "https://api.github.com/users/d-v-b/following{/other_user}",
            "gists_url": "https://api.github.com/users/d-v-b/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/d-v-b/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/d-v-b/subscriptions",
            "organizations_url": "https://api.github.com/users/d-v-b/orgs",
            "repos_url": "https://api.github.com/users/d-v-b/repos",
            "events_url": "https://api.github.com/users/d-v-b/events{/privacy}",
            "received_events_url": "https://api.github.com/users/d-v-b/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-03-07T20:44:18Z",
        "updated_at": "2020-03-07T20:44:18Z",
        "author_association": "MEMBER",
        "body": "Could it be this? https://github.com/dask/distributed/issues/3032\r\n\r\n`from_array` has confusing behavior with numpy arrays. Every resulting task will have the full original array as a dependency, regardless of how you chunk things. I think the only thing you can do is slice your numpy array, then use da.stack to combine all these sub-arrays into a larger array.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/596135799/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/596257784",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-596257784",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 596257784,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5NjI1Nzc4NA==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-03-08T22:00:23Z",
        "updated_at": "2020-03-08T22:00:23Z",
        "author_association": "MEMBER",
        "body": "> Every resulting task will have the full original array as a dependency, regardless of how you chunk things\r\n\r\nI believe that this is controllable with some of the keyword arguments to `from_array`",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/596257784/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/596259293",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-596259293",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 596259293,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5NjI1OTI5Mw==",
        "user": {
            "login": "d-v-b",
            "id": 3805136,
            "node_id": "MDQ6VXNlcjM4MDUxMzY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3805136?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/d-v-b",
            "html_url": "https://github.com/d-v-b",
            "followers_url": "https://api.github.com/users/d-v-b/followers",
            "following_url": "https://api.github.com/users/d-v-b/following{/other_user}",
            "gists_url": "https://api.github.com/users/d-v-b/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/d-v-b/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/d-v-b/subscriptions",
            "organizations_url": "https://api.github.com/users/d-v-b/orgs",
            "repos_url": "https://api.github.com/users/d-v-b/repos",
            "events_url": "https://api.github.com/users/d-v-b/events{/privacy}",
            "received_events_url": "https://api.github.com/users/d-v-b/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-03-08T22:17:38Z",
        "updated_at": "2020-03-08T22:17:38Z",
        "author_association": "MEMBER",
        "body": "which kwarg? nothing i tried in the second example over in https://github.com/dask/dask/issues/5367 made a difference in the topology of the task graph.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/596259293/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/596260357",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-596260357",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 596260357,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5NjI2MDM1Nw==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-03-08T22:30:07Z",
        "updated_at": "2020-03-08T22:30:07Z",
        "author_association": "MEMBER",
        "body": "I don't recall unfortunately.\n\nOn Sun, Mar 8, 2020 at 6:17 PM Davis Bennett <notifications@github.com>\nwrote:\n\n> which kwarg? nothing i tried in the second example over in #5367\n> <https://github.com/dask/dask/issues/5367> made a difference in the\n> topology of the task graph.\n>\n> \u2014\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/dask/dask/issues/5985?email_source=notifications&email_token=AACKZTDSHUB5GQEWBANGI4LRGQRRFA5CNFSM4LC6XLP2YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOEOFDDXI#issuecomment-596259293>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AACKZTGRK5UEMHNOXUZHUZDRGQRRFANCNFSM4LC6XLPQ>\n> .\n>\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/596260357/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/596599134",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-596599134",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 596599134,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5NjU5OTEzNA==",
        "user": {
            "login": "TomAugspurger",
            "id": 1312546,
            "node_id": "MDQ6VXNlcjEzMTI1NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1312546?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomAugspurger",
            "html_url": "https://github.com/TomAugspurger",
            "followers_url": "https://api.github.com/users/TomAugspurger/followers",
            "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
            "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
            "repos_url": "https://api.github.com/users/TomAugspurger/repos",
            "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-03-09T15:26:54Z",
        "updated_at": "2020-03-09T15:26:54Z",
        "author_association": "MEMBER",
        "body": "This seems different from https://github.com/dask/distributed/issues/3032 I think. The size of the memmapped array should be large, right?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/596599134/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828547053",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-828547053",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 828547053,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODU0NzA1Mw==",
        "user": {
            "login": "chanshing",
            "id": 5551642,
            "node_id": "MDQ6VXNlcjU1NTE2NDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5551642?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/chanshing",
            "html_url": "https://github.com/chanshing",
            "followers_url": "https://api.github.com/users/chanshing/followers",
            "following_url": "https://api.github.com/users/chanshing/following{/other_user}",
            "gists_url": "https://api.github.com/users/chanshing/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/chanshing/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/chanshing/subscriptions",
            "organizations_url": "https://api.github.com/users/chanshing/orgs",
            "repos_url": "https://api.github.com/users/chanshing/repos",
            "events_url": "https://api.github.com/users/chanshing/events{/privacy}",
            "received_events_url": "https://api.github.com/users/chanshing/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T15:24:20Z",
        "updated_at": "2021-04-28T15:24:20Z",
        "author_association": "NONE",
        "body": "What is the status of this? I have seen a related PR https://github.com/dask/dask/pull/6605 but I'm not sure if memmaps are supported (it seems not from the discussion). \r\nSometimes we may have numpy arrays stored on disk that is too big to fit in memory. Numpy handles this quite well with `np.load('bigarray.npy', mmap_mode='r')`. What is the current behavior of `da.from_array(np.load('bigarray.npy', mmap_mode='r'))`?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828547053/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1159347331",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-1159347331",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 1159347331,
        "node_id": "IC_kwDOAbcwm85FGjyD",
        "user": {
            "login": "delgadom",
            "id": 3698640,
            "node_id": "MDQ6VXNlcjM2OTg2NDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3698640?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/delgadom",
            "html_url": "https://github.com/delgadom",
            "followers_url": "https://api.github.com/users/delgadom/followers",
            "following_url": "https://api.github.com/users/delgadom/following{/other_user}",
            "gists_url": "https://api.github.com/users/delgadom/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/delgadom/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/delgadom/subscriptions",
            "organizations_url": "https://api.github.com/users/delgadom/orgs",
            "repos_url": "https://api.github.com/users/delgadom/repos",
            "events_url": "https://api.github.com/users/delgadom/events{/privacy}",
            "received_events_url": "https://api.github.com/users/delgadom/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-18T02:52:58Z",
        "updated_at": "2022-06-18T02:52:58Z",
        "author_association": "CONTRIBUTOR",
        "body": "## Current behavior\r\n\r\nthis question on SO encounters this error and I see the same behavior on 2022.04.0\r\nhttps://stackoverflow.com/questions/72663716/how-to-efficiently-convert-npy-to-xarray-zarr/72666271#72666271\r\n\r\nI'm not sure if the full workaround below is necessary, but I'm also not sure how to read the array directly from the .npy file without using map_blocks\r\n\r\nMRE:\r\n```python\r\nimport numpy as np, dask.array as dda, xarray as xr, pandas as pd, dask.distributed\r\n\r\n# save a large numpy array\r\nnp.save('myarr.npy', np.empty(shape=(47789, 310, 310), dtype=np.float32))\r\n\r\ncluster = dask.distributed.LocalCluster()\r\nclient = dask.distributed.Client(cluster)\r\n\r\nprint(cluster.dashboard_link)\r\n\r\narr = np.load('myarr.npy', mmap_mode='r')\r\nda = dda.from_array(arr).rechunk(chunks=(100, 310, 310))\r\nda.to_zarr('myarr.zarr', mode='w')\r\n```\r\n\r\nThis bottlenecks all tasks behind a giant read job \"original-array\" which consumes all system memory then dies\r\n\r\n![dask dashboard with large high-memory task](https://user-images.githubusercontent.com/3698640/174419385-fe081a1f-c58c-44ad-bbf9-07caeaf95420.png)\r\n\r\n## workaround\r\n\r\nI'm not sure if this is a bug or just points to a useful feature. For now, this works well:\r\n\r\n```python\r\nimport numpy as np, dask.array as dda, xarray as xr, pandas as pd, dask.distributed\r\n\r\ndef load_npy_chunk(da, fp, block_info=None, mmap_mode='r'):\r\n    \"\"\"Load a slice of the .npy array, making use of the block_info kwarg\"\"\"\r\n    np_mmap = np.load(fp, mmap_mode=mmap_mode)\r\n    array_location = block_info[0]['array-location']\r\n    dim_slicer = tuple(list(map(lambda x: slice(*x), array_location)))\r\n    return np_mmap[dim_slicer]\r\n\r\ndef dask_read_npy(fp, chunks=None, mmap_mode='r'):\r\n    \"\"\"Read metadata by opening the mmap, then send the read job to workers\"\"\"\r\n    np_mmap = np.load(fp, mmap_mode=mmap_mode)\r\n    da = dda.empty_like(np_mmap, chunks=chunks)\r\n    return da.map_blocks(load_npy_chunk, fp=fp, mmap_mode=mmap_mode, meta=da)\r\n\r\n# save a large numpy array\r\nnp.save('myarr.npy', np.empty(shape=(47789, 310, 310), dtype=np.float32))\r\n\r\ncluster = dask.distributed.LocalCluster()\r\nclient = dask.distributed.Client(cluster)\r\n\r\nda = dask_read_npy('myarr.npy', chunks=(300, -1, -1), mmap_mode='r')\r\nda.to_zarr('myarr.zarr', mode='w')\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1159347331/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1159352341",
        "html_url": "https://github.com/dask/dask/issues/5985#issuecomment-1159352341",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/5985",
        "id": 1159352341,
        "node_id": "IC_kwDOAbcwm85FGlAV",
        "user": {
            "login": "delgadom",
            "id": 3698640,
            "node_id": "MDQ6VXNlcjM2OTg2NDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3698640?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/delgadom",
            "html_url": "https://github.com/delgadom",
            "followers_url": "https://api.github.com/users/delgadom/followers",
            "following_url": "https://api.github.com/users/delgadom/following{/other_user}",
            "gists_url": "https://api.github.com/users/delgadom/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/delgadom/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/delgadom/subscriptions",
            "organizations_url": "https://api.github.com/users/delgadom/orgs",
            "repos_url": "https://api.github.com/users/delgadom/repos",
            "events_url": "https://api.github.com/users/delgadom/events{/privacy}",
            "received_events_url": "https://api.github.com/users/delgadom/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-18T03:31:23Z",
        "updated_at": "2022-06-19T19:07:20Z",
        "author_association": "CONTRIBUTOR",
        "body": "ok - in the above, using threads in the LocalCluster does solve the problem. This works:\r\n```python\r\nimport numpy as np, dask.array as dda, xarray as xr, pandas as pd, dask.distributed\r\n\r\n# save a large numpy array\r\nnp.save('myarr.npy', np.empty(shape=(47789, 310, 310), dtype=np.float32))\r\n\r\n# use threads, not processes\r\ncluster = dask.distributed.LocalCluster(processes=False)\r\nclient = dask.distributed.Client(cluster)\r\n\r\nprint(cluster.dashboard_link)\r\n\r\narr = np.load('myarr.npy', mmap_mode='r')\r\nda = dda.from_array(arr).rechunk(chunks=(100, 310, 310))\r\nda.to_zarr('myarr.zarr', mode='w')\r\n```\r\n\r\nBut it does seem like a read_npy function could be helpful for cases where workers can\u2019t share memory? Happy to throw this into a PR if so, though I\u2019d definitely need a hand getting it across the finish line as I imagine the test setup you\u2019d want for a new reader would be pretty extensive.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1159352341/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]