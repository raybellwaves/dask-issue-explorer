[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/931609219",
        "html_url": "https://github.com/dask/dask/issues/8172#issuecomment-931609219",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8172",
        "id": 931609219,
        "node_id": "IC_kwDOAbcwm843hzqD",
        "user": {
            "login": "jrbourbeau",
            "id": 11656932,
            "node_id": "MDQ6VXNlcjExNjU2OTMy",
            "avatar_url": "https://avatars.githubusercontent.com/u/11656932?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jrbourbeau",
            "html_url": "https://github.com/jrbourbeau",
            "followers_url": "https://api.github.com/users/jrbourbeau/followers",
            "following_url": "https://api.github.com/users/jrbourbeau/following{/other_user}",
            "gists_url": "https://api.github.com/users/jrbourbeau/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jrbourbeau/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jrbourbeau/subscriptions",
            "organizations_url": "https://api.github.com/users/jrbourbeau/orgs",
            "repos_url": "https://api.github.com/users/jrbourbeau/repos",
            "events_url": "https://api.github.com/users/jrbourbeau/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jrbourbeau/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-09-30T19:38:36Z",
        "updated_at": "2021-09-30T19:38:36Z",
        "author_association": "MEMBER",
        "body": "Thanks for raising an issue @cliffplaysdrums! Apologies for the delayed response \r\n\r\ncc @martindurant for the ` OSError: [Errno 22] The XML you provided was not well-formed or did not validate against our published schema.` part of the traceback.\r\n\r\nFor the ` RuntimeError: file metadata is only available after writer close` part, that looks similar to the issue reported in https://github.com/dask/dask/issues/7977. Would you be able to try out the patch proposed by @jorisvandenbossche here https://github.com/dask/dask/issues/7977#issuecomment-895854610?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/931609219/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/932219834",
        "html_url": "https://github.com/dask/dask/issues/8172#issuecomment-932219834",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8172",
        "id": 932219834,
        "node_id": "IC_kwDOAbcwm843kIu6",
        "user": {
            "login": "martindurant",
            "id": 6042212,
            "node_id": "MDQ6VXNlcjYwNDIyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6042212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/martindurant",
            "html_url": "https://github.com/martindurant",
            "followers_url": "https://api.github.com/users/martindurant/followers",
            "following_url": "https://api.github.com/users/martindurant/following{/other_user}",
            "gists_url": "https://api.github.com/users/martindurant/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/martindurant/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/martindurant/subscriptions",
            "organizations_url": "https://api.github.com/users/martindurant/orgs",
            "repos_url": "https://api.github.com/users/martindurant/repos",
            "events_url": "https://api.github.com/users/martindurant/events{/privacy}",
            "received_events_url": "https://api.github.com/users/martindurant/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-10-01T13:16:46Z",
        "updated_at": "2021-10-01T13:16:46Z",
        "author_association": "MEMBER",
        "body": "I think \"The XML you provided...\" happens when too many requests are in flight at once - it should probably be retried by s3fs.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/932219834/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/940405172",
        "html_url": "https://github.com/dask/dask/issues/8172#issuecomment-940405172",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8172",
        "id": 940405172,
        "node_id": "IC_kwDOAbcwm844DXG0",
        "user": {
            "login": "cliffplaysdrums",
            "id": 17258650,
            "node_id": "MDQ6VXNlcjE3MjU4NjUw",
            "avatar_url": "https://avatars.githubusercontent.com/u/17258650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/cliffplaysdrums",
            "html_url": "https://github.com/cliffplaysdrums",
            "followers_url": "https://api.github.com/users/cliffplaysdrums/followers",
            "following_url": "https://api.github.com/users/cliffplaysdrums/following{/other_user}",
            "gists_url": "https://api.github.com/users/cliffplaysdrums/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/cliffplaysdrums/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/cliffplaysdrums/subscriptions",
            "organizations_url": "https://api.github.com/users/cliffplaysdrums/orgs",
            "repos_url": "https://api.github.com/users/cliffplaysdrums/repos",
            "events_url": "https://api.github.com/users/cliffplaysdrums/events{/privacy}",
            "received_events_url": "https://api.github.com/users/cliffplaysdrums/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-10-11T20:06:51Z",
        "updated_at": "2021-10-11T20:07:03Z",
        "author_association": "NONE",
        "body": "Regarding `RuntimeError: file metadata is only available after writer close`, I'm confident that is only because the prior operation failed (which is mentioned in 7977), so even if I wanted to patch pyarrow, it won't solve the overall problem.\r\n\r\nRegarding \r\n\r\n> I think \"The XML you provided...\" happens when too many requests are in flight at once - it should probably be retried by s3fs.\r\n\r\nI find this unlikely given that it happens every time on the same dataframe but never on any of the others I've tried.\r\n\r\nI ended up working around it by writing the parquet locally (still using `df.to_parquet()`) and then manually uploading it to S3 using `boto3`. ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/940405172/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/962570013",
        "html_url": "https://github.com/dask/dask/issues/8172#issuecomment-962570013",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8172",
        "id": 962570013,
        "node_id": "IC_kwDOAbcwm845X6cd",
        "user": {
            "login": "danilopeixoto",
            "id": 10113621,
            "node_id": "MDQ6VXNlcjEwMTEzNjIx",
            "avatar_url": "https://avatars.githubusercontent.com/u/10113621?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/danilopeixoto",
            "html_url": "https://github.com/danilopeixoto",
            "followers_url": "https://api.github.com/users/danilopeixoto/followers",
            "following_url": "https://api.github.com/users/danilopeixoto/following{/other_user}",
            "gists_url": "https://api.github.com/users/danilopeixoto/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/danilopeixoto/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/danilopeixoto/subscriptions",
            "organizations_url": "https://api.github.com/users/danilopeixoto/orgs",
            "repos_url": "https://api.github.com/users/danilopeixoto/repos",
            "events_url": "https://api.github.com/users/danilopeixoto/events{/privacy}",
            "received_events_url": "https://api.github.com/users/danilopeixoto/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-07T09:18:45Z",
        "updated_at": "2021-11-07T10:42:38Z",
        "author_association": "NONE",
        "body": "I had this issue using s3fs (pyarrow or fastparquet engines) to write a dataframe with partition_size great that 5MB.\r\n\r\nI was able to write the dataframe partitions to parquet files after using `df.repartition(partition_size='5MB')`.\r\n\r\nI believe this avoid multipart uploads. When uploading a >5MB file to S3 bucket, botocore automatically splits the upload to multiple HTTP requests.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/962570013/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]