[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828565914",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828565914",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828565914,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODU2NTkxNA==",
        "user": {
            "login": "quasiben",
            "id": 1403768,
            "node_id": "MDQ6VXNlcjE0MDM3Njg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1403768?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/quasiben",
            "html_url": "https://github.com/quasiben",
            "followers_url": "https://api.github.com/users/quasiben/followers",
            "following_url": "https://api.github.com/users/quasiben/following{/other_user}",
            "gists_url": "https://api.github.com/users/quasiben/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/quasiben/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/quasiben/subscriptions",
            "organizations_url": "https://api.github.com/users/quasiben/orgs",
            "repos_url": "https://api.github.com/users/quasiben/repos",
            "events_url": "https://api.github.com/users/quasiben/events{/privacy}",
            "received_events_url": "https://api.github.com/users/quasiben/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T15:49:06Z",
        "updated_at": "2021-04-28T15:49:06Z",
        "author_association": "MEMBER",
        "body": "I ran with the following and did not see any errors:\r\n\r\n>python test-sort.py --dask-nprocs=8 --dask-nthreads=1 --dask-memlimit=10000000000 --data-dir /tmp/bzaitlen\r\n> python test-sort.py --dask-nprocs=32 --dask-nthreads=1 --dask-memlimit=10000000000 --data-dir /tmp/bzaitlen\r\n\r\nresults:\r\n\r\n```\r\nnum_nodes,nbytes,npartitions,dask_nprocs,dask_nthreads,dask_memlimit,duration\r\n1,1000000,100,8,1,10000000000,1.0982487201690674\r\n1,1000000,100,8,1,10000000000,0.9893317222595215\r\n1,1000000,100,8,1,10000000000,1.1653563976287842\r\n1,1000000,100,8,1,10000000000,1.0320801734924316\r\n1,1000000,100,8,1,10000000000,1.0052003860473633\r\n1,1000000,100,8,1,10000000000,1.0402514934539795\r\n1,1000000,100,8,1,10000000000,1.110060214996338\r\n1,1000000,100,8,1,10000000000,1.0987215042114258\r\n1,1000000,100,8,1,10000000000,1.0460119247436523\r\n1,1000000,100,8,1,10000000000,1.1311535835266113\r\n1,1000000,100,32,1,10000000000,1.01358962059021\r\n1,1000000,100,32,1,10000000000,0.9143905639648438\r\n1,1000000,100,32,1,10000000000,0.8085291385650635\r\n1,1000000,100,32,1,10000000000,0.7534053325653076\r\n1,1000000,100,32,1,10000000000,0.796821117401123\r\n1,1000000,100,32,1,10000000000,0.7891464233398438\r\n1,1000000,100,32,1,10000000000,0.7381155490875244\r\n1,1000000,100,32,1,10000000000,0.7748186588287354\r\n1,1000000,100,32,1,10000000000,0.7413227558135986\r\n1,1000000,100,32,1,10000000000,0.7646501064300537\r\n```\r\n\r\nThis was done on a DGX1 which has 1.5TB of RAM and an 2 Intel Xeons",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828565914/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828596354",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828596354",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828596354,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODU5NjM1NA==",
        "user": {
            "login": "stephanie-wang",
            "id": 2560516,
            "node_id": "MDQ6VXNlcjI1NjA1MTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stephanie-wang",
            "html_url": "https://github.com/stephanie-wang",
            "followers_url": "https://api.github.com/users/stephanie-wang/followers",
            "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
            "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
            "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
            "repos_url": "https://api.github.com/users/stephanie-wang/repos",
            "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T16:29:17Z",
        "updated_at": "2021-04-28T16:29:17Z",
        "author_association": "NONE",
        "body": "Thanks for looking into this, @quasiben! A few things:\r\n1. Can you try running the script again with `--nbytes=$(( 10 ** 11 ))` for 100GB? The default actually runs with only 1GB (you can check by looking at the nbytes column in the CSV).\r\n2. Are you starting Dask separately? The dask args for the script I provided are a bit misleading; they're just for recording and don't actually set the `dask-worker` parameters.\r\n3. I'm not sure if the results will be the same since your machine has 10x the amount of RAM as the one I was testing on. Maybe you could also try scaling up the script to 1TB if you don't see any errors still with 100GB?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828596354/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828677688",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828677688",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828677688,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODY3NzY4OA==",
        "user": {
            "login": "quasiben",
            "id": 1403768,
            "node_id": "MDQ6VXNlcjE0MDM3Njg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1403768?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/quasiben",
            "html_url": "https://github.com/quasiben",
            "followers_url": "https://api.github.com/users/quasiben/followers",
            "following_url": "https://api.github.com/users/quasiben/following{/other_user}",
            "gists_url": "https://api.github.com/users/quasiben/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/quasiben/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/quasiben/subscriptions",
            "organizations_url": "https://api.github.com/users/quasiben/orgs",
            "repos_url": "https://api.github.com/users/quasiben/repos",
            "events_url": "https://api.github.com/users/quasiben/events{/privacy}",
            "received_events_url": "https://api.github.com/users/quasiben/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T18:22:24Z",
        "updated_at": "2021-04-28T18:22:24Z",
        "author_association": "MEMBER",
        "body": "Unfortunately, I don't have more time today to test.  You could try changing the other memory config values and see if that prevents workers from dying.  For example, you could set the workers to spill earlier.  This can be done with an inline environment variable when starting the dask-worker `DASK_DISTRIBUTED__WORKER__MEMORY__SPILL=0.5` or additional methods outlined [here](https://docs.dask.org/en/latest/configuration.html#conversion-utility) ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828677688/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828681426",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828681426",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828681426,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODY4MTQyNg==",
        "user": {
            "login": "stephanie-wang",
            "id": 2560516,
            "node_id": "MDQ6VXNlcjI1NjA1MTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stephanie-wang",
            "html_url": "https://github.com/stephanie-wang",
            "followers_url": "https://api.github.com/users/stephanie-wang/followers",
            "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
            "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
            "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
            "repos_url": "https://api.github.com/users/stephanie-wang/repos",
            "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T18:28:05Z",
        "updated_at": "2021-04-28T18:28:05Z",
        "author_association": "NONE",
        "body": "Thanks! Previously I tried lowering the \"target\" and \"spill\" values described [here](https://distributed.dask.org/en/latest/worker.html#memory-management) (I think to 30% and 40% respectively), but that didn't seem to change anything. Is that the same as what you're suggesting?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828681426/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828705571",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828705571",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828705571,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODcwNTU3MQ==",
        "user": {
            "login": "jakirkham",
            "id": 3019665,
            "node_id": "MDQ6VXNlcjMwMTk2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jakirkham",
            "html_url": "https://github.com/jakirkham",
            "followers_url": "https://api.github.com/users/jakirkham/followers",
            "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
            "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
            "organizations_url": "https://api.github.com/users/jakirkham/orgs",
            "repos_url": "https://api.github.com/users/jakirkham/repos",
            "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jakirkham/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T19:02:40Z",
        "updated_at": "2021-04-28T19:02:40Z",
        "author_association": "MEMBER",
        "body": "It looks like the Dask version being used here is quite old. Have you tried with a more recent version of Dask + Distributed?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828705571/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828717695",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828717695",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828717695,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODcxNzY5NQ==",
        "user": {
            "login": "stephanie-wang",
            "id": 2560516,
            "node_id": "MDQ6VXNlcjI1NjA1MTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stephanie-wang",
            "html_url": "https://github.com/stephanie-wang",
            "followers_url": "https://api.github.com/users/stephanie-wang/followers",
            "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
            "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
            "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
            "repos_url": "https://api.github.com/users/stephanie-wang/repos",
            "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T19:23:05Z",
        "updated_at": "2021-04-28T19:23:05Z",
        "author_association": "NONE",
        "body": "> It looks like the Dask version being used here is quite old. Have you tried with a more recent version of Dask + Distributed?\r\n\r\nAh, my bad! I just upgraded to 2021.4.1 and tried again. The error messages are different but it seems like the overall behavior is about the same ([exception](https://gist.github.com/stephanie-wang/f4d061ca237837f79069807cf88e6c14#file-stdout-128gb-ram-10gb-dataset-100mb-partitions-memory-limit-auto) on 10GB with nprocs=32, succeeds on 10GB with nprocs=8, [exception](https://gist.github.com/stephanie-wang/f4d061ca237837f79069807cf88e6c14#file-stdout-128gb-ram-100gb-dataset-1gb-partitions-memory-limit-10gb-nprocs-8) on 100GB with nprocs=8).\r\n\r\nI updated the issue description accordingly. It does look like the script now crashes reliably instead of hanging. I'll try adjusting the memory parameters for this version of dask too and report back.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828717695/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828722712",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828722712",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828722712,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODcyMjcxMg==",
        "user": {
            "login": "jakirkham",
            "id": 3019665,
            "node_id": "MDQ6VXNlcjMwMTk2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jakirkham",
            "html_url": "https://github.com/jakirkham",
            "followers_url": "https://api.github.com/users/jakirkham/followers",
            "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
            "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
            "organizations_url": "https://api.github.com/users/jakirkham/orgs",
            "repos_url": "https://api.github.com/users/jakirkham/repos",
            "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jakirkham/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T19:31:49Z",
        "updated_at": "2021-04-28T19:31:49Z",
        "author_association": "MEMBER",
        "body": "Sounds good.\r\n\r\nSomething else to note is we do use pickle protocol 5 on Python 3.8+ (or Python 3.7 with the `pickle5` backport package). This allows for zero-copy serialization of objects using pickle (like Pandas DataFrames), which impacts spilling and communication. Would suggest either using Python 3.8+ (if it is an option for you) or installing `pickle5` on Python 3.7. ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828722712/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828776021",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828776021",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828776021,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODc3NjAyMQ==",
        "user": {
            "login": "stephanie-wang",
            "id": 2560516,
            "node_id": "MDQ6VXNlcjI1NjA1MTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stephanie-wang",
            "html_url": "https://github.com/stephanie-wang",
            "followers_url": "https://api.github.com/users/stephanie-wang/followers",
            "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
            "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
            "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
            "repos_url": "https://api.github.com/users/stephanie-wang/repos",
            "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T20:59:14Z",
        "updated_at": "2021-04-28T20:59:36Z",
        "author_association": "NONE",
        "body": "Hmm yes I saw the same error for 100GB, nprocs=8 after changing the memory target parameters. Just to confirm, I'm doing this by writing this in the `~/.config/dask/distributed.yaml` file (I tried target=10%, spill=20% and target=30%, spill=40%):\r\n```yaml\r\ndistributed:\r\n   worker:\r\n     # Fractions of worker memory at which we take action to avoid memory blowup\r\n     # Set any of the lower three values to False to turn off the behavior entirely\r\n     memory:\r\n       target: 0.10  # target fraction to stay below\r\n       spill: 0.20  # fraction at which we spill to disk\r\n       pause: 0.80  # fraction at which we pause worker threads\r\n       terminate: 0.95  # fraction at which we terminate the worker\r\n```\r\n\r\nI'm also trying the 100GB sort with 1000 100MB partitions instead of 100 1GB partitions right now (nprocs=8, memory-limit=10GB). I don't see any errors, but it's taken >1h so far. Does that seem right?\r\n\r\nThanks for the tip on pickle5, I'll try to get a version running with 3.8!",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828776021/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828777305",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828777305",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828777305,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODc3NzMwNQ==",
        "user": {
            "login": "jakirkham",
            "id": 3019665,
            "node_id": "MDQ6VXNlcjMwMTk2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jakirkham",
            "html_url": "https://github.com/jakirkham",
            "followers_url": "https://api.github.com/users/jakirkham/followers",
            "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
            "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
            "organizations_url": "https://api.github.com/users/jakirkham/orgs",
            "repos_url": "https://api.github.com/users/jakirkham/repos",
            "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jakirkham/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T21:01:14Z",
        "updated_at": "2021-04-28T21:01:14Z",
        "author_association": "MEMBER",
        "body": "Let's wait to dig in further until pickle protocol 5 is used. Wouldn't be surprised if additional copies created when pickling with earlier protocols are causing us issues",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828777305/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828785722",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828785722",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828785722,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODc4NTcyMg==",
        "user": {
            "login": "stephanie-wang",
            "id": 2560516,
            "node_id": "MDQ6VXNlcjI1NjA1MTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stephanie-wang",
            "html_url": "https://github.com/stephanie-wang",
            "followers_url": "https://api.github.com/users/stephanie-wang/followers",
            "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
            "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
            "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
            "repos_url": "https://api.github.com/users/stephanie-wang/repos",
            "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T21:16:36Z",
        "updated_at": "2021-04-28T21:16:36Z",
        "author_association": "NONE",
        "body": "Unfortunately I'm still seeing similar errors after switching to python=3.8.8. I was seeing that data was getting spilled to disk (I think ~20GB before the crash).\r\n\r\nThis was with nprocs=8, nthreads=1, memory-limit=10GB and the default parameters for target memory. Should I try a different configuration?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828785722/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828839444",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828839444",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828839444,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODgzOTQ0NA==",
        "user": {
            "login": "rjzamora",
            "id": 20461013,
            "node_id": "MDQ6VXNlcjIwNDYxMDEz",
            "avatar_url": "https://avatars.githubusercontent.com/u/20461013?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rjzamora",
            "html_url": "https://github.com/rjzamora",
            "followers_url": "https://api.github.com/users/rjzamora/followers",
            "following_url": "https://api.github.com/users/rjzamora/following{/other_user}",
            "gists_url": "https://api.github.com/users/rjzamora/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/rjzamora/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/rjzamora/subscriptions",
            "organizations_url": "https://api.github.com/users/rjzamora/orgs",
            "repos_url": "https://api.github.com/users/rjzamora/repos",
            "events_url": "https://api.github.com/users/rjzamora/events{/privacy}",
            "received_events_url": "https://api.github.com/users/rjzamora/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-28T23:13:50Z",
        "updated_at": "2021-04-29T00:57:14Z",
        "author_association": "MEMBER",
        "body": "Thank you for sharing your benchmarking efforts here @stephanie-wang!  It is great to see.\u2028\u2028\r\n\r\n~I am not surprised that set_index is a bit fragile for a 10x bytes-to-memory ratio~.  We have pushed on memory optimizations a bit more for the shuffle code path compared to set_index.  However, both of these shuffle-based algorithms are likely to become dominated by spilling once the total size of the dataset is ~significantly~ larger than the global memory.  With that said, you *should* be able to get the 100GB case working with ~10GB~ 80GB of memory (although performance will be poor ~if your disk/file-system are slow~).\r\n\r\n\u2028\u2028If you are having memory problems with the default settings of `dask-worker` (killed workers, etc_) then:\r\n\r\n(1) First try reducing your partition size.  If 1GB partitions are giving you problems, try 500MB or 250MB\r\n(2) If going down to 250MB is still fragile, you should then try decreasing the default spilling thresholds.  For example, something like `memory_target_fraction=0.2`, `memory_spill_fraction=0.4`, and `memory_pause_fraction=0.6` would be quite conservative (and should probably work) ~if your partition size is small enough to hold 5 partitions in memory on each worker~.\r\n(3) Check that you are using a fast/reliable storage space for spilling by setting `local_directory`.\u2028\u2028\r\n\r\nNote that I typically use `LocalCluster` to simplify things when I am testing on a single machine.  So, I have something like the following in mind for the cluster:\r\n\r\n```python\r\nfrom dask.distributed import LocalCluster\r\n\r\ncluster = LocalCluster(\r\n    n_workers=8,\r\n    threads_per_worker=1,\r\n    memory_limit=1e10,\r\n    memory_target_fraction=0.2,\r\n    memory_spill_fraction=0.4,\r\n    memory_pause_fraction=0.6,\r\n    local_directory=\"/datasets/rzamora/scratch/dask-space\",\r\n)\r\n```\r\n\r\nI\u2019ll try to test things out locally soon and let you know what I find.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828839444/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828855492",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828855492",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828855492,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODg1NTQ5Mg==",
        "user": {
            "login": "jakirkham",
            "id": 3019665,
            "node_id": "MDQ6VXNlcjMwMTk2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jakirkham",
            "html_url": "https://github.com/jakirkham",
            "followers_url": "https://api.github.com/users/jakirkham/followers",
            "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
            "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
            "organizations_url": "https://api.github.com/users/jakirkham/orgs",
            "repos_url": "https://api.github.com/users/jakirkham/repos",
            "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jakirkham/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-29T00:02:19Z",
        "updated_at": "2021-04-29T00:02:19Z",
        "author_association": "MEMBER",
        "body": "This might also be a use case that benefits from some of the spilling optimizations that we've done in RAPIDS (cc @madsbk \ud83d\ude42)",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828855492/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828861874",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828861874",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828861874,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODg2MTg3NA==",
        "user": {
            "login": "stephanie-wang",
            "id": 2560516,
            "node_id": "MDQ6VXNlcjI1NjA1MTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stephanie-wang",
            "html_url": "https://github.com/stephanie-wang",
            "followers_url": "https://api.github.com/users/stephanie-wang/followers",
            "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
            "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
            "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
            "repos_url": "https://api.github.com/users/stephanie-wang/repos",
            "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-29T00:19:25Z",
        "updated_at": "2021-04-29T00:19:25Z",
        "author_association": "NONE",
        "body": "Thanks, this is really helpful! I think this is approximately what I've been trying, but it's really helpful to get confirmation that this is the right way to go about it.\r\n\r\nJust to clarify (since I'm not very familiar with the `dask-worker` settings), regarding this:\r\n> I am not surprised that set_index is a bit fragile for a 10x bytes-to-memory ratio. We have pushed on memory optimizations a bit more for the shuffle code path compared to set_index. However, both of these shuffle-based algorithms are likely to become dominated by spilling once the total size of the dataset is significantly larger than the global memory. With that said, you should be able to get the 100GB case working with 10GB of memory (although performance will be poor if your disk/file-system are slow).\r\n\r\nI thought that by running `dask-worker --nprocs=8 --nthreads=1 --memory-limit=$(( 10 ** 10 ))`, this would give each *process* a memory limit of 10GB, for a total of 80GB. Or does this actually mean a total of 10GB for all 8 workers? I've since lost the stdout, but I think I do remember seeing several messages about a worker process being started with ~9GB of memory, so I've thought it was the former.\r\n\r\nIf you do get around to running this script, here is the command I've been using for 100GB, 100 partitions (note that the version of the script that I posted assumes that dask is already started with the same worker parameters):\r\n```bash\r\npython test_sort.py --nbytes=$(( 10 ** 11 )) --npartitions=100 --data-dir=/data --dask-nprocs=8 --dask-nthreads=1 --dask-memlimit=$(( 10 ** 10 ))\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828861874/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/828873910",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-828873910",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 828873910,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgyODg3MzkxMA==",
        "user": {
            "login": "rjzamora",
            "id": 20461013,
            "node_id": "MDQ6VXNlcjIwNDYxMDEz",
            "avatar_url": "https://avatars.githubusercontent.com/u/20461013?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rjzamora",
            "html_url": "https://github.com/rjzamora",
            "followers_url": "https://api.github.com/users/rjzamora/followers",
            "following_url": "https://api.github.com/users/rjzamora/following{/other_user}",
            "gists_url": "https://api.github.com/users/rjzamora/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/rjzamora/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/rjzamora/subscriptions",
            "organizations_url": "https://api.github.com/users/rjzamora/orgs",
            "repos_url": "https://api.github.com/users/rjzamora/repos",
            "events_url": "https://api.github.com/users/rjzamora/events{/privacy}",
            "received_events_url": "https://api.github.com/users/rjzamora/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-29T00:50:40Z",
        "updated_at": "2021-04-29T00:50:40Z",
        "author_association": "MEMBER",
        "body": ">this would give each process a memory limit of 10GB, for a total of 80GB\r\n\r\nAh right - My mistake!  You are correct that you are giving each worker a 10GB limit.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/828873910/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/850590942",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-850590942",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 850590942,
        "node_id": "MDEyOklzc3VlQ29tbWVudDg1MDU5MDk0Mg==",
        "user": {
            "login": "stephanie-wang",
            "id": 2560516,
            "node_id": "MDQ6VXNlcjI1NjA1MTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stephanie-wang",
            "html_url": "https://github.com/stephanie-wang",
            "followers_url": "https://api.github.com/users/stephanie-wang/followers",
            "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
            "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
            "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
            "repos_url": "https://api.github.com/users/stephanie-wang/repos",
            "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-05-28T18:22:17Z",
        "updated_at": "2021-05-28T18:22:17Z",
        "author_association": "NONE",
        "body": "Just a quick update on this. I tried 100GB with nprocs=32, 1000 partitions (since 100 wasn't working), and the recommended memory thresholds. I got a slightly different error this time. It still exited with a `KilledWorker` exception, but there were also some messages about the scheduler becoming unresponsive. Hopefully this is helpful! You can see the relevant output [here](https://gist.github.com/stephanie-wang/f4d061ca237837f79069807cf88e6c14#file-stdout-244gb-ram-100gb-dataset-100mb-partitions-memory-limit-auto).",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/850590942/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/943091399",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-943091399",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 943091399,
        "node_id": "IC_kwDOAbcwm844Nm7H",
        "user": {
            "login": "GenevieveBuckley",
            "id": 30920819,
            "node_id": "MDQ6VXNlcjMwOTIwODE5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30920819?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/GenevieveBuckley",
            "html_url": "https://github.com/GenevieveBuckley",
            "followers_url": "https://api.github.com/users/GenevieveBuckley/followers",
            "following_url": "https://api.github.com/users/GenevieveBuckley/following{/other_user}",
            "gists_url": "https://api.github.com/users/GenevieveBuckley/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/GenevieveBuckley/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/GenevieveBuckley/subscriptions",
            "organizations_url": "https://api.github.com/users/GenevieveBuckley/orgs",
            "repos_url": "https://api.github.com/users/GenevieveBuckley/repos",
            "events_url": "https://api.github.com/users/GenevieveBuckley/events{/privacy}",
            "received_events_url": "https://api.github.com/users/GenevieveBuckley/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-10-14T07:32:32Z",
        "updated_at": "2021-10-14T07:32:51Z",
        "author_association": "MEMBER",
        "body": "@stephanie-wang just to let you know, there's quite a bit of work going on behind the scenes on improving Dask dataframe shuffles. I don't think https://github.com/dask/dask/pull/8223 is intended to be runnable (is that right @gjoseph92?) but you might like to subscribe to that PR for updates.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/943091399/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/944404326",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-944404326",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 944404326,
        "node_id": "IC_kwDOAbcwm844Sndm",
        "user": {
            "login": "gjoseph92",
            "id": 3309802,
            "node_id": "MDQ6VXNlcjMzMDk4MDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3309802?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/gjoseph92",
            "html_url": "https://github.com/gjoseph92",
            "followers_url": "https://api.github.com/users/gjoseph92/followers",
            "following_url": "https://api.github.com/users/gjoseph92/following{/other_user}",
            "gists_url": "https://api.github.com/users/gjoseph92/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/gjoseph92/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/gjoseph92/subscriptions",
            "organizations_url": "https://api.github.com/users/gjoseph92/orgs",
            "repos_url": "https://api.github.com/users/gjoseph92/repos",
            "events_url": "https://api.github.com/users/gjoseph92/events{/privacy}",
            "received_events_url": "https://api.github.com/users/gjoseph92/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-10-15T15:44:09Z",
        "updated_at": "2021-10-15T15:44:09Z",
        "author_association": "MEMBER",
        "body": "Hey @stephanie-wang, nice to see you again! Yeah, I think https://github.com/dask/dask/pull/8223 will be interesting to you. We also have a blog post about some of the technical details: https://coiled.io/blog/better-shuffling-in-dask-a-proof-of-concept/. Could be a natural fit to recreate some of this with actors, though locality might be awkward. I'd be curious how it compares to the multi-output shuffle in ray (probably a lot slower right now, but hopefully it would at least succeed).",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/944404326/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/947120651",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-947120651",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 947120651,
        "node_id": "IC_kwDOAbcwm844c-oL",
        "user": {
            "login": "stephanie-wang",
            "id": 2560516,
            "node_id": "MDQ6VXNlcjI1NjA1MTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stephanie-wang",
            "html_url": "https://github.com/stephanie-wang",
            "followers_url": "https://api.github.com/users/stephanie-wang/followers",
            "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
            "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
            "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
            "repos_url": "https://api.github.com/users/stephanie-wang/repos",
            "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-10-19T21:29:40Z",
        "updated_at": "2021-10-19T21:29:40Z",
        "author_association": "NONE",
        "body": "Hey all, thanks for the update! The blog post that you linked looks very interesting. We've taken a pretty different approach in Ray where we are trying to implement shuffle natively with tasks, without \"bypassing\" the core system. I agree, it would be great to see how these compare.\r\n\r\nWe ended up writing a blog post about some of those earlier results [here](https://medium.com/distributed-computing-with-ray/analyzing-memory-management-and-performance-in-dask-on-ray-930a2236b70d). I'd be happy to update it or link to your blog post once you have results that you're happy with in the new Dask-based shuffle!",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/947120651/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/952286052",
        "html_url": "https://github.com/dask/dask/issues/7613#issuecomment-952286052",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7613",
        "id": 952286052,
        "node_id": "IC_kwDOAbcwm844wrtk",
        "user": {
            "login": "gjoseph92",
            "id": 3309802,
            "node_id": "MDQ6VXNlcjMzMDk4MDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3309802?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/gjoseph92",
            "html_url": "https://github.com/gjoseph92",
            "followers_url": "https://api.github.com/users/gjoseph92/followers",
            "following_url": "https://api.github.com/users/gjoseph92/following{/other_user}",
            "gists_url": "https://api.github.com/users/gjoseph92/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/gjoseph92/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/gjoseph92/subscriptions",
            "organizations_url": "https://api.github.com/users/gjoseph92/orgs",
            "repos_url": "https://api.github.com/users/gjoseph92/repos",
            "events_url": "https://api.github.com/users/gjoseph92/events{/privacy}",
            "received_events_url": "https://api.github.com/users/gjoseph92/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-10-26T20:10:43Z",
        "updated_at": "2021-10-26T20:10:43Z",
        "author_association": "MEMBER",
        "body": "Yeah, it would be much nicer to not bypass the core system. The one thing with tasks is that it's inherently `O(N^2)` in graph size (without a way to describe a key as having multiple outputs, which isn't possible in the dask graph spec). So with, say, a 100,000-partition DataFrame (large but possible) you'd have 10 billion tasks for the shuffle. That's clearly way beyond distributed's capacity, and I'd imagine even Ray would struggle a bit at that scale? In general graphs are just an annoying way to represent a shuffle.\r\n\r\nThough for Ray, you could probably keep an `O(N)` graph size by eliminating the [`multiple_return_get`s](https://github.com/ray-project/ray/blob/99a00882337e85589a8fbc193b8ec77846a4dd6a/python/ray/util/dask/optimizations.py#L85-L89) from the graph, and instead launching tasks-within-tasks, which lets you hide the N^2 part from dask by taking more advantage of Ray's multiple-return support, at the expense of a little more indirection.\r\n```python\r\nremote_shuffle_group = ray.remote(shuffle_group)\r\n\r\ndef split(part: DataFrame) -> Tuple[ObjectID, ...]:\r\n    return remote_shuffle_group.options(num_returns=n_parts_out).remote(part)\r\n\r\ndef group(i: int, object_ids: List[Tuple[ObjectID, ...]]) -> DataFrame:\r\n    return _concat(ray.get([ids[i] for ids in object_ids]))\r\n\r\ndsk = {}\r\nfor i in range(npartitions_input):\r\n    dsk[(shuffle_split_name, i) = (split, name_input, i)\r\nall_split_objectids = list(dsk)\r\nfor i in range(n_parts_out):\r\n    dsk[(shuffle_group_name, i) = (group, i, all_split_objectids)\r\n```\r\nYou'd still have `O(N^2)` ObjectIDs, but only `O(N)` TaskIDs, which maybe would be preferable?\r\n\r\nJust writing this up because it's maybe an interesting route we could consider in distributed as well (tasks-within-tasks in some way), which might be a little less \"bypass-y\" than https://github.com/dask/dask/pull/8223.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/952286052/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]