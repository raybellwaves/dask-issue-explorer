{
    "url": "https://api.github.com/repos/dask/dask/issues/5299",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/5299/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/5299/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/5299/events",
    "html_url": "https://github.com/dask/dask/issues/5299",
    "id": 482888662,
    "node_id": "MDU6SXNzdWU0ODI4ODg2NjI=",
    "number": 5299,
    "title": "BUG: Inline makes N^2 calls to subs.",
    "user": {
        "login": "mpeaton",
        "id": 823569,
        "node_id": "MDQ6VXNlcjgyMzU2OQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/823569?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mpeaton",
        "html_url": "https://github.com/mpeaton",
        "followers_url": "https://api.github.com/users/mpeaton/followers",
        "following_url": "https://api.github.com/users/mpeaton/following{/other_user}",
        "gists_url": "https://api.github.com/users/mpeaton/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mpeaton/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mpeaton/subscriptions",
        "organizations_url": "https://api.github.com/users/mpeaton/orgs",
        "repos_url": "https://api.github.com/users/mpeaton/repos",
        "events_url": "https://api.github.com/users/mpeaton/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mpeaton/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2019-08-20T14:15:45Z",
    "updated_at": "2019-09-17T16:38:05Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "The following function, when profile using %prun results in N^2+N calls to subs()\r\n\r\n```def get_task(n, client):\r\n    futs = client.map(int, [random.random() for _ in range(n)])\r\n    z = str(uuid.uuid4())\r\n    dsk = {z: (sum, list(fut.key for fut in futs))}\r\n    for fut in futs:\r\n        dsk[fut.key] = fut\r\n\r\n    return Delayed(z, dsk)\r\n```\r\nfor example, n=50:\r\n``` \r\n         6629 function calls (3910 primitive calls) in 0.048 seconds\r\n\r\n   Ordered by: cumulative time\r\n   List reduced from 226 to 50 due to restriction <50>\r\n\r\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\r\n        1    0.000    0.000    0.048    0.048 {built-in method builtins.exec}\r\n        1    0.000    0.000    0.047    0.047 <string>:1(<module>)\r\n        1    0.000    0.000    0.047    0.047 base.py:151(compute)\r\n        1    0.000    0.000    0.047    0.047 base.py:391(compute)\r\n        1    0.000    0.000    0.047    0.047 client.py:2275(get)\r\n        1    0.000    0.000    0.044    0.044 client.py:1591(gather)\r\n        1    0.000    0.000    0.044    0.044 client.py:666(sync)\r\n        1    0.000    0.000    0.044    0.044 utils.py:236(sync)\r\n        1    0.000    0.000    0.044    0.044 threading.py:534(wait)\r\n        1    0.000    0.000    0.044    0.044 threading.py:264(wait)\r\n        4    0.044    0.011    0.044    0.011 {method 'acquire' of '_thread.lock' objects}\r\n        1    0.000    0.000    0.003    0.003 client.py:2195(_graph_to_futures)\r\n        1    0.000    0.000    0.002    0.002 optimization.py:233(inline)\r\n  2550/50    0.001    0.000    0.001    0.000 core.py:277(subs)```",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/5299/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/5299/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}