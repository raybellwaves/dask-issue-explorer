[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/395562699",
        "html_url": "https://github.com/dask/dask/issues/3557#issuecomment-395562699",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/3557",
        "id": 395562699,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTU2MjY5OQ==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2018-06-07T20:58:19Z",
        "updated_at": "2018-06-07T20:58:19Z",
        "author_association": "MEMBER",
        "body": "Out of curiosity is this causing performance degradation somewhere, or is it just for general cleanliness?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/395562699/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/395596956",
        "html_url": "https://github.com/dask/dask/issues/3557#issuecomment-395596956",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/3557",
        "id": 395596956,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTU5Njk1Ng==",
        "user": {
            "login": "crusaderky",
            "id": 6213168,
            "node_id": "MDQ6VXNlcjYyMTMxNjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6213168?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/crusaderky",
            "html_url": "https://github.com/crusaderky",
            "followers_url": "https://api.github.com/users/crusaderky/followers",
            "following_url": "https://api.github.com/users/crusaderky/following{/other_user}",
            "gists_url": "https://api.github.com/users/crusaderky/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/crusaderky/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/crusaderky/subscriptions",
            "organizations_url": "https://api.github.com/users/crusaderky/orgs",
            "repos_url": "https://api.github.com/users/crusaderky/repos",
            "events_url": "https://api.github.com/users/crusaderky/events{/privacy}",
            "received_events_url": "https://api.github.com/users/crusaderky/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2018-06-07T23:26:07Z",
        "updated_at": "2018-06-07T23:26:07Z",
        "author_association": "MEMBER",
        "body": "Firstly, it causes the dask graph to be slower to pickle and to optimize. \r\nAs for performance at graph resolution time, I don't expect it to have a _big_ impact in and by itself. However I've already measured (last post in #3549) how just removing _all_ of these small inefficiencies gave me a massive 32% speed boost in one use case.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/395596956/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/435645698",
        "html_url": "https://github.com/dask/dask/issues/3557#issuecomment-435645698",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/3557",
        "id": 435645698,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQzNTY0NTY5OA==",
        "user": {
            "login": "jakirkham",
            "id": 3019665,
            "node_id": "MDQ6VXNlcjMwMTk2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jakirkham",
            "html_url": "https://github.com/jakirkham",
            "followers_url": "https://api.github.com/users/jakirkham/followers",
            "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
            "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
            "organizations_url": "https://api.github.com/users/jakirkham/orgs",
            "repos_url": "https://api.github.com/users/jakirkham/repos",
            "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jakirkham/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2018-11-04T06:27:35Z",
        "updated_at": "2018-11-04T06:27:35Z",
        "author_association": "MEMBER",
        "body": "Have you tried things like this (particularly with more recent versions of Dask)?\r\n\r\n```python\r\nimport dask.array as da\r\n\r\na = da.arange(2, chunks=2).sum()\r\na = da.Array(\r\n    da.Array.__dask_optimize__(\r\n        a.__dask_graph__(),\r\n        a.__dask_keys__()\r\n    ),\r\n    a.name,\r\n    a.chunks,\r\n    a.dtype\r\n)\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/435645698/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/487539001",
        "html_url": "https://github.com/dask/dask/issues/3557#issuecomment-487539001",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/3557",
        "id": 487539001,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NzUzOTAwMQ==",
        "user": {
            "login": "crusaderky",
            "id": 6213168,
            "node_id": "MDQ6VXNlcjYyMTMxNjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6213168?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/crusaderky",
            "html_url": "https://github.com/crusaderky",
            "followers_url": "https://api.github.com/users/crusaderky/followers",
            "following_url": "https://api.github.com/users/crusaderky/following{/other_user}",
            "gists_url": "https://api.github.com/users/crusaderky/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/crusaderky/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/crusaderky/subscriptions",
            "organizations_url": "https://api.github.com/users/crusaderky/orgs",
            "repos_url": "https://api.github.com/users/crusaderky/repos",
            "events_url": "https://api.github.com/users/crusaderky/events{/privacy}",
            "received_events_url": "https://api.github.com/users/crusaderky/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-04-29T11:05:10Z",
        "updated_at": "2019-04-29T11:11:47Z",
        "author_association": "MEMBER",
        "body": "@mrocklin @jakirkham sorry for the long silence.\r\n\r\nAs of dask 1.2, I can see there is still a good deal of space for optimization:\r\n```\r\nfrom functools import partial\r\nfrom toolz.functoolz import compose\r\nimport dask.array as da\r\nimport numpy as np\r\n\r\na = da.arange(2, chunks=2).sum()\r\n\r\nb = da.Array(\r\n    da.Array.__dask_optimize__(\r\n        a.__dask_graph__(),\r\n        a.__dask_keys__()\r\n    ),\r\n    a.name, a.chunks, a.dtype)\r\n\r\nc = da.Array(\r\n    dask={('c', ): (compose(np.sum, partial(np.arange, 0, 2, dtype='int64')), )}, \r\n    name='c', shape=(), chunks=(), dtype='int64')\r\n\r\n%timeit a.compute(optimize=False, scheduler='sync')\r\n463 \u00b5s \u00b1 3.46 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\r\n%timeit b.compute(optimize=False, scheduler='sync')\r\n350 \u00b5s \u00b1 3.63 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\r\n%timeit c.compute(optimize=False, scheduler='sync')\r\n237 \u00b5s \u00b1 19.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\r\n```\r\n\r\nThe difference between b and c is broken down as follows:\r\n1. b contains 2 keys, of which 1 is redundant:\r\n```\r\ndict(b.dask)\r\nOut[44]: \r\n{('sum-aggregate-19caf639b954cf81fcb0e7267949198a',): ('arange-sum-sum-aggregate-19caf639b954cf81fcb0e7267949198a',),\r\n ('arange-sum-sum-aggregate-19caf639b954cf81fcb0e7267949198a',): (<toolz.functoolz.Compose at 0x10aa2f8d0>,\r\n  (subgraph_callable,\r\n   (<function dask.array.chunk.arange(start, stop, step, length, dtype)>,\r\n    0,\r\n    2,\r\n    1,\r\n    2,\r\n    dtype('int64'))))}\r\nb2 = da.Array(b.dask, \r\n              name='arange-sum-sum-aggregate-19caf639b954cf81fcb0e7267949198a',\r\n              shape=(), chunks=(), dtype='int64')\r\n\r\n%timeit b2.compute(optimize=False, scheduler='sync')\r\n275 \u00b5s \u00b1 2.17 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\r\n```\r\n2. The computation of the innermost value could be sped up:\r\n```\r\nb3 = b.dask['arange-sum-sum-aggregate-19caf639b954cf81fcb0e7267949198a',]\r\nb4 = compose(b3[0], b3[1][0], partial(*b3[1][1]))\r\nc4 = compose(np.sum, partial(np.arange, 0, 2, dtype='int64'))\r\n\r\n%timeit b4()\r\n30.5 \u00b5s \u00b1 426 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\r\n%timeit c4()\r\n4.59 \u00b5s \u00b1 93.2 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\r\n%timeit np.arange(0, 2, dtype='int64').sum()\r\n3.11 \u00b5s \u00b1 40.1 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/487539001/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]