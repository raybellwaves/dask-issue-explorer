[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/769853511",
        "html_url": "https://github.com/dask/dask/issues/7137#issuecomment-769853511",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7137",
        "id": 769853511,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTg1MzUxMQ==",
        "user": {
            "login": "bmerry",
            "id": 1963944,
            "node_id": "MDQ6VXNlcjE5NjM5NDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1963944?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/bmerry",
            "html_url": "https://github.com/bmerry",
            "followers_url": "https://api.github.com/users/bmerry/followers",
            "following_url": "https://api.github.com/users/bmerry/following{/other_user}",
            "gists_url": "https://api.github.com/users/bmerry/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/bmerry/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bmerry/subscriptions",
            "organizations_url": "https://api.github.com/users/bmerry/orgs",
            "repos_url": "https://api.github.com/users/bmerry/repos",
            "events_url": "https://api.github.com/users/bmerry/events{/privacy}",
            "received_events_url": "https://api.github.com/users/bmerry/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-29T14:56:07Z",
        "updated_at": "2021-01-29T14:56:07Z",
        "author_association": "MEMBER",
        "body": "Ping @madsbk since it looks like you wrote the code in question.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/769853511/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/774156476",
        "html_url": "https://github.com/dask/dask/issues/7137#issuecomment-774156476",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7137",
        "id": 774156476,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDE1NjQ3Ng==",
        "user": {
            "login": "jsignell",
            "id": 4806877,
            "node_id": "MDQ6VXNlcjQ4MDY4Nzc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4806877?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jsignell",
            "html_url": "https://github.com/jsignell",
            "followers_url": "https://api.github.com/users/jsignell/followers",
            "following_url": "https://api.github.com/users/jsignell/following{/other_user}",
            "gists_url": "https://api.github.com/users/jsignell/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jsignell/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jsignell/subscriptions",
            "organizations_url": "https://api.github.com/users/jsignell/orgs",
            "repos_url": "https://api.github.com/users/jsignell/repos",
            "events_url": "https://api.github.com/users/jsignell/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jsignell/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-02-05T16:58:12Z",
        "updated_at": "2021-02-05T16:58:12Z",
        "author_association": "MEMBER",
        "body": "Sorry this has slipped through the cracks a bit. I added a label to try to help with visibility",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/774156476/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/774157710",
        "html_url": "https://github.com/dask/dask/issues/7137#issuecomment-774157710",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7137",
        "id": 774157710,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDE1NzcxMA==",
        "user": {
            "login": "jrbourbeau",
            "id": 11656932,
            "node_id": "MDQ6VXNlcjExNjU2OTMy",
            "avatar_url": "https://avatars.githubusercontent.com/u/11656932?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jrbourbeau",
            "html_url": "https://github.com/jrbourbeau",
            "followers_url": "https://api.github.com/users/jrbourbeau/followers",
            "following_url": "https://api.github.com/users/jrbourbeau/following{/other_user}",
            "gists_url": "https://api.github.com/users/jrbourbeau/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jrbourbeau/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jrbourbeau/subscriptions",
            "organizations_url": "https://api.github.com/users/jrbourbeau/orgs",
            "repos_url": "https://api.github.com/users/jrbourbeau/repos",
            "events_url": "https://api.github.com/users/jrbourbeau/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jrbourbeau/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-02-05T17:00:14Z",
        "updated_at": "2021-02-05T17:00:14Z",
        "author_association": "MEMBER",
        "body": "cc @crusaderky as he's been looking into `HighLevelGraph` consistency recently ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/774157710/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/774472219",
        "html_url": "https://github.com/dask/dask/issues/7137#issuecomment-774472219",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7137",
        "id": 774472219,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDQ3MjIxOQ==",
        "user": {
            "login": "crusaderky",
            "id": 6213168,
            "node_id": "MDQ6VXNlcjYyMTMxNjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6213168?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/crusaderky",
            "html_url": "https://github.com/crusaderky",
            "followers_url": "https://api.github.com/users/crusaderky/followers",
            "following_url": "https://api.github.com/users/crusaderky/following{/other_user}",
            "gists_url": "https://api.github.com/users/crusaderky/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/crusaderky/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/crusaderky/subscriptions",
            "organizations_url": "https://api.github.com/users/crusaderky/orgs",
            "repos_url": "https://api.github.com/users/crusaderky/repos",
            "events_url": "https://api.github.com/users/crusaderky/events{/privacy}",
            "received_events_url": "https://api.github.com/users/crusaderky/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-02-06T12:44:47Z",
        "updated_at": "2021-02-06T12:44:47Z",
        "author_association": "MEMBER",
        "body": "I don't think this can be fixed without overhauling the design of the ``__dask_layers__`` method first. At the moment,  ``__dask_layers__`` is making blind assumptions on the layer name based on the ``__dask_keys__`` - which works in 99% of the cases, except when it doesn't - see #7177.\r\n\r\nA reasonable solution would be to store the top-level layers in an attribute of HighlevelGraph; the ``__dask_layers__`` method would then become a trivial accessor.\r\n\r\nOn a separate note, I'm curious to understand what is the use case of culling a graph and then adding to it afterwards, as opposed to leaving optimization as the very last step before computation?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/774472219/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/774476579",
        "html_url": "https://github.com/dask/dask/issues/7137#issuecomment-774476579",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7137",
        "id": 774476579,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDQ3NjU3OQ==",
        "user": {
            "login": "bmerry",
            "id": 1963944,
            "node_id": "MDQ6VXNlcjE5NjM5NDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1963944?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/bmerry",
            "html_url": "https://github.com/bmerry",
            "followers_url": "https://api.github.com/users/bmerry/followers",
            "following_url": "https://api.github.com/users/bmerry/following{/other_user}",
            "gists_url": "https://api.github.com/users/bmerry/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/bmerry/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bmerry/subscriptions",
            "organizations_url": "https://api.github.com/users/bmerry/orgs",
            "repos_url": "https://api.github.com/users/bmerry/repos",
            "events_url": "https://api.github.com/users/bmerry/events{/privacy}",
            "received_events_url": "https://api.github.com/users/bmerry/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-02-06T13:19:59Z",
        "updated_at": "2021-02-06T13:19:59Z",
        "author_association": "MEMBER",
        "body": "> On a separate note, I'm curious to understand what is the use case of culling a graph and then adding to it afterwards, as opposed to leaving optimization as the very last step before computation?\r\n\r\nIf you have an intermediate array where optimisation is expensive but gives a much smaller graph (I'm thinking in particular of #5918, but I think the same could apply if there were many layers that could be fused), and you then construct and compute many graphs from it, it is cheaper to just optimise the intermediate array once rather than in each computation.\r\n\r\nBTW I haven't hit this exact bug in real code (yet) - it's just something I spotted while reading Dask source code to understand how the HLG culling works.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/774476579/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/775326750",
        "html_url": "https://github.com/dask/dask/issues/7137#issuecomment-775326750",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7137",
        "id": 775326750,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTMyNjc1MA==",
        "user": {
            "login": "crusaderky",
            "id": 6213168,
            "node_id": "MDQ6VXNlcjYyMTMxNjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6213168?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/crusaderky",
            "html_url": "https://github.com/crusaderky",
            "followers_url": "https://api.github.com/users/crusaderky/followers",
            "following_url": "https://api.github.com/users/crusaderky/following{/other_user}",
            "gists_url": "https://api.github.com/users/crusaderky/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/crusaderky/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/crusaderky/subscriptions",
            "organizations_url": "https://api.github.com/users/crusaderky/orgs",
            "repos_url": "https://api.github.com/users/crusaderky/repos",
            "events_url": "https://api.github.com/users/crusaderky/events{/privacy}",
            "received_events_url": "https://api.github.com/users/crusaderky/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-02-08T17:51:38Z",
        "updated_at": "2021-02-08T17:51:38Z",
        "author_association": "MEMBER",
        "body": "> If you have an intermediate array where optimisation is expensive but gives a much smaller graph (I'm thinking in particular of #5918, but I think the same could apply if there were many layers that could be fused), and you then construct and compute many graphs from it, it is cheaper to just optimise the intermediate array once rather than in each computation.\r\n\r\nWouldn't it be better to use persist() in this case?\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/775326750/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/775339044",
        "html_url": "https://github.com/dask/dask/issues/7137#issuecomment-775339044",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7137",
        "id": 775339044,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTMzOTA0NA==",
        "user": {
            "login": "bmerry",
            "id": 1963944,
            "node_id": "MDQ6VXNlcjE5NjM5NDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1963944?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/bmerry",
            "html_url": "https://github.com/bmerry",
            "followers_url": "https://api.github.com/users/bmerry/followers",
            "following_url": "https://api.github.com/users/bmerry/following{/other_user}",
            "gists_url": "https://api.github.com/users/bmerry/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/bmerry/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bmerry/subscriptions",
            "organizations_url": "https://api.github.com/users/bmerry/orgs",
            "repos_url": "https://api.github.com/users/bmerry/repos",
            "events_url": "https://api.github.com/users/bmerry/events{/privacy}",
            "received_events_url": "https://api.github.com/users/bmerry/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-02-08T18:10:39Z",
        "updated_at": "2021-02-08T18:10:39Z",
        "author_association": "MEMBER",
        "body": "> Wouldn't it be better to use persist() in this case?\r\n\r\nNot if the intermediate array is hundreds of GB large.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/775339044/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/786587425",
        "html_url": "https://github.com/dask/dask/issues/7137#issuecomment-786587425",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7137",
        "id": 786587425,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc4NjU4NzQyNQ==",
        "user": {
            "login": "crusaderky",
            "id": 6213168,
            "node_id": "MDQ6VXNlcjYyMTMxNjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6213168?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/crusaderky",
            "html_url": "https://github.com/crusaderky",
            "followers_url": "https://api.github.com/users/crusaderky/followers",
            "following_url": "https://api.github.com/users/crusaderky/following{/other_user}",
            "gists_url": "https://api.github.com/users/crusaderky/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/crusaderky/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/crusaderky/subscriptions",
            "organizations_url": "https://api.github.com/users/crusaderky/orgs",
            "repos_url": "https://api.github.com/users/crusaderky/repos",
            "events_url": "https://api.github.com/users/crusaderky/events{/privacy}",
            "received_events_url": "https://api.github.com/users/crusaderky/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-02-26T11:22:19Z",
        "updated_at": "2021-02-26T11:22:19Z",
        "author_association": "MEMBER",
        "body": "PR #7276 introduces a new method ``HighLevelGraph.cull_layers()``, which would sidestep the problem very nicely albeit at the cost of unculled keys in the case of slicing.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/786587425/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]