{
    "url": "https://api.github.com/repos/dask/dask/issues/7375",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/7375/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/7375/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/7375/events",
    "html_url": "https://github.com/dask/dask/pull/7375",
    "id": 829747075,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NTkxMzYyMzkz",
    "number": 7375,
    "title": "DataFrame: handle ExtensionArrays when converting to dask.Array",
    "user": {
        "login": "gjoseph92",
        "id": 3309802,
        "node_id": "MDQ6VXNlcjMzMDk4MDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3309802?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gjoseph92",
        "html_url": "https://github.com/gjoseph92",
        "followers_url": "https://api.github.com/users/gjoseph92/followers",
        "following_url": "https://api.github.com/users/gjoseph92/following{/other_user}",
        "gists_url": "https://api.github.com/users/gjoseph92/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gjoseph92/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gjoseph92/subscriptions",
        "organizations_url": "https://api.github.com/users/gjoseph92/orgs",
        "repos_url": "https://api.github.com/users/gjoseph92/repos",
        "events_url": "https://api.github.com/users/gjoseph92/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gjoseph92/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2021-03-12T04:29:51Z",
    "updated_at": "2021-04-02T18:04:40Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "draft": false,
    "pull_request": {
        "url": "https://api.github.com/repos/dask/dask/pulls/7375",
        "html_url": "https://github.com/dask/dask/pull/7375",
        "diff_url": "https://github.com/dask/dask/pull/7375.diff",
        "patch_url": "https://github.com/dask/dask/pull/7375.patch",
        "merged_at": null
    },
    "body": "In #7206, computing the `meta` from a column containing a pandas ExtensionArray failed, because we were assuming the chunk type of the resulting array would always be a NumPy array, which doesn't know what to make of a pandas extension dtype.\r\n\r\nThere are two approaches we could take:\r\n1) (56757b3 only) use `to_numpy()` instead of `.values` ([as recommended](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.values.html#pandas.DataFrame.values)), to be sure that any extension arrays are converted to NumPy arrays (both in the `meta`, and the actual compute).\r\n2) (+ c15c4ea) Keep using `.values`, and let a pandas ExtensionArray be the `meta` of a Dask array. This avoids an (in some cases expensive) conversion, but might lead to weird downstream behavior, since the extension arrays aren't registered as dask chunk types, plus they can only be 1D.\r\n\r\nUpdate: went with approach 1 (coerce to a NumPy array) after discussing with @jrbourbeau: we were unsure whether ExtensionArrays would behave correctly as chunk types and the API is still moving around, so let's play it safe and stick with NumPy for now.\r\n\r\nIn either case, I also extended `to_dask_array` to match [`to_numpy`](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy), so you can specify a `dtype` and `na_value`, which will be handy as the extension array types become more prevalent.\r\n\r\n@TomAugspurger any thoughts on which approach to take?\r\n\r\n- [x] Closes #7206\r\n- [x] Tests added / passed\r\n- [x] Passes `black dask` / `flake8 dask`\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/7375/reactions",
        "total_count": 2,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 1
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/7375/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}