[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/2025140643",
        "html_url": "https://github.com/dask/dask/issues/11019#issuecomment-2025140643",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/11019",
        "id": 2025140643,
        "node_id": "IC_kwDOAbcwm854tTGj",
        "user": {
            "login": "phofl",
            "id": 61934744,
            "node_id": "MDQ6VXNlcjYxOTM0NzQ0",
            "avatar_url": "https://avatars.githubusercontent.com/u/61934744?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/phofl",
            "html_url": "https://github.com/phofl",
            "followers_url": "https://api.github.com/users/phofl/followers",
            "following_url": "https://api.github.com/users/phofl/following{/other_user}",
            "gists_url": "https://api.github.com/users/phofl/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/phofl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/phofl/subscriptions",
            "organizations_url": "https://api.github.com/users/phofl/orgs",
            "repos_url": "https://api.github.com/users/phofl/repos",
            "events_url": "https://api.github.com/users/phofl/events{/privacy}",
            "received_events_url": "https://api.github.com/users/phofl/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-03-28T13:05:48Z",
        "updated_at": "2024-03-28T13:05:48Z",
        "author_association": "MEMBER",
        "body": "Can you post a reproducible example? E.g. have some code that creates the parquet files that you read. I have trouble reproducing the error that you are seeing",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/2025140643/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/2028004581",
        "html_url": "https://github.com/dask/dask/issues/11019#issuecomment-2028004581",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/11019",
        "id": 2028004581,
        "node_id": "IC_kwDOAbcwm8544OTl",
        "user": {
            "login": "guozhans",
            "id": 9510342,
            "node_id": "MDQ6VXNlcjk1MTAzNDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9510342?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/guozhans",
            "html_url": "https://github.com/guozhans",
            "followers_url": "https://api.github.com/users/guozhans/followers",
            "following_url": "https://api.github.com/users/guozhans/following{/other_user}",
            "gists_url": "https://api.github.com/users/guozhans/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/guozhans/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/guozhans/subscriptions",
            "organizations_url": "https://api.github.com/users/guozhans/orgs",
            "repos_url": "https://api.github.com/users/guozhans/repos",
            "events_url": "https://api.github.com/users/guozhans/events{/privacy}",
            "received_events_url": "https://api.github.com/users/guozhans/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-03-30T10:23:55Z",
        "updated_at": "2024-03-30T10:23:55Z",
        "author_association": "NONE",
        "body": "Hi @phofl \r\n\r\nI attached small dataset and my pip installation at bottom, you can try this dataset with my another script. the dataset is quite small, it suppose won't cause you OOM. At least it doesn't cause OOM here. :)\r\n\r\nAlso you must enable worker plugin with loky \r\n\r\nIf you use nanny, the script will run successfully.\r\n\r\n[dji-osm.tar.gz](https://github.com/dask/dask/files/14811482/dji-osm.tar.gz)\r\n\r\n```python\r\nimport logging\r\nimport dask\r\nimport dask.dataframe as dd\r\nimport pandas as pd\r\nimport dask.config as dc\r\n\r\nfrom dask.delayed import delayed\r\nfrom distributed import WorkerPlugin, Worker, LocalCluster, Client\r\nfrom loky import ProcessPoolExecutor\r\n\r\n\r\nclass TaskExecutorPool(WorkerPlugin):\r\n    def __init__(self, logger, name):\r\n        self.logger = logger\r\n        self.worker = None\r\n        self.name = name\r\n\r\n    def setup(self, worker: Worker):\r\n        executor = ProcessPoolExecutor(max_workers=worker.state.nthreads)\r\n        worker.executors[self.name] = executor\r\n        self.worker = worker\r\n\r\n    def transition(self, key, start, finish, *args, **kwargs):\r\n        if finish == 'error':\r\n            ts = self.worker.tasks[key]\r\n            exc_info = (type(ts.exception), ts.exception, ts.traceback)\r\n            print(f\"Task traceback: {ts.traceback}\")\r\n            print(f\"Task exception: {exc_info}\")\r\n            self.logger.error(f\"Error during computation of {key}, caused by {str(ts.exception)}.\")\r\n\r\n\r\ndef main():\r\n    cluster = LocalCluster(n_workers=4, processes=False, silence_logs=logging.DEBUG)\r\n    with Client(cluster) as client:\r\n        client.register_plugin(TaskExecutorPool(logging, \"process\"), name=\"process\")\r\n        with dask.annotate(executor=\"process\", retries=10):\r\n            dc.set({\"dataframe.convert-string\": False})\r\n            ways = dd.read_parquet(\r\n                \"djibouti-latest.osm/way\", columns=[\"id\", \"nodes\"], blocksize=\"8MiB\")\r\n            node_coordinates = dd.read_parquet(\r\n                \"djibouti-latest.osm/node\", columns=[\"latitude\", \"longitude\"], index=[\"id\"])\r\n               \r\n            way_dfs = ways.to_delayed()\r\n            delays = []\r\n            for way_df in way_dfs:\r\n                delays.append(delayed(create_df)(way_df))\r\n            dfs = dd.compute(*delays)\r\n            df = dd.concat([*dfs])\r\n            df = dd.merge(df, node_coordinates, left_on=[\"nodeId\"], right_on=[\"id\"], right_index=True).set_index(\"id\", shuffle_method=\"p2p\")\r\n            print(f\"df = {df.compute()}\")\r\n\r\n\r\ndef create_df(way_df):\r\n    new_df = way_df.set_index(\"id\").nodes.apply(\r\n        lambda ns: pd.Series([n[\"nodeId\"] for n in ns], dtype=\"int64\")\r\n    ).convert_dtypes(convert_integer=True).stack().reset_index(0, name=\"nodeId\")\r\n    return dd.from_pandas(new_df, npartitions=10)\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n```\r\n\r\n\r\nMy pip install \r\npip install dask-kubernetes==2024.3.1 dask[complete]==\"2024.2.1\" dask-geopandas pandas==2.1.4 pandas[performance]==2.1.4 numpy==1.22.4 jupyter-server-proxy pyarrow==15.0.2  shapely==2.0.3 pyproj==3.6.1 geopandas==0.14.3 geoparquet==0.0.3 wheel loky==3.4.1 graphviz",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/2028004581/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/2037129776",
        "html_url": "https://github.com/dask/dask/issues/11019#issuecomment-2037129776",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/11019",
        "id": 2037129776,
        "node_id": "IC_kwDOAbcwm855bCIw",
        "user": {
            "login": "phofl",
            "id": 61934744,
            "node_id": "MDQ6VXNlcjYxOTM0NzQ0",
            "avatar_url": "https://avatars.githubusercontent.com/u/61934744?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/phofl",
            "html_url": "https://github.com/phofl",
            "followers_url": "https://api.github.com/users/phofl/followers",
            "following_url": "https://api.github.com/users/phofl/following{/other_user}",
            "gists_url": "https://api.github.com/users/phofl/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/phofl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/phofl/subscriptions",
            "organizations_url": "https://api.github.com/users/phofl/orgs",
            "repos_url": "https://api.github.com/users/phofl/repos",
            "events_url": "https://api.github.com/users/phofl/events{/privacy}",
            "received_events_url": "https://api.github.com/users/phofl/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-04-04T12:52:22Z",
        "updated_at": "2024-04-04T12:52:22Z",
        "author_association": "MEMBER",
        "body": "Thanks! Is it possible to reproduce this without the tar file?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/2037129776/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/2037452157",
        "html_url": "https://github.com/dask/dask/issues/11019#issuecomment-2037452157",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/11019",
        "id": 2037452157,
        "node_id": "IC_kwDOAbcwm855cQ19",
        "user": {
            "login": "guozhans",
            "id": 9510342,
            "node_id": "MDQ6VXNlcjk1MTAzNDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9510342?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/guozhans",
            "html_url": "https://github.com/guozhans",
            "followers_url": "https://api.github.com/users/guozhans/followers",
            "following_url": "https://api.github.com/users/guozhans/following{/other_user}",
            "gists_url": "https://api.github.com/users/guozhans/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/guozhans/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/guozhans/subscriptions",
            "organizations_url": "https://api.github.com/users/guozhans/orgs",
            "repos_url": "https://api.github.com/users/guozhans/repos",
            "events_url": "https://api.github.com/users/guozhans/events{/privacy}",
            "received_events_url": "https://api.github.com/users/guozhans/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-04-04T14:59:26Z",
        "updated_at": "2024-04-04T14:59:26Z",
        "author_association": "NONE",
        "body": "I don't understand, and can't you use this data? or you are check something? Or do you mean Dask can only work on specific dataset? Perhaps you could give more context.\r\n\r\nI didn't try to reproduce it with other data, but i observe similar data set has same issue. ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/2037452157/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/2037470915",
        "html_url": "https://github.com/dask/dask/issues/11019#issuecomment-2037470915",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/11019",
        "id": 2037470915,
        "node_id": "IC_kwDOAbcwm855cVbD",
        "user": {
            "login": "phofl",
            "id": 61934744,
            "node_id": "MDQ6VXNlcjYxOTM0NzQ0",
            "avatar_url": "https://avatars.githubusercontent.com/u/61934744?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/phofl",
            "html_url": "https://github.com/phofl",
            "followers_url": "https://api.github.com/users/phofl/followers",
            "following_url": "https://api.github.com/users/phofl/following{/other_user}",
            "gists_url": "https://api.github.com/users/phofl/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/phofl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/phofl/subscriptions",
            "organizations_url": "https://api.github.com/users/phofl/orgs",
            "repos_url": "https://api.github.com/users/phofl/repos",
            "events_url": "https://api.github.com/users/phofl/events{/privacy}",
            "received_events_url": "https://api.github.com/users/phofl/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-04-04T15:07:15Z",
        "updated_at": "2024-04-04T15:07:15Z",
        "author_association": "MEMBER",
        "body": "It's always better to have something that can just be copy-paste for developers. Here is some context about why downloading those files can be a little concerning\r\n\r\nhttps://github.com/dask/dask/issues/10995#issuecomment-2014736296",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/2037470915/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/2050965637",
        "html_url": "https://github.com/dask/dask/issues/11019#issuecomment-2050965637",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/11019",
        "id": 2050965637,
        "node_id": "IC_kwDOAbcwm856P0CF",
        "user": {
            "login": "guozhans",
            "id": 9510342,
            "node_id": "MDQ6VXNlcjk1MTAzNDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9510342?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/guozhans",
            "html_url": "https://github.com/guozhans",
            "followers_url": "https://api.github.com/users/guozhans/followers",
            "following_url": "https://api.github.com/users/guozhans/following{/other_user}",
            "gists_url": "https://api.github.com/users/guozhans/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/guozhans/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/guozhans/subscriptions",
            "organizations_url": "https://api.github.com/users/guozhans/orgs",
            "repos_url": "https://api.github.com/users/guozhans/repos",
            "events_url": "https://api.github.com/users/guozhans/events{/privacy}",
            "received_events_url": "https://api.github.com/users/guozhans/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-04-12T04:45:41Z",
        "updated_at": "2024-04-12T09:15:18Z",
        "author_association": "NONE",
        "body": "Hi @phofl \r\nI see, and thanks for providing some context.\r\n\r\nIf i copy and paste, somehow it will change data format. \r\nthe attached file only has few hundreds lines. I hope it will work for you..\r\n\r\n[lie-de-clipperton.zip](https://github.com/dask/dask/files/14954010/lie-de-clipperton.zip)\r\n\r\nOr you can download complete [\u00cele de Clipperton](https://download.geofabrik.de/australia-oceania/ile-de-clipperton.html) PBF data from https://download.geofabrik.de/australia-oceania.html\r\nand transform it into parquet files by using osm-parquetizer, and then to separate ways nodes\r\n\r\nSam",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/2050965637/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]