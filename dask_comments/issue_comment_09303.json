[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1194400399",
        "html_url": "https://github.com/dask/dask/pull/9303#issuecomment-1194400399",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9303",
        "id": 1194400399,
        "node_id": "IC_kwDOAbcwm85HMRqP",
        "user": {
            "login": "GPUtester",
            "id": 38199262,
            "node_id": "MDQ6VXNlcjM4MTk5MjYy",
            "avatar_url": "https://avatars.githubusercontent.com/u/38199262?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/GPUtester",
            "html_url": "https://github.com/GPUtester",
            "followers_url": "https://api.github.com/users/GPUtester/followers",
            "following_url": "https://api.github.com/users/GPUtester/following{/other_user}",
            "gists_url": "https://api.github.com/users/GPUtester/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/GPUtester/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/GPUtester/subscriptions",
            "organizations_url": "https://api.github.com/users/GPUtester/orgs",
            "repos_url": "https://api.github.com/users/GPUtester/repos",
            "events_url": "https://api.github.com/users/GPUtester/events{/privacy}",
            "received_events_url": "https://api.github.com/users/GPUtester/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-25T17:40:19Z",
        "updated_at": "2022-07-25T17:40:19Z",
        "author_association": "COLLABORATOR",
        "body": "Can one of the admins verify this patch?\n\nAdmins can comment `ok to test` to allow this one PR to run or `add to allowlist` to allow all future PRs from the same author to run.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1194400399/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1198547623",
        "html_url": "https://github.com/dask/dask/pull/9303#issuecomment-1198547623",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9303",
        "id": 1198547623,
        "node_id": "IC_kwDOAbcwm85HcGKn",
        "user": {
            "login": "ncclementi",
            "id": 7526622,
            "node_id": "MDQ6VXNlcjc1MjY2MjI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7526622?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ncclementi",
            "html_url": "https://github.com/ncclementi",
            "followers_url": "https://api.github.com/users/ncclementi/followers",
            "following_url": "https://api.github.com/users/ncclementi/following{/other_user}",
            "gists_url": "https://api.github.com/users/ncclementi/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ncclementi/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ncclementi/subscriptions",
            "organizations_url": "https://api.github.com/users/ncclementi/orgs",
            "repos_url": "https://api.github.com/users/ncclementi/repos",
            "events_url": "https://api.github.com/users/ncclementi/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ncclementi/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-28T19:28:27Z",
        "updated_at": "2022-07-28T19:28:27Z",
        "author_association": "MEMBER",
        "body": "@WToma thank you for opening this draft. It might be useful if you can provide some more information about the profiling, and how this improves the current situation. Eventually, you'll also want to take a look at the failing tests related to this change. https://github.com/dask/dask/runs/7505542061?check_suite_focus=true\r\n\r\nI see that @jakirkham worked in this part of the code before so maybe he is a good person to provide feedback here. Thoughts? \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1198547623/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1226405591",
        "html_url": "https://github.com/dask/dask/pull/9303#issuecomment-1226405591",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9303",
        "id": 1226405591,
        "node_id": "IC_kwDOAbcwm85JGXbX",
        "user": {
            "login": "WToma",
            "id": 2308949,
            "node_id": "MDQ6VXNlcjIzMDg5NDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2308949?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/WToma",
            "html_url": "https://github.com/WToma",
            "followers_url": "https://api.github.com/users/WToma/followers",
            "following_url": "https://api.github.com/users/WToma/following{/other_user}",
            "gists_url": "https://api.github.com/users/WToma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/WToma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/WToma/subscriptions",
            "organizations_url": "https://api.github.com/users/WToma/orgs",
            "repos_url": "https://api.github.com/users/WToma/repos",
            "events_url": "https://api.github.com/users/WToma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/WToma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-08-24T21:32:28Z",
        "updated_at": "2022-08-24T21:32:28Z",
        "author_association": "NONE",
        "body": "Apologies for the long delay on this!\r\n\r\nHere's the snippet that I used to profile (note: these are annoyingly long to run, so feel free to use a smaller one when testing!):\r\n\r\n```python\r\nimport pandas as pd\r\nimport dask.array\r\nimport xarray as xr\r\ndate_index = pd.date_range(start=\"2012-01-01\", end=\"2112-01-01\")\r\nint_index=pd.Index(range(1, 121))\r\nstring_index = pd.Index([f\"{x} {y} {z}\" for x in range(1, 9) for y in range(1, 13) for z in range(1, 5)])\r\nindices = {\"date\": date_index, \"int\": int_index, \"string\": string_index}\r\nindex_order=[\"string\", \"date\", \"int\"]\r\nshape = [len(indices[i]) for i in index_order]\r\nchunks = [1, 1, len(indices[\"int\"])]\r\nds = xr.Dataset(\r\n  {\r\n    \"my_value\": (\r\n      index_order,\r\n      dask.array.zeros(\r\n        shape=shape,\r\n        chunks=chunks,\r\n        dtype=\"float32\",\r\n      ),\r\n    ),\r\n  },\r\ncoords=indices)\r\n```\r\n\r\nAnd then the profiling:\r\n```python\r\nimport cProfile\r\ncProfile.run(\"ds.to_zarr('/tmp/empty_write_test.zarr', compute=False)\", 'restats')\r\n```\r\n\r\nIn [profiling-stats.zip](https://github.com/dask/dask/files/9419555/profiling-stats.zip) `restats-modified` is with this code change, and `restats-original` is without. You can see that with this change `insert_to_ooc` takes 21.525s, and without it takes 194.892s.\r\n\r\nI definitely intend to figure out the tests, but first I just wanted to see if I'm on a correct path to begin with :)\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1226405591/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]