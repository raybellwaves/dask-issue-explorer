[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/869690024",
        "html_url": "https://github.com/dask/dask/issues/7788#issuecomment-869690024",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7788",
        "id": 869690024,
        "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTY5MDAyNA==",
        "user": {
            "login": "GenevieveBuckley",
            "id": 30920819,
            "node_id": "MDQ6VXNlcjMwOTIwODE5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30920819?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/GenevieveBuckley",
            "html_url": "https://github.com/GenevieveBuckley",
            "followers_url": "https://api.github.com/users/GenevieveBuckley/followers",
            "following_url": "https://api.github.com/users/GenevieveBuckley/following{/other_user}",
            "gists_url": "https://api.github.com/users/GenevieveBuckley/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/GenevieveBuckley/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/GenevieveBuckley/subscriptions",
            "organizations_url": "https://api.github.com/users/GenevieveBuckley/orgs",
            "repos_url": "https://api.github.com/users/GenevieveBuckley/repos",
            "events_url": "https://api.github.com/users/GenevieveBuckley/events{/privacy}",
            "received_events_url": "https://api.github.com/users/GenevieveBuckley/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-06-28T13:34:20Z",
        "updated_at": "2021-06-28T13:34:20Z",
        "author_association": "MEMBER",
        "body": "I'd been having a tough time working out the logic behind this, but using the [dask `get` entry point](https://docs.dask.org/en/latest/spec.html?highlight=get(#entry-point-the-get-function) should help me work out what's going on.\r\n\r\nhttps://gist.github.com/GenevieveBuckley/12ae179940e78c10d616dc7fbc93ed8c\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/869690024/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/988680652",
        "html_url": "https://github.com/dask/dask/issues/7788#issuecomment-988680652",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7788",
        "id": 988680652,
        "node_id": "IC_kwDOAbcwm8467hHM",
        "user": {
            "login": "GenevieveBuckley",
            "id": 30920819,
            "node_id": "MDQ6VXNlcjMwOTIwODE5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30920819?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/GenevieveBuckley",
            "html_url": "https://github.com/GenevieveBuckley",
            "followers_url": "https://api.github.com/users/GenevieveBuckley/followers",
            "following_url": "https://api.github.com/users/GenevieveBuckley/following{/other_user}",
            "gists_url": "https://api.github.com/users/GenevieveBuckley/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/GenevieveBuckley/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/GenevieveBuckley/subscriptions",
            "organizations_url": "https://api.github.com/users/GenevieveBuckley/orgs",
            "repos_url": "https://api.github.com/users/GenevieveBuckley/repos",
            "events_url": "https://api.github.com/users/GenevieveBuckley/events{/privacy}",
            "received_events_url": "https://api.github.com/users/GenevieveBuckley/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-08T10:19:18Z",
        "updated_at": "2021-12-08T10:19:18Z",
        "author_association": "MEMBER",
        "body": "I worked more on this recently, and now have a much better understanding about what tasks get generated for different array shapes and chunk configurations.\r\n\r\nI describe a flawed idea for addressing this issue here: https://github.com/dask/dask/issues/7791#issuecomment-988673559\r\n\r\nI've abandoned that first flawed approach, in favor of using the `interior_keys` variable directly. ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/988680652/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/988685859",
        "html_url": "https://github.com/dask/dask/issues/7788#issuecomment-988685859",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7788",
        "id": 988685859,
        "node_id": "IC_kwDOAbcwm8467iYj",
        "user": {
            "login": "GenevieveBuckley",
            "id": 30920819,
            "node_id": "MDQ6VXNlcjMwOTIwODE5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30920819?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/GenevieveBuckley",
            "html_url": "https://github.com/GenevieveBuckley",
            "followers_url": "https://api.github.com/users/GenevieveBuckley/followers",
            "following_url": "https://api.github.com/users/GenevieveBuckley/following{/other_user}",
            "gists_url": "https://api.github.com/users/GenevieveBuckley/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/GenevieveBuckley/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/GenevieveBuckley/subscriptions",
            "organizations_url": "https://api.github.com/users/GenevieveBuckley/orgs",
            "repos_url": "https://api.github.com/users/GenevieveBuckley/repos",
            "events_url": "https://api.github.com/users/GenevieveBuckley/events{/privacy}",
            "received_events_url": "https://api.github.com/users/GenevieveBuckley/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-08T10:26:12Z",
        "updated_at": "2021-12-08T10:34:34Z",
        "author_association": "MEMBER",
        "body": "I can replace the `ArrayOverlapLayer` `__len__` method with this, which seems to work well without materializing the whole task graph.\r\n\r\n```python\r\n    def __len__(self):\r\n        axes = self.axes\r\n        chunks = self.chunks\r\n        dask_keys = self._dask_keys()\r\n\r\n        dims = list(map(len, chunks))\r\n        expand_key2 = partial(_expand_keys_around_center, dims=dims, axes=axes)\r\n\r\n        # Make keys for each of the surrounding sub-arrays\r\n        interior_keys = toolz.pipe(\r\n            dask_keys, flatten, map(expand_key2), map(flatten), toolz.concat, list\r\n        )\r\n\r\n        n_tasks = 0\r\n        for k in interior_keys:\r\n            if all([isinstance(i, int) for i in k]):\r\n                n_tasks += 2  # represents both getitem and overlap tasks\r\n            else:\r\n                n_tasks += 1  # represents a single getitem task\r\n        return n_tasks\r\n```\r\n\r\nGiven that three class methods (`__len__, `get_output_keys` and  `_construct_graph`) will now depend on `interior_keys`, we might want to refactor things slightly to avoid repeatedly re-computing `interior_keys`. I haven't thought about this deeply yet, just seems like it might be a sensible thing to do.\r\n\r\nIn the meantime, I'll open a PR that just includes the changes needed for `__len__` only. Given that this method gets called unintentionally every time the html repr is displayed, it's too easy to accidentally materialize the full task graph right now. So I think this is important to address sooner rather than later.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/988685859/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]