{
    "url": "https://api.github.com/repos/dask/dask/issues/2498",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/2498/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/2498/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/2498/events",
    "html_url": "https://github.com/dask/dask/issues/2498",
    "id": 239964657,
    "node_id": "MDU6SXNzdWUyMzk5NjQ2NTc=",
    "number": 2498,
    "title": "dask.base's normalize_array hashes the same data to different values",
    "user": {
        "login": "dlovell",
        "id": 1074774,
        "node_id": "MDQ6VXNlcjEwNzQ3NzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1074774?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dlovell",
        "html_url": "https://github.com/dlovell",
        "followers_url": "https://api.github.com/users/dlovell/followers",
        "following_url": "https://api.github.com/users/dlovell/following{/other_user}",
        "gists_url": "https://api.github.com/users/dlovell/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/dlovell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dlovell/subscriptions",
        "organizations_url": "https://api.github.com/users/dlovell/orgs",
        "repos_url": "https://api.github.com/users/dlovell/repos",
        "events_url": "https://api.github.com/users/dlovell/events{/privacy}",
        "received_events_url": "https://api.github.com/users/dlovell/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862305,
            "node_id": "MDU6TGFiZWwyNDI4NjIzMDU=",
            "url": "https://api.github.com/repos/dask/dask/labels/array",
            "name": "array",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 13,
    "created_at": "2017-07-01T18:20:45Z",
    "updated_at": "2021-10-12T02:39:17Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "https://github.com/dask/dask/blob/0.15.0/dask/base.py#L400\r\n\r\nIs there a reason to both hash the ravel'ed data and use strides?  Reading some other issues suggests strides was introduce for memmaps but I think this borks the case where its just a plain np.array.  Also, passing an `order` kwarg to `ravel` makes the same data come out in different ways.\r\n\r\nIt looks like a recent change introduces an `order` kwarg to the `ravel` method call\r\nIs it necessary for something?  \r\n\r\n```python\r\nimport pprint\r\n\r\nimport dask.base\r\nimport dask.hashing\r\nimport numpy as np\r\n\r\n\r\ndef f(x):\r\n    data = dask.hashing.hash_buffer_hex(x.ravel().view('i1'))\r\n    return (data, x.dtype, x.shape)\r\n\r\n\r\ndata = [[0, 1], [2, 3]]\r\norders = ('C', 'F')\r\n# arrs have the same data\r\narrs = [np.array(data, order=order) for order in orders]\r\n# but tokenize differently\r\npprint.pprint([dask.base.tokenize(arr) for arr in arrs])\r\n# the cause of the difference is passing `order` to ravel and using strides\r\npprint.pprint([dask.base.normalize_token(arr) for arr in arrs])\r\n# what if we omit the `order` arg to ravel and the use of strides?\r\npprint.pprint([f(arr) for arr in arrs])\r\npprint.pprint([np.__version__, dask.__version__])\r\n```\r\nwill print\r\n```\r\n['77acec63d80d37fcc8d42d0b4ee467bb', '85fb7b31b123920d0609d087c3d47300']\r\n[('f5c356611bc74f63a6d8068bdb3b807ce19691fb', dtype('int64'), (2, 2), (16, 8)),\r\n ('f2837ee9691f05f519de044b5aae40589bec6155', dtype('int64'), (2, 2), (8, 16))]\r\n[('f5c356611bc74f63a6d8068bdb3b807ce19691fb', dtype('int64'), (2, 2)),\r\n ('f5c356611bc74f63a6d8068bdb3b807ce19691fb', dtype('int64'), (2, 2))]\r\n['1.11.3', '0.15.0+16.g24afbd5']\r\n```",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/2498/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/2498/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}