{
    "url": "https://api.github.com/repos/dask/dask/issues/10463",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/10463/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/10463/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/10463/events",
    "html_url": "https://github.com/dask/dask/issues/10463",
    "id": 1866564646,
    "node_id": "I_kwDOAbcwm85vQYQm",
    "number": 10463,
    "title": "Issue with pipeline resilience when using `to_parquet` and preemptible workers",
    "user": {
        "login": "hyenal",
        "id": 12529987,
        "node_id": "MDQ6VXNlcjEyNTI5OTg3",
        "avatar_url": "https://avatars.githubusercontent.com/u/12529987?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hyenal",
        "html_url": "https://github.com/hyenal",
        "followers_url": "https://api.github.com/users/hyenal/followers",
        "following_url": "https://api.github.com/users/hyenal/following{/other_user}",
        "gists_url": "https://api.github.com/users/hyenal/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/hyenal/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hyenal/subscriptions",
        "organizations_url": "https://api.github.com/users/hyenal/orgs",
        "repos_url": "https://api.github.com/users/hyenal/repos",
        "events_url": "https://api.github.com/users/hyenal/events{/privacy}",
        "received_events_url": "https://api.github.com/users/hyenal/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862289,
            "node_id": "MDU6TGFiZWwyNDI4NjIyODk=",
            "url": "https://api.github.com/repos/dask/dask/labels/dataframe",
            "name": "dataframe",
            "color": "fbca04",
            "default": false,
            "description": null
        },
        {
            "id": 365513534,
            "node_id": "MDU6TGFiZWwzNjU1MTM1MzQ=",
            "url": "https://api.github.com/repos/dask/dask/labels/io",
            "name": "io",
            "color": "6f871c",
            "default": false,
            "description": ""
        },
        {
            "id": 2949099791,
            "node_id": "MDU6TGFiZWwyOTQ5MDk5Nzkx",
            "url": "https://api.github.com/repos/dask/dask/labels/parquet",
            "name": "parquet",
            "color": "77A66C",
            "default": false,
            "description": ""
        },
        {
            "id": 3468123446,
            "node_id": "LA_kwDOAbcwm87Ot102",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20attention",
            "name": "needs attention",
            "color": "6d626c",
            "default": false,
            "description": "It's been a while since this was pushed on. Needs attention from the owner or a maintainer."
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "hyenal",
        "id": 12529987,
        "node_id": "MDQ6VXNlcjEyNTI5OTg3",
        "avatar_url": "https://avatars.githubusercontent.com/u/12529987?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hyenal",
        "html_url": "https://github.com/hyenal",
        "followers_url": "https://api.github.com/users/hyenal/followers",
        "following_url": "https://api.github.com/users/hyenal/following{/other_user}",
        "gists_url": "https://api.github.com/users/hyenal/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/hyenal/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hyenal/subscriptions",
        "organizations_url": "https://api.github.com/users/hyenal/orgs",
        "repos_url": "https://api.github.com/users/hyenal/repos",
        "events_url": "https://api.github.com/users/hyenal/events{/privacy}",
        "received_events_url": "https://api.github.com/users/hyenal/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "hyenal",
            "id": 12529987,
            "node_id": "MDQ6VXNlcjEyNTI5OTg3",
            "avatar_url": "https://avatars.githubusercontent.com/u/12529987?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hyenal",
            "html_url": "https://github.com/hyenal",
            "followers_url": "https://api.github.com/users/hyenal/followers",
            "following_url": "https://api.github.com/users/hyenal/following{/other_user}",
            "gists_url": "https://api.github.com/users/hyenal/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/hyenal/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/hyenal/subscriptions",
            "organizations_url": "https://api.github.com/users/hyenal/orgs",
            "repos_url": "https://api.github.com/users/hyenal/repos",
            "events_url": "https://api.github.com/users/hyenal/events{/privacy}",
            "received_events_url": "https://api.github.com/users/hyenal/received_events",
            "type": "User",
            "site_admin": false
        },
        {
            "login": "rjzamora",
            "id": 20461013,
            "node_id": "MDQ6VXNlcjIwNDYxMDEz",
            "avatar_url": "https://avatars.githubusercontent.com/u/20461013?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rjzamora",
            "html_url": "https://github.com/rjzamora",
            "followers_url": "https://api.github.com/users/rjzamora/followers",
            "following_url": "https://api.github.com/users/rjzamora/following{/other_user}",
            "gists_url": "https://api.github.com/users/rjzamora/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/rjzamora/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/rjzamora/subscriptions",
            "organizations_url": "https://api.github.com/users/rjzamora/orgs",
            "repos_url": "https://api.github.com/users/rjzamora/repos",
            "events_url": "https://api.github.com/users/rjzamora/events{/privacy}",
            "received_events_url": "https://api.github.com/users/rjzamora/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 0,
    "created_at": "2023-08-25T08:09:06Z",
    "updated_at": "2023-09-25T01:45:32Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "Hello everyone, and first of all thanks a lot for Dask :D \r\n\r\nThis feature request stems from a conversation on [dask discourse](https://dask.discourse.group/t/improving-pipeline-resilience-when-using-to-parquet-and-preemptible-workers/2141).\r\n\r\nMost of the information are in the post but I will try to synthetize it here.\r\n\r\nWhen using preemptible workers with dask, using `to_parquet` can be an issue because the last task `store-to-parquet` will wait for all partitions to be saved. So your worker will hold results in memory for a part of the graphs that has been computed and saved.\r\nBut your workers are preemptible, so can be restarted anytime, thus even if you saved results in memory you may have to recompute them because your worker has been killed.\r\n\r\nOn the one hand tying things together is neat and avoid the overhead of concatenating results on the client.\r\nOn the other hand when using preemptible workers you would want to return the last `map_partitions` instead so that you could release memory as soon as possible if you wish to.\r\n\r\nI made a [PR](https://github.com/hyenal/dask/pull/1) on my own fork there and would be happy to submit a PR to this repository if this is deemed good to go.\r\n\r\nIn the PR I made the return of `map_partitions` a default when we are not writing the metadata file but could make it optional instead.\r\n\r\nThanks a lot in advance",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/10463/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/10463/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}