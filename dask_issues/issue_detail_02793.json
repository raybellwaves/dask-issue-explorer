{
    "url": "https://api.github.com/repos/dask/dask/issues/2793",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/2793/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/2793/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/2793/events",
    "html_url": "https://github.com/dask/dask/issues/2793",
    "id": 266665397,
    "node_id": "MDU6SXNzdWUyNjY2NjUzOTc=",
    "number": 2793,
    "title": "argmin/argmax fail on unknown shape",
    "user": {
        "login": "jakirkham",
        "id": 3019665,
        "node_id": "MDQ6VXNlcjMwMTk2NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jakirkham",
        "html_url": "https://github.com/jakirkham",
        "followers_url": "https://api.github.com/users/jakirkham/followers",
        "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
        "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
        "organizations_url": "https://api.github.com/users/jakirkham/orgs",
        "repos_url": "https://api.github.com/users/jakirkham/repos",
        "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jakirkham/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862305,
            "node_id": "MDU6TGFiZWwyNDI4NjIzMDU=",
            "url": "https://api.github.com/repos/dask/dask/labels/array",
            "name": "array",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2017-10-18T22:40:39Z",
    "updated_at": "2017-10-18T22:50:23Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "If a Dask Array has known shape, `argmin` and `argmax` work fine. If one of the dimensions of the array is unknown, the Dask graph can be constructed fine, but computation fails. It seems this problem is connected to the underlying reduction using the shape from the Dask Array even though some values are not finalized (i.e. `nan`).\r\n\r\nAn example is shown below and the `conda` environment used to create it in included as well. The example just uses `argmin` for simplicity, but `argmax` can reproduce it just as well.\r\n\r\n<details>\r\n<summary>Example:</summary>\r\n\r\n```python\r\nIn [1]: import dask.array as da\r\n\r\nIn [2]: a = da.arange(5, chunks=2)\r\n\r\nIn [3]: da.argmin(a)\r\nOut[3]: dask.array<arg_agg-aggregate, shape=(), dtype=int64, chunksize=()>\r\n\r\nIn [4]: da.argmin(a).compute()\r\nOut[4]: 0\r\n\r\nIn [5]: a[a < 2]\r\nOut[5]: dask.array<getitem, shape=(nan,), dtype=int64, chunksize=(nan,)>\r\n\r\nIn [6]: a[a < 2].compute()\r\nOut[6]: array([0, 1])\r\n\r\nIn [7]: da.argmin(a[a < 2])\r\nOut[7]: dask.array<arg_agg-aggregate, shape=(), dtype=int64, chunksize=()>\r\n\r\nIn [8]: da.argmin(a[a < 2]).compute()\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-8-cdeeefd60de4> in <module>()\r\n----> 1 da.argmin(a[a < 2]).compute()\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/base.py in compute(self, **kwargs)\r\n     97             Extra keywords to forward to the scheduler ``get`` function.\r\n     98         \"\"\"\r\n---> 99         (result,) = compute(self, traverse=False, **kwargs)\r\n    100         return result\r\n    101 \r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/base.py in compute(*args, **kwargs)\r\n    204     dsk = collections_to_dsk(variables, optimize_graph, **kwargs)\r\n    205     keys = [var._keys() for var in variables]\r\n--> 206     results = get(dsk, keys, **kwargs)\r\n    207 \r\n    208     results_iter = iter(results)\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/threaded.py in get(dsk, result, cache, num_workers, **kwargs)\r\n     73     results = get_async(pool.apply_async, len(pool._pool), dsk, result,\r\n     74                         cache=cache, get_id=_thread_get_id,\r\n---> 75                         pack_exception=pack_exception, **kwargs)\r\n     76 \r\n     77     # Cleanup pools associated to dead threads\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/local.py in get_async(apply_async, num_workers, dsk, result, cache, get_id, rerun_exceptions_locally, pack_exception, raise_exception, callbacks, dumps, loads, **kwargs)\r\n    519                         _execute_task(task, data)  # Re-execute locally\r\n    520                     else:\r\n--> 521                         raise_exception(exc, tb)\r\n    522                 res, worker_id = loads(res_info)\r\n    523                 state['cache'][key] = res\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/compatibility.py in reraise(exc, tb)\r\n     58         if exc.__traceback__ is not tb:\r\n     59             raise exc.with_traceback(tb)\r\n---> 60         raise exc\r\n     61 \r\n     62 else:\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/local.py in execute_task(key, task_info, dumps, loads, get_id, pack_exception)\r\n    288     try:\r\n    289         task, data = loads(task_info)\r\n--> 290         result = _execute_task(task, data)\r\n    291         id = get_id()\r\n    292         result = dumps((result, id))\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/local.py in _execute_task(arg, cache, dsk)\r\n    269         func, args = arg[0], arg[1:]\r\n    270         args2 = [_execute_task(a, cache) for a in args]\r\n--> 271         return func(*args2)\r\n    272     elif not ishashable(arg):\r\n    273         return arg\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/array/reductions.py in arg_chunk(func, argfunc, x, axis, offset_info)\r\n    486         ind = np.unravel_index(arg.ravel()[0], x.shape)\r\n    487         total_ind = tuple(o + i for (o, i) in zip(offset, ind))\r\n--> 488         arg[:] = np.ravel_multi_index(total_ind, total_shape)\r\n    489     else:\r\n    490         arg += offset_info\r\n\r\nTypeError: 'float' object cannot be interpreted as an integer\r\n```\r\n\r\n</details>\r\n\r\n<br>\r\n\r\n<details>\r\n<summary>Environment:</summary>\r\n\r\n```yaml\r\nname: test\r\nchannels:\r\n- conda-forge\r\n- defaults\r\ndependencies:\r\n- appnope=0.1.0=py36_0\r\n- blas=1.1=openblas\r\n- bokeh=0.12.9=py36_0\r\n- ca-certificates=2017.7.27.1=0\r\n- certifi=2017.7.27.1=py36_0\r\n- click=6.7=py36_0\r\n- cloudpickle=0.4.0=py36_0\r\n- dask=0.15.4=py_0\r\n- dask-core=0.15.4=py_0\r\n- decorator=4.1.2=py36_0\r\n- distributed=1.19.3=py36_0\r\n- heapdict=1.0.0=py36_0\r\n- ipython=6.2.1=py36_0\r\n- ipython_genutils=0.2.0=py36_0\r\n- jedi=0.10.2=py36_0\r\n- jinja2=2.9.6=py36_0\r\n- libgfortran=3.0.0=0\r\n- locket=0.2.0=py36_1\r\n- markupsafe=1.0=py36_0\r\n- msgpack-python=0.4.8=py36_0\r\n- ncurses=5.9=10\r\n- numpy=1.13.3=py36_blas_openblas_200\r\n- openblas=0.2.19=2\r\n- openssl=1.0.2l=0\r\n- pandas=0.20.3=py36_1\r\n- partd=0.3.8=py36_0\r\n- pexpect=4.2.1=py36_0\r\n- pickleshare=0.7.4=py36_0\r\n- pip=9.0.1=py36_0\r\n- prompt_toolkit=1.0.15=py36_0\r\n- psutil=5.3.1=py36_0\r\n- ptyprocess=0.5.2=py36_0\r\n- pygments=2.2.0=py36_0\r\n- python=3.6.3=0\r\n- python-dateutil=2.6.1=py36_0\r\n- pytz=2017.2=py36_0\r\n- pyyaml=3.12=py36_1\r\n- readline=6.2=0\r\n- setuptools=36.6.0=py36_1\r\n- simplegeneric=0.8.1=py36_0\r\n- six=1.11.0=py36_1\r\n- sortedcontainers=1.5.7=py36_0\r\n- sqlite=3.13.0=1\r\n- tblib=1.3.2=py36_0\r\n- tk=8.5.19=2\r\n- toolz=0.8.2=py_2\r\n- tornado=4.5.2=py36_0\r\n- traitlets=4.3.2=py36_0\r\n- wcwidth=0.1.7=py36_0\r\n- wheel=0.30.0=py_1\r\n- xz=5.2.3=0\r\n- yaml=0.1.6=0\r\n- zict=0.1.3=py_0\r\n- zlib=1.2.8=3\r\n```\r\n\r\n</details>",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/2793/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/2793/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}