[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/755497020",
        "html_url": "https://github.com/dask/dask/issues/7036#issuecomment-755497020",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7036",
        "id": 755497020,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTQ5NzAyMA==",
        "user": {
            "login": "sjperkins",
            "id": 3530212,
            "node_id": "MDQ6VXNlcjM1MzAyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3530212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sjperkins",
            "html_url": "https://github.com/sjperkins",
            "followers_url": "https://api.github.com/users/sjperkins/followers",
            "following_url": "https://api.github.com/users/sjperkins/following{/other_user}",
            "gists_url": "https://api.github.com/users/sjperkins/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sjperkins/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sjperkins/subscriptions",
            "organizations_url": "https://api.github.com/users/sjperkins/orgs",
            "repos_url": "https://api.github.com/users/sjperkins/repos",
            "events_url": "https://api.github.com/users/sjperkins/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sjperkins/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-06T18:40:35Z",
        "updated_at": "2021-01-06T18:40:35Z",
        "author_association": "MEMBER",
        "body": "Client.{persist,compute,submit} optimizes the graph, thereby reifying all the layers into a low-level dict graph which is then placed in a BasicLayer before being supplied to _graph_to_futures.\r\n\r\nDisabling fuse optimization (as in the test case) seems to prevent layer reification.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/755497020/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/755628670",
        "html_url": "https://github.com/dask/dask/issues/7036#issuecomment-755628670",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7036",
        "id": 755628670,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTYyODY3MA==",
        "user": {
            "login": "sjperkins",
            "id": 3530212,
            "node_id": "MDQ6VXNlcjM1MzAyMTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3530212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sjperkins",
            "html_url": "https://github.com/sjperkins",
            "followers_url": "https://api.github.com/users/sjperkins/followers",
            "following_url": "https://api.github.com/users/sjperkins/following{/other_user}",
            "gists_url": "https://api.github.com/users/sjperkins/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sjperkins/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sjperkins/subscriptions",
            "organizations_url": "https://api.github.com/users/sjperkins/orgs",
            "repos_url": "https://api.github.com/users/sjperkins/repos",
            "events_url": "https://api.github.com/users/sjperkins/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sjperkins/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-06T20:16:54Z",
        "updated_at": "2021-01-06T20:16:54Z",
        "author_association": "MEMBER",
        "body": "Blockwise Layer rewrites should work:\r\n\r\n* https://github.com/dask/dask/commit/ede43a536cc25ad8e2611c59058f415436ae8764#diff-a31a4643eaa3520346f749f64955b32f94e304b855a18cc319d9bfdebd916922R205* https://github.com/dask/dask/commit/ede43a536cc25ad8e2611c59058f415436ae8764#diff-b2b064ba4d14c2c4d3c14bb57d0cda3849f084625015bb61f2ec1f7ffe8195ccR989\r\n* https://github.com/dask/dask/commit/ede43a536cc25ad8e2611c59058f415436ae8764#diff-b2b064ba4d14c2c4d3c14bb57d0cda3849f084625015bb61f2ec1f7ffe8195ccR1173\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/755628670/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/880763749",
        "html_url": "https://github.com/dask/dask/issues/7036#issuecomment-880763749",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7036",
        "id": 880763749,
        "node_id": "MDEyOklzc3VlQ29tbWVudDg4MDc2Mzc0OQ==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-07-15T14:56:58Z",
        "updated_at": "2021-07-15T14:56:58Z",
        "author_association": "MEMBER",
        "body": "OK, so it seems like a plan to resolve this would be to get dask array in a good enough place that we no longer need low-level task fusion and then this problem goes away.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/880763749/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1063557574",
        "html_url": "https://github.com/dask/dask/issues/7036#issuecomment-1063557574",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7036",
        "id": 1063557574,
        "node_id": "IC_kwDOAbcwm84_ZJnG",
        "user": {
            "login": "gjoseph92",
            "id": 3309802,
            "node_id": "MDQ6VXNlcjMzMDk4MDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3309802?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/gjoseph92",
            "html_url": "https://github.com/gjoseph92",
            "followers_url": "https://api.github.com/users/gjoseph92/followers",
            "following_url": "https://api.github.com/users/gjoseph92/following{/other_user}",
            "gists_url": "https://api.github.com/users/gjoseph92/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/gjoseph92/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/gjoseph92/subscriptions",
            "organizations_url": "https://api.github.com/users/gjoseph92/orgs",
            "repos_url": "https://api.github.com/users/gjoseph92/repos",
            "events_url": "https://api.github.com/users/gjoseph92/events{/privacy}",
            "received_events_url": "https://api.github.com/users/gjoseph92/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-10T01:22:12Z",
        "updated_at": "2022-03-10T01:22:12Z",
        "author_association": "MEMBER",
        "body": "> it seems like a plan to resolve this would be to get dask array in a good enough place that we no longer need low-level task fusion\r\n\r\nJust want to note that I don't think this is a viable solution.\r\n\r\n1. It's going to be a ton of work. There's a lot of low-level graph code in both Array and DataFrame that's not going to get high-level-ified that soon (hence https://github.com/dask/dask/issues/8447).\r\n2. Other things (delayed, bag) that use low-level graphs will still lose their annotations through `fuse`.\r\n\r\nBasically, we're not going to get rid of low-level optimizations anytime soon. So I think we need to make them deal with these high-level features correctly.\r\n\r\nI think the better approach would be to require the optimization-function interface to take and return HLGs only, and update all optimization functions to preserve annotations. If an optimization function needs to materialize the graph, it can still return a `MaterializedLayer`, it just needs to be responsible for passing along the annotations appropriately (as I understand, the annotations dict can contain per-key annotations, so you just need to [expand the annotations](https://github.com/dask/dask/blob/5602876f3389d039aba0d1a860922777843dbcb9/dask/highlevelgraph.py#L223-L235)). For some optimizations, this will be trivial; for other like `fuse`, it'll actually require a little work to figure out when the can/can't be propagated to the new keys.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1063557574/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1064812125",
        "html_url": "https://github.com/dask/dask/issues/7036#issuecomment-1064812125",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7036",
        "id": 1064812125,
        "node_id": "IC_kwDOAbcwm84_d75d",
        "user": {
            "login": "eriknw",
            "id": 2058401,
            "node_id": "MDQ6VXNlcjIwNTg0MDE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2058401?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/eriknw",
            "html_url": "https://github.com/eriknw",
            "followers_url": "https://api.github.com/users/eriknw/followers",
            "following_url": "https://api.github.com/users/eriknw/following{/other_user}",
            "gists_url": "https://api.github.com/users/eriknw/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/eriknw/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/eriknw/subscriptions",
            "organizations_url": "https://api.github.com/users/eriknw/orgs",
            "repos_url": "https://api.github.com/users/eriknw/repos",
            "events_url": "https://api.github.com/users/eriknw/events{/privacy}",
            "received_events_url": "https://api.github.com/users/eriknw/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-11T06:23:08Z",
        "updated_at": "2022-03-11T06:23:08Z",
        "author_association": "MEMBER",
        "body": "> I think the better approach would be to [...] update all optimization functions to preserve annotations.\r\n\r\nI'm pretty familiar with low level optimizations, but less so with annotations, so I could probably take a stab at this.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1064812125/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]