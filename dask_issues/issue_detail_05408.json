{
    "url": "https://api.github.com/repos/dask/dask/issues/5408",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/5408/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/5408/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/5408/events",
    "html_url": "https://github.com/dask/dask/issues/5408",
    "id": 493600647,
    "node_id": "MDU6SXNzdWU0OTM2MDA2NDc=",
    "number": 5408,
    "title": "test_temporary_directory sporadically fails when run with xdist",
    "user": {
        "login": "QuLogic",
        "id": 302469,
        "node_id": "MDQ6VXNlcjMwMjQ2OQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/302469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/QuLogic",
        "html_url": "https://github.com/QuLogic",
        "followers_url": "https://api.github.com/users/QuLogic/followers",
        "following_url": "https://api.github.com/users/QuLogic/following{/other_user}",
        "gists_url": "https://api.github.com/users/QuLogic/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/QuLogic/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/QuLogic/subscriptions",
        "organizations_url": "https://api.github.com/users/QuLogic/orgs",
        "repos_url": "https://api.github.com/users/QuLogic/repos",
        "events_url": "https://api.github.com/users/QuLogic/events{/privacy}",
        "received_events_url": "https://api.github.com/users/QuLogic/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 1887344368,
            "node_id": "MDU6TGFiZWwxODg3MzQ0MzY4",
            "url": "https://api.github.com/repos/dask/dask/labels/tests",
            "name": "tests",
            "color": "a0f9b4",
            "default": false,
            "description": "Unit tests and/or continuous integration"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2019-09-14T08:46:49Z",
    "updated_at": "2021-10-13T01:32:03Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "When running with `pytest-xdist`, the `test_temporary_directory` test seems to fail sporadically:\r\n```pytb\r\n___________________________ test_temporary_directory ___________________________\r\n[gw1] linux -- Python 3.8.0 /usr/bin/python3\r\n\r\ntmpdir = local('/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_temporary_directory0')\r\n\r\n    def test_temporary_directory(tmpdir):\r\n        from multiprocessing.pool import Pool\r\n    \r\n        df = pd.DataFrame(\r\n            {\r\n                \"x\": np.random.random(100),\r\n                \"y\": np.random.random(100),\r\n                \"z\": np.random.random(100),\r\n            }\r\n        )\r\n        ddf = dd.from_pandas(df, npartitions=10, name=\"x\", sort=False)\r\n    \r\n        # We use a pool to avoid a race condition between the pool close\r\n        # cleaning up files, and the assert below.\r\n        pool = Pool(4)\r\n        with pool:\r\n            with dask.config.set(\r\n                temporary_directory=str(tmpdir), scheduler=\"processes\", pool=pool\r\n            ):\r\n                ddf2 = ddf.set_index(\"x\", shuffle=\"disk\")\r\n>               ddf2.compute()\r\n\r\ndask/dataframe/tests/test_shuffle.py:774: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\ndask/base.py:175: in compute\r\n    (result,) = compute(self, traverse=False, **kwargs)\r\ndask/base.py:446: in compute\r\n    results = schedule(dsk, keys, **kwargs)\r\ndask/multiprocessing.py:197: in get\r\n    result = get_async(\r\ndask/local.py:491: in get_async\r\n    raise_exception(exc, tb)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nexc = FileNotFoundError()\r\ntb = '  File \"/builddir/build/BUILD/dask-2.4.0/dask/local.py\", line 233, in execute_task\\n    result = _execute_task(task, ... \"/usr/lib/python3.8/site-packages/locket/__init__.py\", line 152, in acquire\\n    self._file = open(self._path, \"w\")\\n'\r\n\r\n    def reraise(exc, tb):\r\n        exc = remote_exception(exc, tb)\r\n>       raise exc\r\nE       dask.multiprocessing.FileNotFoundError: [Errno 2] No such file or directory: '/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_temporary_directory0/tmp6gdd1xok.partd/.lock'\r\nE       \r\nE       Traceback\r\nE       ---------\r\nE         File \"/builddir/build/BUILD/dask-2.4.0/dask/local.py\", line 233, in execute_task\r\nE           result = _execute_task(task, data)\r\nE         File \"/builddir/build/BUILD/dask-2.4.0/dask/core.py\", line 119, in _execute_task\r\nE           return func(*args2)\r\nE         File \"/builddir/build/BUILD/dask-2.4.0/dask/dataframe/shuffle.py\", line 641, in shuffle_group_3\r\nE           p.append(d, fsync=True)\r\nE         File \"/usr/lib/python3.8/site-packages/partd/encode.py\", line 25, in append\r\nE           self.partd.append(data, **kwargs)\r\nE         File \"/usr/lib/python3.8/site-packages/partd/file.py\", line 37, in append\r\nE           if lock: self.lock.acquire()\r\nE         File \"/usr/lib/python3.8/site-packages/locket/__init__.py\", line 99, in acquire\r\nE           lock.acquire()\r\nE         File \"/usr/lib/python3.8/site-packages/locket/__init__.py\", line 152, in acquire\r\nE           self._file = open(self._path, \"w\")\r\n\r\ndask/multiprocessing.py:110: FileNotFoundError\r\n```\r\nIt might be related to #5104, but there's no backtrace there, so I'm not sure.",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/5408/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/5408/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}