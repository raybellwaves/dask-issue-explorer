[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/382659854",
        "html_url": "https://github.com/dask/dask/issues/3403#issuecomment-382659854",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/3403",
        "id": 382659854,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM4MjY1OTg1NA==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2018-04-19T08:50:18Z",
        "updated_at": "2018-04-19T08:50:18Z",
        "author_association": "MEMBER",
        "body": "Thanks for the bug report @ckaz02 .  Can I ask you for a reproducible example that a developer can copy-paste to easily see the issue that you're having?  This makes it more likely that a volunteer will take a closer look at your problem.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/382659854/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/384218595",
        "html_url": "https://github.com/dask/dask/issues/3403#issuecomment-384218595",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/3403",
        "id": 384218595,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDIxODU5NQ==",
        "user": {
            "login": "joergdietrich",
            "id": 1462921,
            "node_id": "MDQ6VXNlcjE0NjI5MjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1462921?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/joergdietrich",
            "html_url": "https://github.com/joergdietrich",
            "followers_url": "https://api.github.com/users/joergdietrich/followers",
            "following_url": "https://api.github.com/users/joergdietrich/following{/other_user}",
            "gists_url": "https://api.github.com/users/joergdietrich/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/joergdietrich/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/joergdietrich/subscriptions",
            "organizations_url": "https://api.github.com/users/joergdietrich/orgs",
            "repos_url": "https://api.github.com/users/joergdietrich/repos",
            "events_url": "https://api.github.com/users/joergdietrich/events{/privacy}",
            "received_events_url": "https://api.github.com/users/joergdietrich/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2018-04-25T09:12:08Z",
        "updated_at": "2018-04-25T09:50:04Z",
        "author_association": "CONTRIBUTOR",
        "body": "This reproduces the report above:\r\n\r\n```\r\nimport numpy as np\r\nimport pandas as pd\r\nimport dask.dataframe as dd\r\n\r\ndf1 = pd.DataFrame({'value1': [0.5, 0.25, 0.25],\r\n                    'value2': [0.6, 0.2, 0.2]},\r\n                   index=['a', 'b', 'c'])\r\n\r\ndf2 = pd.DataFrame({'value1': np.random.randint(100, size=1_000_000),\r\n                    'value2': np.random.randint(100, size=1_000_000),\r\n                    'type': np.random.choice(['a', 'b', 'c'], size=1_000_000)})\r\n\r\nddf = dd.from_pandas(df2, npartitions=124)\r\nddf = ddf.set_index('type')\r\nassert ddf.npartitions == 124\r\nddm = ddf.mul(df1)\r\nddm.npartitions\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/384218595/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/384225684",
        "html_url": "https://github.com/dask/dask/issues/3403#issuecomment-384225684",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/3403",
        "id": 384225684,
        "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDIyNTY4NA==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2018-04-25T09:37:09Z",
        "updated_at": "2018-04-25T09:37:09Z",
        "author_association": "MEMBER",
        "body": "Thank you for the excellent reproducer @joergdietrich !  This really helps.\r\n\r\nI think that this can be tracked down to this line:\r\n\r\nhttps://github.com/dask/dask/blob/daeaaaa3bcf65aab753c5a7b24d7c6f4cb92ddc7/dask/dataframe/multi.py#L107\r\n\r\nI think that the reason why we see a decrease in the number of partitions is that the division values are not unique.  When multiple dataframes interact we first align them so that they have the same division structure (for example so that all rows indexed with 'a' are in the same partition).  When index values are the same across division boundaries (as will necessarily be the case when you have fewer unique values than partitions) then this becomes hard.  \r\n\r\nWe have no way to ensure that corresponding rows are in corresponding partitions without constraining partitions to have disjoint index values.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/384225684/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]