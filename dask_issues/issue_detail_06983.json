{
    "url": "https://api.github.com/repos/dask/dask/issues/6983",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/6983/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/6983/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/6983/events",
    "html_url": "https://github.com/dask/dask/issues/6983",
    "id": 769338602,
    "node_id": "MDU6SXNzdWU3NjkzMzg2MDI=",
    "number": 6983,
    "title": "\"Event loop was unresponsive in Worker\" during df.set_index",
    "user": {
        "login": "stephanie-wang",
        "id": 2560516,
        "node_id": "MDQ6VXNlcjI1NjA1MTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stephanie-wang",
        "html_url": "https://github.com/stephanie-wang",
        "followers_url": "https://api.github.com/users/stephanie-wang/followers",
        "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
        "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
        "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
        "repos_url": "https://api.github.com/users/stephanie-wang/repos",
        "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
        "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862289,
            "node_id": "MDU6TGFiZWwyNDI4NjIyODk=",
            "url": "https://api.github.com/repos/dask/dask/labels/dataframe",
            "name": "dataframe",
            "color": "fbca04",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2020-12-16T23:13:22Z",
    "updated_at": "2021-10-14T06:13:25Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!-- Please include a self-contained copy-pastable example that generates the issue if possible.\r\n\r\nPlease be concise with code posted. See guidelines below on how to provide a good bug report:\r\n\r\n- Craft Minimal Bug Reports http://matthewrocklin.com/blog/work/2018/02/28/minimal-bug-reports\r\n- Minimal Complete Verifiable Examples https://stackoverflow.com/help/mcve\r\n\r\nBug reports that follow these guidelines are easier to diagnose, and so are often handled much more quickly.\r\n-->\r\n\r\n**What happened**:\r\n\r\nI'm trying to call df.set_index on a large dataframe (10GB, with 64GiB RAM) and am seeing lots of errors, followed by Dask worker crashes and restarts. At first, I see 100% CPU usage, then close to 0% CPU with some disk writes from Dask workers (which I assume is spilling to disk), then many errors like this:\r\n```\r\ndistributed.core - INFO - Event loop was unresponsive in Worker for 7.13s.  This is often caused by long-running GIL-holding functions or moving large chunks of data. This can cause timeouts and instability.\r\n```\r\n\r\nEventually, the workers seem to get repeatedly killed and restarted, and I think the script is not making any progress.\r\n\r\nI tried also experimenting with the number of partitions (10, 20, 50). With fewer partitions, I get this error instead (also eventually crashes):\r\n\r\n```\r\ndistributed.worker - WARNING - Memory use is high but worker has no data to store to disk.  Perhaps some other process is leaking memory?  Process memory: 3.25 GB -- Worker memory limit: 4.12 GB\r\n```\r\n\r\n**What you expected to happen**: I thought this would spill to disk if needed, but wasn't expecting the crashes. It's possible this would have finished successfully after some time, but it seemed like no progress was being made (I killed it after several minutes).\r\n\r\n**Minimal Complete Verifiable Example**: [Here](https://gist.github.com/stephanie-wang/842669be51a263e5637c0e5ba0236132) is a minimal script that reproduces the issue. It uses Dask to generate one file per partition, then calls `df.set_index().compute()`.\r\nRun this script with `python dask_sort.py --nbytes 10_000_000_000` (sort 10GB of data, 100 partitions of 100MB each).\r\n\r\n**Anything else we need to know?**: \r\n\r\n**Environment**:\r\n\r\n- Dask version: 2.23 (Dask.distributed, dask-worker with --nprocs 16 --nthreads 1)\r\n- Python version: 3.6\r\n- Operating System: Ubuntu 18.04, Ubuntu 18.04, 16 CPU, 64GiB RAM.\r\n- Install method (conda, pip, source): pip\r\n\r\nI'm not sure if this is the right place for this, or if something is wrong with my setup. Please let me know if so!",
    "closed_by": {
        "login": "stephanie-wang",
        "id": 2560516,
        "node_id": "MDQ6VXNlcjI1NjA1MTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2560516?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stephanie-wang",
        "html_url": "https://github.com/stephanie-wang",
        "followers_url": "https://api.github.com/users/stephanie-wang/followers",
        "following_url": "https://api.github.com/users/stephanie-wang/following{/other_user}",
        "gists_url": "https://api.github.com/users/stephanie-wang/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/stephanie-wang/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/stephanie-wang/subscriptions",
        "organizations_url": "https://api.github.com/users/stephanie-wang/orgs",
        "repos_url": "https://api.github.com/users/stephanie-wang/repos",
        "events_url": "https://api.github.com/users/stephanie-wang/events{/privacy}",
        "received_events_url": "https://api.github.com/users/stephanie-wang/received_events",
        "type": "User",
        "site_admin": false
    },
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/6983/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/6983/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}