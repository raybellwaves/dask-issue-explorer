[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1787324184",
        "html_url": "https://github.com/dask/dask/issues/10566#issuecomment-1787324184",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10566",
        "id": 1787324184,
        "node_id": "IC_kwDOAbcwm85qiGcY",
        "user": {
            "login": "rjzamora",
            "id": 20461013,
            "node_id": "MDQ6VXNlcjIwNDYxMDEz",
            "avatar_url": "https://avatars.githubusercontent.com/u/20461013?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rjzamora",
            "html_url": "https://github.com/rjzamora",
            "followers_url": "https://api.github.com/users/rjzamora/followers",
            "following_url": "https://api.github.com/users/rjzamora/following{/other_user}",
            "gists_url": "https://api.github.com/users/rjzamora/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/rjzamora/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/rjzamora/subscriptions",
            "organizations_url": "https://api.github.com/users/rjzamora/orgs",
            "repos_url": "https://api.github.com/users/rjzamora/repos",
            "events_url": "https://api.github.com/users/rjzamora/events{/privacy}",
            "received_events_url": "https://api.github.com/users/rjzamora/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-10-31T14:24:42Z",
        "updated_at": "2023-10-31T14:24:42Z",
        "author_association": "MEMBER",
        "body": "Thanks for raising this issue @Martmists-GH (and for submitting #10588).  Can you share [a reproducer](http://matthewrocklin.com/blog/work/2018/02/28/minimal-bug-reports)?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1787324184/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1787572731",
        "html_url": "https://github.com/dask/dask/issues/10566#issuecomment-1787572731",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10566",
        "id": 1787572731,
        "node_id": "IC_kwDOAbcwm85qjDH7",
        "user": {
            "login": "Martmists-GH",
            "id": 16361449,
            "node_id": "MDQ6VXNlcjE2MzYxNDQ5",
            "avatar_url": "https://avatars.githubusercontent.com/u/16361449?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Martmists-GH",
            "html_url": "https://github.com/Martmists-GH",
            "followers_url": "https://api.github.com/users/Martmists-GH/followers",
            "following_url": "https://api.github.com/users/Martmists-GH/following{/other_user}",
            "gists_url": "https://api.github.com/users/Martmists-GH/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Martmists-GH/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Martmists-GH/subscriptions",
            "organizations_url": "https://api.github.com/users/Martmists-GH/orgs",
            "repos_url": "https://api.github.com/users/Martmists-GH/repos",
            "events_url": "https://api.github.com/users/Martmists-GH/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Martmists-GH/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-10-31T16:31:45Z",
        "updated_at": "2023-10-31T16:35:11Z",
        "author_association": "NONE",
        "body": "```py\r\n>>> import pandas as pd\r\n>>> import dask.dataframe as dd\r\n>>> df = pd.DataFrame({\"a\":[1,1,2,2],\"b\":[1,2,3,4],\"c\":[\"w\",\"x\",\"y\",\"z\"]})\r\n>>> ddf = dd.from_pandas(df, npartitions=1)\r\n>>> ddf.groupby(\"a\").agg(d=pd.NamedAgg(\"b\", \"sum\"))\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/mart/.pyenv/versions/temp/lib/python3.11/site-packages/dask/dataframe/groupby.py\", line 339, in wrapper\r\n    raise NotImplementedError(\r\nNotImplementedError: 'numeric_only=False' is not implemented in Dask.\r\n>>> ddf.groupby(\"a\").agg(numeric_only=True, d=pd.NamedAgg(\"b\", \"sum\"))\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/mart/.pyenv/versions/temp/lib/python3.11/site-packages/dask/dataframe/groupby.py\", line 352, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/mart/.pyenv/versions/temp/lib/python3.11/site-packages/dask/dataframe/groupby.py\", line 2928, in agg\r\n    return self.aggregate(\r\n           ^^^^^^^^^^^^^^^\r\n  File \"/home/mart/.pyenv/versions/temp/lib/python3.11/site-packages/dask/dataframe/groupby.py\", line 2917, in aggregate\r\n    return super().aggregate(\r\n           ^^^^^^^^^^^^^^^^^^\r\n  File \"/home/mart/.pyenv/versions/temp/lib/python3.11/site-packages/dask/dataframe/groupby.py\", line 2222, in aggregate\r\n    relabeling, arg, columns, order = reconstruct_func(arg, **kwargs)\r\n                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/mart/.pyenv/versions/temp/lib/python3.11/site-packages/pandas/core/apply.py\", line 1476, in reconstruct_func\r\n    raise TypeError(\"Must provide 'func' or tuples of '(column, aggfunc).\")\r\nTypeError: Must provide 'func' or tuples of '(column, aggfunc).\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1787572731/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1800971373",
        "html_url": "https://github.com/dask/dask/issues/10566#issuecomment-1800971373",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10566",
        "id": 1800971373,
        "node_id": "IC_kwDOAbcwm85rWKRt",
        "user": {
            "login": "tRosenflanz",
            "id": 25041325,
            "node_id": "MDQ6VXNlcjI1MDQxMzI1",
            "avatar_url": "https://avatars.githubusercontent.com/u/25041325?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tRosenflanz",
            "html_url": "https://github.com/tRosenflanz",
            "followers_url": "https://api.github.com/users/tRosenflanz/followers",
            "following_url": "https://api.github.com/users/tRosenflanz/following{/other_user}",
            "gists_url": "https://api.github.com/users/tRosenflanz/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tRosenflanz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tRosenflanz/subscriptions",
            "organizations_url": "https://api.github.com/users/tRosenflanz/orgs",
            "repos_url": "https://api.github.com/users/tRosenflanz/repos",
            "events_url": "https://api.github.com/users/tRosenflanz/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tRosenflanz/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-11-08T03:54:15Z",
        "updated_at": "2023-11-08T03:54:15Z",
        "author_association": "NONE",
        "body": "Having the same issue",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1800971373/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1800997103",
        "html_url": "https://github.com/dask/dask/issues/10566#issuecomment-1800997103",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10566",
        "id": 1800997103,
        "node_id": "IC_kwDOAbcwm85rWQjv",
        "user": {
            "login": "tRosenflanz",
            "id": 25041325,
            "node_id": "MDQ6VXNlcjI1MDQxMzI1",
            "avatar_url": "https://avatars.githubusercontent.com/u/25041325?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tRosenflanz",
            "html_url": "https://github.com/tRosenflanz",
            "followers_url": "https://api.github.com/users/tRosenflanz/followers",
            "following_url": "https://api.github.com/users/tRosenflanz/following{/other_user}",
            "gists_url": "https://api.github.com/users/tRosenflanz/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tRosenflanz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tRosenflanz/subscriptions",
            "organizations_url": "https://api.github.com/users/tRosenflanz/orgs",
            "repos_url": "https://api.github.com/users/tRosenflanz/repos",
            "events_url": "https://api.github.com/users/tRosenflanz/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tRosenflanz/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-11-08T04:07:19Z",
        "updated_at": "2023-11-08T04:07:44Z",
        "author_association": "NONE",
        "body": "Found a workaround. Since the code only checks for `numeric_only = False`, we can just pass numeric_only as some random aggregation and it will pass as it is numeric_only is no longer False. The column can be dropped afterwards.\r\n\r\n`ddf.groupby(\"a\").agg(numeric_only=d=pd.NamedAgg(\"b\", \"sum\"), d=pd.NamedAgg(\"b\", \"sum\")).drop(columns=['numeric_only'])` works as intended \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1800997103/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1801278120",
        "html_url": "https://github.com/dask/dask/issues/10566#issuecomment-1801278120",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10566",
        "id": 1801278120,
        "node_id": "IC_kwDOAbcwm85rXVKo",
        "user": {
            "login": "Martmists-GH",
            "id": 16361449,
            "node_id": "MDQ6VXNlcjE2MzYxNDQ5",
            "avatar_url": "https://avatars.githubusercontent.com/u/16361449?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Martmists-GH",
            "html_url": "https://github.com/Martmists-GH",
            "followers_url": "https://api.github.com/users/Martmists-GH/followers",
            "following_url": "https://api.github.com/users/Martmists-GH/following{/other_user}",
            "gists_url": "https://api.github.com/users/Martmists-GH/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Martmists-GH/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Martmists-GH/subscriptions",
            "organizations_url": "https://api.github.com/users/Martmists-GH/orgs",
            "repos_url": "https://api.github.com/users/Martmists-GH/repos",
            "events_url": "https://api.github.com/users/Martmists-GH/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Martmists-GH/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-11-08T08:05:14Z",
        "updated_at": "2023-11-08T08:05:14Z",
        "author_association": "NONE",
        "body": "we ended up using pyasm to inject a `kwargs.pop('numeric_only')` at the start of the function as temporary workaround.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1801278120/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1952085529",
        "html_url": "https://github.com/dask/dask/issues/10566#issuecomment-1952085529",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10566",
        "id": 1952085529,
        "node_id": "IC_kwDOAbcwm850WnYZ",
        "user": {
            "login": "CarlaFernandez",
            "id": 9136877,
            "node_id": "MDQ6VXNlcjkxMzY4Nzc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9136877?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/CarlaFernandez",
            "html_url": "https://github.com/CarlaFernandez",
            "followers_url": "https://api.github.com/users/CarlaFernandez/followers",
            "following_url": "https://api.github.com/users/CarlaFernandez/following{/other_user}",
            "gists_url": "https://api.github.com/users/CarlaFernandez/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/CarlaFernandez/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/CarlaFernandez/subscriptions",
            "organizations_url": "https://api.github.com/users/CarlaFernandez/orgs",
            "repos_url": "https://api.github.com/users/CarlaFernandez/repos",
            "events_url": "https://api.github.com/users/CarlaFernandez/events{/privacy}",
            "received_events_url": "https://api.github.com/users/CarlaFernandez/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-02-19T09:55:03Z",
        "updated_at": "2024-02-19T09:55:03Z",
        "author_association": "NONE",
        "body": "Having this same issue, any updates?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1952085529/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1952349078",
        "html_url": "https://github.com/dask/dask/issues/10566#issuecomment-1952349078",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10566",
        "id": 1952349078,
        "node_id": "IC_kwDOAbcwm850XnuW",
        "user": {
            "login": "Martmists-GH",
            "id": 16361449,
            "node_id": "MDQ6VXNlcjE2MzYxNDQ5",
            "avatar_url": "https://avatars.githubusercontent.com/u/16361449?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Martmists-GH",
            "html_url": "https://github.com/Martmists-GH",
            "followers_url": "https://api.github.com/users/Martmists-GH/followers",
            "following_url": "https://api.github.com/users/Martmists-GH/following{/other_user}",
            "gists_url": "https://api.github.com/users/Martmists-GH/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Martmists-GH/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Martmists-GH/subscriptions",
            "organizations_url": "https://api.github.com/users/Martmists-GH/orgs",
            "repos_url": "https://api.github.com/users/Martmists-GH/repos",
            "events_url": "https://api.github.com/users/Martmists-GH/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Martmists-GH/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-02-19T12:28:42Z",
        "updated_at": "2024-02-19T12:28:42Z",
        "author_association": "NONE",
        "body": "Here's what we ended up doing. Note that this doesn't cover all versions (only made with 3.10 and 3.11 in mind), and may segfault on incorrect versions or newer/changed versions of dask.\r\n\r\n```py\r\nimport sys\r\nimport dask.dataframe as dd\r\nfrom warnings import warn\r\n\r\nif sys.version_info < (3, 11):\r\n    from asm import Deserializer, Serializer, Label, LOAD_FAST, LOAD_ATTR, LOAD_CONST, CALL_FUNCTION, POP_TOP, \\\r\n        POP_JUMP_IF_FALSE, CALL_FUNCTION_KW, RETURN_VALUE, code_replace\r\nelse:\r\n    from asm import Deserializer, Serializer, Label, PUSH_NULL, LOAD_FAST, LOAD_ATTR, LOAD_CONST, PRECALL, CALL, \\\r\n        POP_TOP, POP_JUMP_FORWARD_IF_FALSE, RESUME, KW_NAMES, RETURN_VALUE, code_replace\r\n\r\n# Call this only once!\r\ndef patch_agg_numeric_only():\r\n    # Dask groupby doesn't like named aggregation with numeric_only=True because they forget to remove it from kwargs.\r\n    # This patch adds the following code to the beginning of the function:\r\n    # if kwargs.get('numeric_only'):\r\n    #     kwargs.pop('numeric_only')\r\n\r\n    code = unwrap(dd.groupby.DataFrameGroupBy.agg).__code__\r\n    ops = Deserializer(code).deserialize()\r\n\r\n    label = Label()\r\n    if sys.version_info >= (3, 11):\r\n        injected = [\r\n            RESUME(0),\r\n            PUSH_NULL(),\r\n            LOAD_FAST('kwargs'),\r\n            LOAD_ATTR('get'),\r\n            LOAD_CONST('numeric_only'),\r\n            PRECALL(1),\r\n            CALL(1),\r\n            POP_JUMP_FORWARD_IF_FALSE(label),\r\n            PUSH_NULL(),\r\n            LOAD_FAST('kwargs'),\r\n            LOAD_ATTR('pop'),\r\n            LOAD_CONST('numeric_only'),\r\n            PRECALL(1),\r\n            CALL(1),\r\n            POP_TOP(),\r\n            label,\r\n        ]\r\n        # Remove the old RESUME op\r\n        ops = injected + ops[1:]\r\n    else:\r\n        injected = [\r\n            LOAD_FAST('kwargs'),\r\n            LOAD_ATTR('get'),\r\n            LOAD_CONST('numeric_only'),\r\n            CALL_FUNCTION(1),\r\n            POP_JUMP_IF_FALSE(label),\r\n            LOAD_FAST('kwargs'),\r\n            LOAD_ATTR('pop'),\r\n            LOAD_CONST('numeric_only'),\r\n            CALL_FUNCTION(1),\r\n            POP_TOP(),\r\n            label,\r\n        ]\r\n        ops = injected + ops\r\n\r\n    code = Serializer(ops, code).serialize()\r\n    unwrap(dd.groupby.DataFrameGroupBy.agg).__code__ = code\r\n    warn(UserWarning(\r\n        \"Experimental patch applied.\\n\"\r\n        \"NOTE: Patched dd.groupby.DataFrameGroupBy.agg to remove numeric_only=True\\n\"\r\n        \"      If this is no longer necessary starting from a given dask version, add a version check to\"\r\n        \" monitoring_tool.util.patch_agg_numeric_only\\n\"\r\n        f\"      if version_from_string(dask.__version__) >= {version_from_string(dask.__version__)}:\\n          return\"\r\n    ))\r\n\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1952349078/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]