{
    "url": "https://api.github.com/repos/dask/dask/issues/10325",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/10325/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/10325/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/10325/events",
    "html_url": "https://github.com/dask/dask/issues/10325",
    "id": 1734025431,
    "node_id": "I_kwDOAbcwm85nWyDX",
    "number": 10325,
    "title": "Should we disable fusion by default?",
    "user": {
        "login": "crusaderky",
        "id": 6213168,
        "node_id": "MDQ6VXNlcjYyMTMxNjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6213168?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/crusaderky",
        "html_url": "https://github.com/crusaderky",
        "followers_url": "https://api.github.com/users/crusaderky/followers",
        "following_url": "https://api.github.com/users/crusaderky/following{/other_user}",
        "gists_url": "https://api.github.com/users/crusaderky/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/crusaderky/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/crusaderky/subscriptions",
        "organizations_url": "https://api.github.com/users/crusaderky/orgs",
        "repos_url": "https://api.github.com/users/crusaderky/repos",
        "events_url": "https://api.github.com/users/crusaderky/events{/privacy}",
        "received_events_url": "https://api.github.com/users/crusaderky/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 1372867996,
            "node_id": "MDU6TGFiZWwxMzcyODY3OTk2",
            "url": "https://api.github.com/repos/dask/dask/labels/discussion",
            "name": "discussion",
            "color": "bebaf4",
            "default": false,
            "description": "Discussing a topic with no specific actions yet"
        },
        {
            "id": 3468123446,
            "node_id": "LA_kwDOAbcwm87Ot102",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20attention",
            "name": "needs attention",
            "color": "6d626c",
            "default": false,
            "description": "It's been a while since this was pushed on. Needs attention from the owner or a maintainer."
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2023-05-31T11:46:13Z",
    "updated_at": "2023-07-03T02:07:11Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "The setting `optimization.fuse.active: true` is problematic:\r\n\r\n- It destroys annotations. This means that anybody who wishes to use, namely, resources together with collections will need to know they need to disable it, or nothing will work.\r\n\r\n- It materializes the graph on the client instead of the scheduler; this in turn means that the (*non-parallelizable*) time to pickle, transfer, and unpickle the graph on `compute()` or `persist()` suddenly starts scaling with the number of chunks; this is particularly painful if the client-scheduler connection is relatively narrowband.\r\nNamely, in Coiled the scheduler is on AWS EC2 while the client is typically on premises. I've tried submitting medium-sized computations to Coiled from a cafe's wifi and it was *not* a good user experience - the setting added several *minutes* to the head of the computation.\r\n\r\n- It's an expensive operation in its own right, which can cause a net slowdown: #9795 \r\n\r\n- Annotations, part 2: I'm currently implementing https://github.com/dask/distributed/issues/7860, which are based on annotations, and would like to use them in [coiled/benchmarks](https://github.com/coiled/benchmarks). I could, of course, disable fusion in coiled/benchmarks only - but that would mean it would benchmark something that is substantially different from the typical user experience - which goes against the whole idea behind the test suite.\r\n\r\n#### Shouldn't we just set `optimization.fuse.active: false` by default?\r\n\r\nI've run an A/B test on coiled/benchmarks, which shows mild to non-existent speed-up end-to-end. Note that these tests run in 2\\~20 minutes each on a small-ish cluster (20\\~80 CPUs), so the cost of optimization, pickle, graph transfer, and unpickle is modest overall.\r\n\r\n![download](https://github.com/dask/dask/assets/6213168/48b49b13-6b82-4b8a-b00b-5d29a6cbceb4)\r\n\r\n\r\nThe A/B tests also show a noticeable increase in memory usage in a couple of tests, which I intend to investigate. \r\n\r\n![download (1)](https://github.com/dask/dask/assets/6213168/baaa1fac-a06d-49bd-8ee0-72032fdb3c97)\r\n\r\nCC @fjetter @mrocklin @rjzamora @martindurant ",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/10325/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/10325/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}