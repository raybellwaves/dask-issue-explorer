{
    "url": "https://api.github.com/repos/dask/dask/issues/8435",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/8435/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/8435/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/8435/events",
    "html_url": "https://github.com/dask/dask/issues/8435",
    "id": 1067687316,
    "node_id": "I_kwDOAbcwm84_o52U",
    "number": 8435,
    "title": "[Discussion] Don't compute divisions by default in `set_index`?",
    "user": {
        "login": "gjoseph92",
        "id": 3309802,
        "node_id": "MDQ6VXNlcjMzMDk4MDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3309802?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gjoseph92",
        "html_url": "https://github.com/gjoseph92",
        "followers_url": "https://api.github.com/users/gjoseph92/followers",
        "following_url": "https://api.github.com/users/gjoseph92/following{/other_user}",
        "gists_url": "https://api.github.com/users/gjoseph92/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gjoseph92/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gjoseph92/subscriptions",
        "organizations_url": "https://api.github.com/users/gjoseph92/orgs",
        "repos_url": "https://api.github.com/users/gjoseph92/repos",
        "events_url": "https://api.github.com/users/gjoseph92/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gjoseph92/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862289,
            "node_id": "MDU6TGFiZWwyNDI4NjIyODk=",
            "url": "https://api.github.com/repos/dask/dask/labels/dataframe",
            "name": "dataframe",
            "color": "fbca04",
            "default": false,
            "description": null
        },
        {
            "id": 1372867996,
            "node_id": "MDU6TGFiZWwxMzcyODY3OTk2",
            "url": "https://api.github.com/repos/dask/dask/labels/discussion",
            "name": "discussion",
            "color": "bebaf4",
            "default": false,
            "description": "Discussing a topic with no specific actions yet"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2021-11-30T21:21:24Z",
    "updated_at": "2022-03-03T19:41:18Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "Calling `df.set_index('foo')` currently calculates all of `df` immediately, in order to pick values for `divisions`. This is helpful, but also makes it very easy to trigger a large computation, and the eagerness is inconsistent with Dask's lazy API.\r\n\r\nDownsides of this are illustrated in [this blog post](https://targomo.medium.com/how-we-learned-to-love-dask-and-achieved-a-40x-speedup-aa14e72d99c0#534f) by @DahnJ. This default behavior makes it very easy for you to do something that's very not performant, and relatively hard to figure out why it's happening.\r\n\r\nIf you're running a whole script (versus a notebook with separate cells), it would not be immediately clear that `set_index` is even calling compute internally, and you'll be left puzzling over the dashboard about why the \"calculation seems to re-set and begin again\".\r\n\r\nAdditionally, since it's so easy to compute divisions automatically, users rarely interact with them. This makes the idea of setting them manually intimidating, when in fact it's actually pretty straightforward. (Hopefully better documentation helps with this https://github.com/dask/dask/pull/8379). And since users don't interact with them, they wouldn't realize there's even an option to avoid this computation until they read the docstring of `set_index`.\r\n\r\nBasically, I think _not_ passing divisions to `set_index` should be considered an antipattern. There are only a few cases where it's unavoidable and you need to calculate divisions, and it's always far less performant.\r\n\r\nTherefore, if we agree it's an antipattern, we should have our API guide users away from it (the \"pit of success\").\r\n\r\nSo I propose:\r\n```python-traceback\r\n>>> df.set_index('foo')\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n...\r\nValueError: No divisions specified. Pass `divisions=[...]` to specify the \"dividing lines\" used to split\r\nthe new index into partitions.\r\n\r\nAlternatively, pass `divisions=\"compute\"` to have Dask compute good divisions for you right now.\r\nThis can be expensive, since it computes the entire DataFrame eagerly.\r\nIf you use `divisions=\"compute\"`, we recommend printing the `.divisions` of the resulting DataFrame\r\nand copy-pasting them back into this line of code, so if you re-run it, divisions won't be re-calculated.\r\n\r\nFor more information, see https://docs.dask.org/en/stable/generated/dask.dataframe.DataFrame.set_index.html.\r\n```\r\n\r\nThis way:\r\n1. Users have to be explicitly aware of the eager compute, and have to ask for it.\r\n2. Users can't pick the antipattern without first being presented with the recommended alternative.\r\n3. The `\"compute\"` in the code is hopefully a flag to other readers that some computation is going on; you don't have to know `set_index`'s default behavior to recognize this.\r\n\r\nOf course, we'd have a deprecation cycle with a warning before this became an error. I'd also be excited to add some tools to help users:\r\n1. Generate reasonable divisions when they know something about the data (save typing)\r\n2. Check whether the divisions they've picked are good\r\n3. Suggest \"how\" to pick divisions?\r\n\r\ncc @jsignell @scharlottej13 @ian-r-rose @jrbourbeau @jcrist ",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/8435/reactions",
        "total_count": 4,
        "+1": 4,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/8435/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}