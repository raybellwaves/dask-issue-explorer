{
    "url": "https://api.github.com/repos/dask/dask/issues/10554",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/10554/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/10554/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/10554/events",
    "html_url": "https://github.com/dask/dask/issues/10554",
    "id": 1936057156,
    "node_id": "I_kwDOAbcwm85zZeNE",
    "number": 10554,
    "title": "Broken static typing of `Array.shape`",
    "user": {
        "login": "headtr1ck",
        "id": 43316012,
        "node_id": "MDQ6VXNlcjQzMzE2MDEy",
        "avatar_url": "https://avatars.githubusercontent.com/u/43316012?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/headtr1ck",
        "html_url": "https://github.com/headtr1ck",
        "followers_url": "https://api.github.com/users/headtr1ck/followers",
        "following_url": "https://api.github.com/users/headtr1ck/following{/other_user}",
        "gists_url": "https://api.github.com/users/headtr1ck/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/headtr1ck/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/headtr1ck/subscriptions",
        "organizations_url": "https://api.github.com/users/headtr1ck/orgs",
        "repos_url": "https://api.github.com/users/headtr1ck/repos",
        "events_url": "https://api.github.com/users/headtr1ck/events{/privacy}",
        "received_events_url": "https://api.github.com/users/headtr1ck/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 3468123446,
            "node_id": "LA_kwDOAbcwm87Ot102",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20attention",
            "name": "needs attention",
            "color": "6d626c",
            "default": false,
            "description": "It's been a while since this was pushed on. Needs attention from the owner or a maintainer."
        },
        {
            "id": 3880424463,
            "node_id": "LA_kwDOAbcwm87nSpQP",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20triage",
            "name": "needs triage",
            "color": "eeeeee",
            "default": false,
            "description": "Needs a response from a contributor"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2023-10-10T19:21:03Z",
    "updated_at": "2023-11-13T01:46:28Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!-- Please include a self-contained copy-pastable example that generates the issue if possible.\r\n\r\nPlease be concise with code posted. See guidelines below on how to provide a good bug report:\r\n\r\n- Craft Minimal Bug Reports http://matthewrocklin.com/blog/work/2018/02/28/minimal-bug-reports\r\n- Minimal Complete Verifiable Examples https://stackoverflow.com/help/mcve\r\n\r\nBug reports that follow these guidelines are easier to diagnose, and so are often handled much more quickly.\r\n-->\r\n\r\n**Describe the issue**:\r\n\r\nWhile trying to define an array-api compliant array protocol I came upon the following problem:\r\n\r\nThe static typing of `Array.shape` is broken.\r\nMypy and pyright both report Any / Unkown.\r\nIt should be `tuple[T_IntOrNaN, ...]`\r\n\r\n**Minimal Complete Verifiable Example**:\r\n\r\n```python\r\nfrom dask.array import from_array\r\n\r\na = from_array([1, 2, 3])\r\nreveal_type(a.shape)\r\n# mypy output:\r\n# note: Revealed type is \"Any\"\r\n# pyright output:\r\n# information: Type of \"a.shape\" is \"Unknown\"\r\n```\r\n\r\n**Fix**:\r\n\r\nChange https://github.com/dask/dask/blob/1a9ba0107995eb0c9c7d91c71adf31877b7de440/dask/utils.py#L1976 to\r\n\r\n```python\r\nclass cached_property(functools.cached_property, Generic[T]):\r\n    \"\"\"Read only version of functools.cached_property.\"\"\"\r\n\r\n    def __init__(self, func: Callable[[Any], T]) -> None:\r\n        super().__init__(func)\r\n\r\n    def __set__(self, instance, val) -> NoReturn:\r\n        \"\"\"Raise an error when attempting to set a cached property.\"\"\"\r\n        raise AttributeError(\"Can't set attribute\")\r\n\r\n    def __get__(self, instance, owner=None) -> T:\r\n        return super().__get__(instance, owner)\r\n```\r\n\r\n**Anything else we need to know?**:\r\n\r\nOn a side note: Is there any reason why you use `float(\"nan\")` instead of None for undefined shapes?\r\nThe array api standard recommends to use None in this case.\r\n\r\n**Environment**:\r\n\r\n- Dask version: 2023.9.3\r\n- Python version: 3.9\r\n- Operating System: win10\r\n- Install method (conda, pip, source): pip\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/10554/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/10554/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}