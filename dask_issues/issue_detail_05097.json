{
    "url": "https://api.github.com/repos/dask/dask/issues/5097",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/5097/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/5097/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/5097/events",
    "html_url": "https://github.com/dask/dask/issues/5097",
    "id": 467768916,
    "node_id": "MDU6SXNzdWU0Njc3Njg5MTY=",
    "number": 5097,
    "title": "Have dask array use the information contained in gufuncs to create the \"test\" _meta run",
    "user": {
        "login": "eteq",
        "id": 346587,
        "node_id": "MDQ6VXNlcjM0NjU4Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/346587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eteq",
        "html_url": "https://github.com/eteq",
        "followers_url": "https://api.github.com/users/eteq/followers",
        "following_url": "https://api.github.com/users/eteq/following{/other_user}",
        "gists_url": "https://api.github.com/users/eteq/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/eteq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/eteq/subscriptions",
        "organizations_url": "https://api.github.com/users/eteq/orgs",
        "repos_url": "https://api.github.com/users/eteq/repos",
        "events_url": "https://api.github.com/users/eteq/events{/privacy}",
        "received_events_url": "https://api.github.com/users/eteq/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862305,
            "node_id": "MDU6TGFiZWwyNDI4NjIzMDU=",
            "url": "https://api.github.com/repos/dask/dask/labels/array",
            "name": "array",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2019-07-13T21:38:13Z",
    "updated_at": "2019-07-24T15:55:19Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "This could be viewed as either a bug or feature request, but here's the gist of the problem:\r\n\r\n```\r\nimport numpy as np\r\n\r\nimport dask.array as da\r\nfrom astropy import _erfa\r\n\r\na = da.from_array(np.random.randn(1000,3,3), chunks=100)\r\n_erfa.bpn2xy(a)\r\n```\r\nwhich raises the following exception:\r\n```\r\nValueError: `dtype` inference failed in `apply_gufunc`.\r\n\r\nPlease specify the dtype explicitly using the `output_dtypes` kwarg.\r\n\r\nOriginal error is below:\r\n------------------------\r\nValueError('bpn2xy: Input operand 0 has a mismatch in its core dimension 1, with gufunc signature (d3, d3)->(),() (size 1 is different from fixed size 3)',)\r\n\r\nTraceback:\r\n---------\r\n  File \".../dask/array/core.py\", line 340, in apply_infer_dtype\r\n    o = func(*args, **kwargs)\r\n```\r\n\r\nThe fix (from some out-of-band discussion with @mrocklin) would likely be to have dask use `np.empty_like` to build the new `_meta`, but use the information in the `gufunc` to ensure it's the right shape (in this case that's ``(0, 3, 3)``, but of course it depends on the specific gufunc).",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/5097/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/5097/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}