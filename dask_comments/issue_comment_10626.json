[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1805845728",
        "html_url": "https://github.com/dask/dask/issues/10626#issuecomment-1805845728",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10626",
        "id": 1805845728,
        "node_id": "IC_kwDOAbcwm85rowTg",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-11-10T14:31:42Z",
        "updated_at": "2023-11-10T14:31:42Z",
        "author_association": "MEMBER",
        "body": "We're going to have regressions as we change Parquet.  I'm not concerned\r\nyet.  I think that we should look at a bunch of these holistically.\r\n(probably what you're thinking too, just mentioning it)\r\n\r\nOn Fri, Nov 10, 2023 at 4:25\u202fAM Florian Jetter ***@***.***>\r\nwrote:\r\n\r\n> Tt turns out we do have performance tests that cover the edge case of very\r\n> large files w/ row groups after all, see #10600\r\n> <https://github.com/dask/dask/pull/10600>\r\n>\r\n> The data we have stored in\r\n> https://s3.console.aws.amazon.com/s3/buckets/coiled-runtime-ci?prefix=ookla-open-data/type%3Dfixed/&region=us-east-2\r\n>\r\n> The files in there are 400-500MB on disk (Still have to check details\r\n> about the RGs. We're splitting this up into 61 parts, i.e. we have on\r\n> average 4.7 RGs/tasks per file)\r\n>\r\n> This is used by the test_read_hive_partitioned_data in coiled benchmarks\r\n>\r\n> Wall Clock\r\n> [image: image]\r\n> <https://user-images.githubusercontent.com/8629629/282013709-fd77e1ea-b887-4ef4-aef2-e4d422aae672.png>\r\n>\r\n> Average Memory\r\n> [image: image]\r\n> <https://user-images.githubusercontent.com/8629629/282013754-85289319-6ae0-42f4-9150-793887cb42c7.png>\r\n>\r\n> With this change, this test no longer splits the files into smaller tasks.\r\n> Therefore, the memory goes up since the operation performed on this dataset\r\n> reduces immediately. This is expected.\r\n> The walltime performance is however very misleading since there are a\r\n> couple of things happening here\r\n>\r\n>    - Since we no longer split the files we now have fewer tasks and can't\r\n>    utilize all the workers. That alone is a drop of 13% (13/15)\r\n>    - There is some sort of S3 caching problem going on as well that seems\r\n>    to be exacerbated by having fewer tasks. I suspect that with the split\r\n>    rowgroups approach, S3 naturally warms up since we are touching the files\r\n>    multiple times such that the first (couple) row group access is slow but\r\n>    the later are fast. If I warm up s3, this runtime goes down from 50 to ~13s\r\n>    (vs 9s with a warm cache for the split row groups w/ already cached PQ\r\n>    statistics)\r\n>\r\n> \u2014\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/dask/dask/issues/10626>, or unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/AACKZTHPHKEHNUSOAULX7ELYDXXKNAVCNFSM6AAAAAA7F4B736VHI2DSMVQWIX3LMV43ASLTON2WKOZRHE4DOMRUGE3TANQ>\r\n> .\r\n> You are receiving this because you are subscribed to this thread.Message\r\n> ID: ***@***.***>\r\n>\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1805845728/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1805855288",
        "html_url": "https://github.com/dask/dask/issues/10626#issuecomment-1805855288",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10626",
        "id": 1805855288,
        "node_id": "IC_kwDOAbcwm85royo4",
        "user": {
            "login": "fjetter",
            "id": 8629629,
            "node_id": "MDQ6VXNlcjg2Mjk2Mjk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8629629?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fjetter",
            "html_url": "https://github.com/fjetter",
            "followers_url": "https://api.github.com/users/fjetter/followers",
            "following_url": "https://api.github.com/users/fjetter/following{/other_user}",
            "gists_url": "https://api.github.com/users/fjetter/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/fjetter/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/fjetter/subscriptions",
            "organizations_url": "https://api.github.com/users/fjetter/orgs",
            "repos_url": "https://api.github.com/users/fjetter/repos",
            "events_url": "https://api.github.com/users/fjetter/events{/privacy}",
            "received_events_url": "https://api.github.com/users/fjetter/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-11-10T14:35:25Z",
        "updated_at": "2023-11-10T14:35:25Z",
        "author_association": "MEMBER",
        "body": "> We're going to have regressions as we change Parquet.  I'm not concerned\r\n\r\nI'm not worried about the regression in case that wasn't clear. I opened this to share some info/insights around the cold/warm S3 behavior that seems to be connected to the file splitting. We may be able to use this to warm up files even if we're not splitting by row groups",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1805855288/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]