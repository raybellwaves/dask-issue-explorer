[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1065461441",
        "html_url": "https://github.com/dask/dask/issues/8800#issuecomment-1065461441",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8800",
        "id": 1065461441,
        "node_id": "IC_kwDOAbcwm84_gabB",
        "user": {
            "login": "jsignell",
            "id": 4806877,
            "node_id": "MDQ6VXNlcjQ4MDY4Nzc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4806877?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jsignell",
            "html_url": "https://github.com/jsignell",
            "followers_url": "https://api.github.com/users/jsignell/followers",
            "following_url": "https://api.github.com/users/jsignell/following{/other_user}",
            "gists_url": "https://api.github.com/users/jsignell/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jsignell/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jsignell/subscriptions",
            "organizations_url": "https://api.github.com/users/jsignell/orgs",
            "repos_url": "https://api.github.com/users/jsignell/repos",
            "events_url": "https://api.github.com/users/jsignell/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jsignell/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-11T20:02:23Z",
        "updated_at": "2022-03-11T20:02:23Z",
        "author_association": "MEMBER",
        "body": "Thanks for writing this up! I am able to reproduce. I think it has to do with the assigment to a new column that comes after the groupby. Here is what I'm working with:\r\n\r\n```python\r\nimport dask\r\n\r\nddf = dask.datasets.timeseries(freq=\"5min\").reset_index()\r\nddf[\"time_plot\"] = ddf.timestamp.dt.round(freq=\"15 min\")\r\nddf['seconds_elapsed'] = ddf.groupby(\"time_plot\").timestamp.transform(\r\n    lambda x: (x - x.min()).dt.seconds\r\n)\r\nddf.compute()\r\n```\r\nCompare this with the following which doesn't raise an error:\r\n\r\n```python\r\nimport dask\r\n\r\nddf = dask.datasets.timeseries(freq=\"5min\").reset_index()\r\nddf[\"time_plot\"] = ddf.timestamp.dt.round(freq=\"15 min\")\r\nddf.groupby(\"time_plot\").timestamp.transform(\r\n    lambda x: (x - x.min()).dt.seconds\r\n).compute()\r\n```\r\n\r\nSo the issue is coming from the assignment which is complaining because the index is non-unique. Specifically I think there is an issue because the index that the groupby returns is both non-unique and out of order. This is very related to https://github.com/dask/dask/issues/8749 and https://github.com/dask/dask/pull/8659#issuecomment-1037266953",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1065461441/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1066090215",
        "html_url": "https://github.com/dask/dask/issues/8800#issuecomment-1066090215",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8800",
        "id": 1066090215,
        "node_id": "IC_kwDOAbcwm84_iz7n",
        "user": {
            "login": "guidocioni",
            "id": 12760310,
            "node_id": "MDQ6VXNlcjEyNzYwMzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/12760310?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/guidocioni",
            "html_url": "https://github.com/guidocioni",
            "followers_url": "https://api.github.com/users/guidocioni/followers",
            "following_url": "https://api.github.com/users/guidocioni/following{/other_user}",
            "gists_url": "https://api.github.com/users/guidocioni/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/guidocioni/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/guidocioni/subscriptions",
            "organizations_url": "https://api.github.com/users/guidocioni/orgs",
            "repos_url": "https://api.github.com/users/guidocioni/repos",
            "events_url": "https://api.github.com/users/guidocioni/events{/privacy}",
            "received_events_url": "https://api.github.com/users/guidocioni/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-13T12:21:33Z",
        "updated_at": "2022-03-13T12:21:33Z",
        "author_association": "NONE",
        "body": "Yeah that's right.\r\nI have to say the assignment of a groupby.apply operation to the original dataframe often causes issues...\r\nAny idea why you don't get this error if converting the dask dataframe to a pandas dataframe before? The index should be the same...right?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1066090215/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1067052989",
        "html_url": "https://github.com/dask/dask/issues/8800#issuecomment-1067052989",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/8800",
        "id": 1067052989,
        "node_id": "IC_kwDOAbcwm84_me-9",
        "user": {
            "login": "jsignell",
            "id": 4806877,
            "node_id": "MDQ6VXNlcjQ4MDY4Nzc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4806877?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jsignell",
            "html_url": "https://github.com/jsignell",
            "followers_url": "https://api.github.com/users/jsignell/followers",
            "following_url": "https://api.github.com/users/jsignell/following{/other_user}",
            "gists_url": "https://api.github.com/users/jsignell/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jsignell/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jsignell/subscriptions",
            "organizations_url": "https://api.github.com/users/jsignell/orgs",
            "repos_url": "https://api.github.com/users/jsignell/repos",
            "events_url": "https://api.github.com/users/jsignell/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jsignell/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-14T16:48:34Z",
        "updated_at": "2022-03-14T16:48:34Z",
        "author_association": "MEMBER",
        "body": "> Yeah that's right. I have to say the assignment of a groupby.apply operation to the original dataframe often causes issues... Any idea why you don't get this error if converting the dask dataframe to a pandas dataframe before? The index should be the same...right?\r\n\r\nYeah I think in pandas the data doesn't really get shuffled, so when assigning the output to the column in the dataframe the indices match. For dask on the other hand, the indices don't match so that's when the reindex happens and then it throws an error because the index values are non-unique. \r\n\r\nThat's my current understanding anyways. So I think a global monotonically increasing index would resolve this. That was one of the suggestions in the issues I linked.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1067052989/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]