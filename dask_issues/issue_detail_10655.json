{
    "url": "https://api.github.com/repos/dask/dask/issues/10655",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/10655/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/10655/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/10655/events",
    "html_url": "https://github.com/dask/dask/issues/10655",
    "id": 2014964859,
    "node_id": "I_kwDOAbcwm854Gex7",
    "number": 10655,
    "title": "Resampling to Time Period End Fails",
    "user": {
        "login": "mfenner1",
        "id": 913036,
        "node_id": "MDQ6VXNlcjkxMzAzNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/913036?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mfenner1",
        "html_url": "https://github.com/mfenner1",
        "followers_url": "https://api.github.com/users/mfenner1/followers",
        "following_url": "https://api.github.com/users/mfenner1/following{/other_user}",
        "gists_url": "https://api.github.com/users/mfenner1/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mfenner1/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mfenner1/subscriptions",
        "organizations_url": "https://api.github.com/users/mfenner1/orgs",
        "repos_url": "https://api.github.com/users/mfenner1/repos",
        "events_url": "https://api.github.com/users/mfenner1/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mfenner1/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 3880424463,
            "node_id": "LA_kwDOAbcwm87nSpQP",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20triage",
            "name": "needs triage",
            "color": "eeeeee",
            "default": false,
            "description": "Needs a response from a contributor"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2023-11-28T17:38:28Z",
    "updated_at": "2023-11-28T17:38:40Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "**Describe the issue**:\r\nResampling to end of period frequencies (end of quarter, end of month -- `Q`, `M`) fails when the last day in the period is included in the to-be-resampled dask dataframe.\r\n\r\n**Minimal Complete Verifiable Example**:\r\n\r\n```python\r\n# the following demonstrates the error\r\n# while the index is a bit wonky, the same error occurs if it is a\r\n# \"complete\" date_range generated index from 01-01 to 01-31\r\nindex =pd.DatetimeIndex(['2023-01-01', '2023-01-31'])\r\ndf = pd.DataFrame({'value':[1,2]}, index=index)\r\nddf = dd.from_pandas(df, npartitions=1)\r\nprint(\"month (start):\")\r\nprint(ddf.resample('MS').size().compute())\r\nprint(\"month (end):\")\r\nprint(ddf.resample('M').size().compute())\r\n```\r\n```\r\nmonth (start):\r\n2023-01-01    2\r\nFreq: MS, dtype: int64\r\nmonth (end):\r\n()\r\n```\r\n\r\nFor comparison, consider the following with only a tiny modification (to include Jan. 30 and not Jan. 31):\r\n```python\r\n# the following works as expected\r\nindex =pd.DatetimeIndex(['2023-01-01', '2023-01-30'])\r\ndf = pd.DataFrame({'value':[1,2]}, index=index)\r\nddf = dd.from_pandas(df, npartitions=1)\r\nprint(\"month (start):\")\r\nprint(ddf.resample('MS').size().compute())\r\nprint(\"month (end):\")\r\nprint(ddf.resample('M').size().compute())\r\n```\r\n```\r\nmonth (start):\r\n2023-01-01    2\r\nFreq: MS, dtype: int64\r\nmonth (end):\r\n2023-01-31    2\r\nFreq: M, dtype: int64\r\n```\r\n\r\n**Anything else we need to know?**:\r\nIn trying to track down and/or figure out what's going on with https://github.com/dask/dask/issues/10607, I started playing around with smaller input sizes (and got away from parquet as a moving part).  I've been pointing my debugger at dask/dataframe/tseries/resample.py, namely `_resample_bin_and_out_divs` and `Resampler._agg` ...... however, I haven't pursued that with my recent tiny testcase.  Hoping to get to that in the next couple days.\r\n\r\nThe same issue occurs with Q (quarter end) resampling.\r\n\r\n\r\n**Environment**:\r\n- Dask version: dask: 2023.10.1 / pandas: 2.0.3\r\n- Python version: 3.11.5\r\n- Operating System: OSX\r\n- Install method (conda, pip, source): conda + conda-forge for more recent dask\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/10655/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/10655/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}