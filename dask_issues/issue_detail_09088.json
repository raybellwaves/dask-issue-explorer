{
    "url": "https://api.github.com/repos/dask/dask/issues/9088",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/9088/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/9088/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/9088/events",
    "html_url": "https://github.com/dask/dask/issues/9088",
    "id": 1236139006,
    "node_id": "I_kwDOAbcwm85Jrfv-",
    "number": 9088,
    "title": "to_csv save mode default & options",
    "user": {
        "login": "MrPowers",
        "id": 2722395,
        "node_id": "MDQ6VXNlcjI3MjIzOTU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2722395?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MrPowers",
        "html_url": "https://github.com/MrPowers",
        "followers_url": "https://api.github.com/users/MrPowers/followers",
        "following_url": "https://api.github.com/users/MrPowers/following{/other_user}",
        "gists_url": "https://api.github.com/users/MrPowers/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/MrPowers/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/MrPowers/subscriptions",
        "organizations_url": "https://api.github.com/users/MrPowers/orgs",
        "repos_url": "https://api.github.com/users/MrPowers/repos",
        "events_url": "https://api.github.com/users/MrPowers/events{/privacy}",
        "received_events_url": "https://api.github.com/users/MrPowers/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862289,
            "node_id": "MDU6TGFiZWwyNDI4NjIyODk=",
            "url": "https://api.github.com/repos/dask/dask/labels/dataframe",
            "name": "dataframe",
            "color": "fbca04",
            "default": false,
            "description": null
        },
        {
            "id": 365513534,
            "node_id": "MDU6TGFiZWwzNjU1MTM1MzQ=",
            "url": "https://api.github.com/repos/dask/dask/labels/io",
            "name": "io",
            "color": "6f871c",
            "default": false,
            "description": ""
        },
        {
            "id": 1372867996,
            "node_id": "MDU6TGFiZWwxMzcyODY3OTk2",
            "url": "https://api.github.com/repos/dask/dask/labels/discussion",
            "name": "discussion",
            "color": "bebaf4",
            "default": false,
            "description": "Discussing a topic with no specific actions yet"
        },
        {
            "id": 3468123446,
            "node_id": "LA_kwDOAbcwm87Ot102",
            "url": "https://api.github.com/repos/dask/dask/labels/needs%20attention",
            "name": "needs attention",
            "color": "6d626c",
            "default": false,
            "description": "It's been a while since this was pushed on. Needs attention from the owner or a maintainer."
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2022-05-14T23:04:48Z",
    "updated_at": "2022-06-20T02:12:57Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "This issue summarizes the current behavior of the `mode` flag in `to_csv`, when it behaves unexpectedly, and what options users are likely to want.\r\n\r\nThe default `to_csv` save mode is \"wt\", but the docs say \"w\", so that's a little typo to fix.\r\n\r\npandas has different `to_csv` write modes like w+, w, and a.\r\n\r\nDask `to_csv` uses fsspec `open_files` under the hood, which has write modes like \u2018rb\u2019, \u2018wt\u2019, etc.\r\n\r\nIt's hard to decipher the exhaustive list of write modes in the [pandas docs](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html), [fsspec docs](https://filesystem-spec.readthedocs.io/en/latest/api.html), and [Dask docs](https://docs.dask.org/en/stable/generated/dask.dataframe.to_csv.html).  It doesn't seem like any of the docs are providing complete lists.\r\n\r\nMy first goal is to create the list of all the write modes available to Dask users and get them in the docs.  Dask users can presumably use the \"rb\" write mode, but I'm not actually sure what that stands for.\r\n\r\nI did some experimentation and here's the behavior of the save modes I'm observing.  Let's start by writing some data.\r\n\r\n```python\r\nimport dask.dataframe as dd\r\nimport pandas as pd\r\n\r\ndf = pd.DataFrame(\r\n    {\"num1\": [1, 2, 3, 4], \"num2\": [7, 8, 9, 10]},\r\n)\r\n\r\ndf = dd.from_pandas(df, npartitions=2)\r\n\r\ndf.to_csv(\"csv_danger\")\r\n```\r\n\r\nThis will output the following files:\r\n\r\n```\r\ncsv_danger/\r\n  0.part\r\n  1.part\r\n```\r\n\r\nWe cannot append to a directory so the following code will correctly error out with `IsADirectoryError`:\r\n\r\n```python\r\ndf = pd.DataFrame(\r\n    {\"firstname\": [\"cat\"], \"lastname\": [\"dog\"]},\r\n)\r\n\r\nddf = dd.from_pandas(df, npartitions=1)\r\n\r\nddf.to_csv(\"csv_danger\", mode=\"a\")\r\n```\r\n\r\nWe can append to a file:\r\n\r\n```python\r\ndf = pd.DataFrame(\r\n    {\"num1\": [10, 20], \"num2\": [70, 80]},\r\n)\r\n\r\ndf = dd.from_pandas(df, npartitions=1)\r\n\r\ndf.to_csv(\"csv_danger/0.part\", mode=\"a\")\r\n```\r\n\r\nAppending to a file probably only works on localhost and not in a cloud storage system.  I suppose that's alright.\r\n\r\nNow let's try `w+` save mode:\r\n\r\n```python\r\ndf = pd.DataFrame(\r\n    {\"num1\": [10, 20], \"num2\": [70, 80]},\r\n)\r\n\r\ndf = dd.from_pandas(df, npartitions=1)\r\n\r\ndf.to_csv(\"csv_danger\", mode=\"w+\")\r\n```\r\n\r\n`w+` save mode will overwrite `0.part` and leave `1.part` unchanged.  I would have expected for all the files in the `csv_danger` to get deleted.\r\n\r\nLet's try `w` save mode.\r\n\r\n```python\r\ndf = pd.DataFrame(\r\n    {\"num1\": [88, 99], \"num2\": [2, 3]},\r\n)\r\n\r\ndf = dd.from_pandas(df, npartitions=1)\r\n\r\ndf.to_csv(\"csv_danger\", mode=\"w\")\r\n```\r\n\r\nThis also overwrites `0.part` and leaves `1.part` unchanged.\r\n\r\nLet's try `wt` save mode, which is the default:\r\n\r\n```python\r\ndf = pd.DataFrame(\r\n    {\"num1\": [66, 77], \"num2\": [5, 6]},\r\n)\r\n\r\ndf = dd.from_pandas(df, npartitions=1)\r\n\r\ndf.to_csv(\"csv_danger\", mode=\"wt\")\r\n```\r\n\r\nThis also only overwrites `0.part` and doesn't touch `1.part`.\r\n\r\nAs a user, here are the save modes I would like:\r\n\r\n* overwrite: delete all the existing files and perform a write with new data\r\n* append: append files to the existing directory (without touching the existing files).  Append is a bad word here because Dask uses append to indicate appending data to an existing file.  Not sure what to call this.  I don't want filenames to conflict when adding additional files to a folder.\r\n* errorifexists: if the directory already contains data, then error out and don't perform a write\r\n\r\nI don't personally ever want the current Dask default behavior which is overwriting some files and leaving the others untouched.  The \"partial clobber\" write mode is something I'd like to avoid.\r\n\r\nNext steps:\r\n\r\n* Let's figure out all the current write mode options & document their behavior\r\n* Let's decide on if other write modes should be exposed to users.\r\n* Let's think about how we can be compatible with other Dask writer APIs.  Users can run `ddf.to_parquet(\"some/dir\", overwrite=True)` for example.  \r\n\r\nMy preference will probably be to add a separate option to all writers with consistent options.  `ddf.to_csv(\"something\", save_mode=\"overwrite\")` and `ddf.to_parquet(\"something\", save_mode=\"overwrite\")` would be nice.  The pandas writer APIs aren't consistent so they'll be of limited use here (`pandas.DataFrame.to_parquet`, `pandas.DataFrame.to_json`, and `pandas.DataFrame.to_csv` don't have a unified `save_mode` with options that are consistent throughout).",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/9088/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/9088/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}