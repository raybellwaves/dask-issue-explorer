[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1235749674",
        "html_url": "https://github.com/dask/dask/issues/9454#issuecomment-1235749674",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9454",
        "id": 1235749674,
        "node_id": "IC_kwDOAbcwm85JqAsq",
        "user": {
            "login": "phobson",
            "id": 1163939,
            "node_id": "MDQ6VXNlcjExNjM5Mzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1163939?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/phobson",
            "html_url": "https://github.com/phobson",
            "followers_url": "https://api.github.com/users/phobson/followers",
            "following_url": "https://api.github.com/users/phobson/following{/other_user}",
            "gists_url": "https://api.github.com/users/phobson/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/phobson/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/phobson/subscriptions",
            "organizations_url": "https://api.github.com/users/phobson/orgs",
            "repos_url": "https://api.github.com/users/phobson/repos",
            "events_url": "https://api.github.com/users/phobson/events{/privacy}",
            "received_events_url": "https://api.github.com/users/phobson/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-02T17:30:51Z",
        "updated_at": "2022-09-02T17:30:51Z",
        "author_association": "MEMBER",
        "body": "@miguelcarcamov thanks for the issue and clear example.\r\n\r\nIf I understand correctly, this function would work properly with in-memory numpy arrays, and so this question is more about how to work around dask's limitation in fancy indexing and less about the implementation details of array-based bilinear interpolation.\r\n\r\nIs that right?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1235749674/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1235751309",
        "html_url": "https://github.com/dask/dask/issues/9454#issuecomment-1235751309",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9454",
        "id": 1235751309,
        "node_id": "IC_kwDOAbcwm85JqBGN",
        "user": {
            "login": "miguelcarcamov",
            "id": 5432126,
            "node_id": "MDQ6VXNlcjU0MzIxMjY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5432126?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/miguelcarcamov",
            "html_url": "https://github.com/miguelcarcamov",
            "followers_url": "https://api.github.com/users/miguelcarcamov/followers",
            "following_url": "https://api.github.com/users/miguelcarcamov/following{/other_user}",
            "gists_url": "https://api.github.com/users/miguelcarcamov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/miguelcarcamov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/miguelcarcamov/subscriptions",
            "organizations_url": "https://api.github.com/users/miguelcarcamov/orgs",
            "repos_url": "https://api.github.com/users/miguelcarcamov/repos",
            "events_url": "https://api.github.com/users/miguelcarcamov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/miguelcarcamov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-02T17:33:02Z",
        "updated_at": "2022-09-02T17:51:29Z",
        "author_association": "NONE",
        "body": "@phobson Yes, exactly - it's about to work around dask's fancy indexing. I have been told to use `map_overlap` but I'm not quite sure how to use it to do the same....",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1235751309/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1235777269",
        "html_url": "https://github.com/dask/dask/issues/9454#issuecomment-1235777269",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9454",
        "id": 1235777269,
        "node_id": "IC_kwDOAbcwm85JqHb1",
        "user": {
            "login": "phobson",
            "id": 1163939,
            "node_id": "MDQ6VXNlcjExNjM5Mzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1163939?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/phobson",
            "html_url": "https://github.com/phobson",
            "followers_url": "https://api.github.com/users/phobson/followers",
            "following_url": "https://api.github.com/users/phobson/following{/other_user}",
            "gists_url": "https://api.github.com/users/phobson/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/phobson/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/phobson/subscriptions",
            "organizations_url": "https://api.github.com/users/phobson/orgs",
            "repos_url": "https://api.github.com/users/phobson/repos",
            "events_url": "https://api.github.com/users/phobson/events{/privacy}",
            "received_events_url": "https://api.github.com/users/phobson/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-02T18:06:54Z",
        "updated_at": "2022-09-02T18:06:54Z",
        "author_association": "MEMBER",
        "body": "Thanks for clarifying. I see the conversation on slack that alludes to that. I agree with Martin that the first thing I'd try is to use `.map_overlap`.\r\n\r\nI also wonder if xarray supports this better, though it's hard to imagine you won't run into the same issue if the `DataArray` is backed by dask. ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1235777269/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1235780682",
        "html_url": "https://github.com/dask/dask/issues/9454#issuecomment-1235780682",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9454",
        "id": 1235780682,
        "node_id": "IC_kwDOAbcwm85JqIRK",
        "user": {
            "login": "miguelcarcamov",
            "id": 5432126,
            "node_id": "MDQ6VXNlcjU0MzIxMjY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5432126?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/miguelcarcamov",
            "html_url": "https://github.com/miguelcarcamov",
            "followers_url": "https://api.github.com/users/miguelcarcamov/followers",
            "following_url": "https://api.github.com/users/miguelcarcamov/following{/other_user}",
            "gists_url": "https://api.github.com/users/miguelcarcamov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/miguelcarcamov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/miguelcarcamov/subscriptions",
            "organizations_url": "https://api.github.com/users/miguelcarcamov/orgs",
            "repos_url": "https://api.github.com/users/miguelcarcamov/repos",
            "events_url": "https://api.github.com/users/miguelcarcamov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/miguelcarcamov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-02T18:11:19Z",
        "updated_at": "2022-09-03T14:19:33Z",
        "author_association": "NONE",
        "body": "@phobson  I have tried with map_blocks and it seems to work. However, I have changed my bilinear_interpolation function a little bit.\r\n```python\r\nimport dask.array as da\r\nimport numpy as np\r\nfrom typing import Union\r\n\r\n\r\ndef bilinear_interpolation(u: Union[float, np.ndarray, da.Array], v: Union[float, np.ndarray, da.Array], im: Union[np.ndarray, da.Array]) -> Union[float, np.ndarray, da.Array]:\r\n\r\n    u0 = np.floor(u).astype(np.int32)\r\n    u1 = u0 + 1\r\n    v0 = np.floor(v).astype(np.int32)\r\n    v1 = v0 + 1\r\n\r\n    u0 = np.clip(u0, 0, im.shape[1] - 1)\r\n    u1 = np.clip(u1, 0, im.shape[1] - 1)\r\n    v0 = np.clip(v0, 0, im.shape[0] - 1)\r\n    v1 = np.clip(v1, 0, im.shape[0] - 1)\r\n\r\n    Ia = im[v0, u0]\r\n    Ib = im[v1, u0]\r\n    Ic = im[v0, u1]\r\n    Id = im[v1, u1]\r\n\r\n    wa = (u1 - u) * (v1 - v)\r\n    wb = (u1 - u) * (v - v0)\r\n    wc = (u - u0) * (v1 - v)\r\n    wd = (u - u0) * (v - v0)\r\n\r\n    estimated_data = wa * Ia + wb * Ib + wc * Ic + wd * Id\r\n\r\n    return estimated_data\r\n```\r\nThen I have used map_blocks such that:\r\n`data = da.map_blocks(bilinear_interpolation, uv[0], uv[1], grid_fft, meta=np.array(uv[0].shape, dtype=grid_fft.dtype))`.\r\n\r\nThis seems to work. However, I have tried to use `map_overlap` since I know there might be the case that when a coordinate needs to look to a neighbour pixel the value might be in another block. And I'm getting this error:\r\n\r\n```python\r\ndata = da.map_overlap(bilinear_interpolation, uv[0], uv[1], grid_fft,\r\n                             depth=1, boundary=0, align_arrays=True, allow_rechunk=True, meta=np.array(uv[0].shape, dtype=grid_fft.dtype))\r\n\r\n\r\nValueError: Chunks do not add up to shape. Got chunks=((3000,), (48959,)), shape=(3000, 3000)\r\n```\r\nIf you can give me a hand @phobson, making map_overlap work, I would appreciate it :)  ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1235780682/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1235793067",
        "html_url": "https://github.com/dask/dask/issues/9454#issuecomment-1235793067",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9454",
        "id": 1235793067,
        "node_id": "IC_kwDOAbcwm85JqLSr",
        "user": {
            "login": "phobson",
            "id": 1163939,
            "node_id": "MDQ6VXNlcjExNjM5Mzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1163939?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/phobson",
            "html_url": "https://github.com/phobson",
            "followers_url": "https://api.github.com/users/phobson/followers",
            "following_url": "https://api.github.com/users/phobson/following{/other_user}",
            "gists_url": "https://api.github.com/users/phobson/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/phobson/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/phobson/subscriptions",
            "organizations_url": "https://api.github.com/users/phobson/orgs",
            "repos_url": "https://api.github.com/users/phobson/repos",
            "events_url": "https://api.github.com/users/phobson/events{/privacy}",
            "received_events_url": "https://api.github.com/users/phobson/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-02T18:27:15Z",
        "updated_at": "2022-09-02T18:27:15Z",
        "author_association": "MEMBER",
        "body": "@miguelcarcamov Can you provide code to generate sample input from scratch? ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1235793067/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1235798113",
        "html_url": "https://github.com/dask/dask/issues/9454#issuecomment-1235798113",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9454",
        "id": 1235798113,
        "node_id": "IC_kwDOAbcwm85JqMhh",
        "user": {
            "login": "miguelcarcamov",
            "id": 5432126,
            "node_id": "MDQ6VXNlcjU0MzIxMjY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5432126?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/miguelcarcamov",
            "html_url": "https://github.com/miguelcarcamov",
            "followers_url": "https://api.github.com/users/miguelcarcamov/followers",
            "following_url": "https://api.github.com/users/miguelcarcamov/following{/other_user}",
            "gists_url": "https://api.github.com/users/miguelcarcamov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/miguelcarcamov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/miguelcarcamov/subscriptions",
            "organizations_url": "https://api.github.com/users/miguelcarcamov/orgs",
            "repos_url": "https://api.github.com/users/miguelcarcamov/repos",
            "events_url": "https://api.github.com/users/miguelcarcamov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/miguelcarcamov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-02T18:34:22Z",
        "updated_at": "2022-09-02T18:34:22Z",
        "author_association": "NONE",
        "body": "@phobson \r\n```\r\nimport numpy as np\r\nimport dask.array as da\r\n\r\ngrid_fft = da.random.random((3000,3000)) + 1j * da.random.random((3000,3000))\r\nu = da.random.randint(0, 3000, 48959) + da.random.random(48959)\r\nv = da.random.randint(0, 3000, 48959) + da.random.random(48959)\r\nuv = (u,v)\r\n```\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1235798113/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1235832454",
        "html_url": "https://github.com/dask/dask/issues/9454#issuecomment-1235832454",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9454",
        "id": 1235832454,
        "node_id": "IC_kwDOAbcwm85JqU6G",
        "user": {
            "login": "phobson",
            "id": 1163939,
            "node_id": "MDQ6VXNlcjExNjM5Mzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1163939?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/phobson",
            "html_url": "https://github.com/phobson",
            "followers_url": "https://api.github.com/users/phobson/followers",
            "following_url": "https://api.github.com/users/phobson/following{/other_user}",
            "gists_url": "https://api.github.com/users/phobson/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/phobson/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/phobson/subscriptions",
            "organizations_url": "https://api.github.com/users/phobson/orgs",
            "repos_url": "https://api.github.com/users/phobson/repos",
            "events_url": "https://api.github.com/users/phobson/events{/privacy}",
            "received_events_url": "https://api.github.com/users/phobson/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-02T19:27:44Z",
        "updated_at": "2022-09-02T19:27:44Z",
        "author_association": "MEMBER",
        "body": "Hey @miguelcarcamov -- Thanks for the additional details. With such a good reproducible example, at this point I think it's best to migrate this question to the dask discourse. There, more community members can engage and benefit from this. ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1235832454/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1235839876",
        "html_url": "https://github.com/dask/dask/issues/9454#issuecomment-1235839876",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9454",
        "id": 1235839876,
        "node_id": "IC_kwDOAbcwm85JqWuE",
        "user": {
            "login": "miguelcarcamov",
            "id": 5432126,
            "node_id": "MDQ6VXNlcjU0MzIxMjY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5432126?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/miguelcarcamov",
            "html_url": "https://github.com/miguelcarcamov",
            "followers_url": "https://api.github.com/users/miguelcarcamov/followers",
            "following_url": "https://api.github.com/users/miguelcarcamov/following{/other_user}",
            "gists_url": "https://api.github.com/users/miguelcarcamov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/miguelcarcamov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/miguelcarcamov/subscriptions",
            "organizations_url": "https://api.github.com/users/miguelcarcamov/orgs",
            "repos_url": "https://api.github.com/users/miguelcarcamov/repos",
            "events_url": "https://api.github.com/users/miguelcarcamov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/miguelcarcamov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-02T19:39:58Z",
        "updated_at": "2022-09-02T19:39:58Z",
        "author_association": "NONE",
        "body": "@phobson I have already posted this question on the dask discourse, but nobody seems to answer :)",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1235839876/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]