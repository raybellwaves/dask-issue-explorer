{
    "url": "https://api.github.com/repos/dask/dask/issues/3727",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/3727/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/3727/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/3727/events",
    "html_url": "https://github.com/dask/dask/issues/3727",
    "id": 338667012,
    "node_id": "MDU6SXNzdWUzMzg2NjcwMTI=",
    "number": 3727,
    "title": "apply_along_axis infers output shape improperly",
    "user": {
        "login": "d-v-b",
        "id": 3805136,
        "node_id": "MDQ6VXNlcjM4MDUxMzY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3805136?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/d-v-b",
        "html_url": "https://github.com/d-v-b",
        "followers_url": "https://api.github.com/users/d-v-b/followers",
        "following_url": "https://api.github.com/users/d-v-b/following{/other_user}",
        "gists_url": "https://api.github.com/users/d-v-b/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/d-v-b/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/d-v-b/subscriptions",
        "organizations_url": "https://api.github.com/users/d-v-b/orgs",
        "repos_url": "https://api.github.com/users/d-v-b/repos",
        "events_url": "https://api.github.com/users/d-v-b/events{/privacy}",
        "received_events_url": "https://api.github.com/users/d-v-b/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862305,
            "node_id": "MDU6TGFiZWwyNDI4NjIzMDU=",
            "url": "https://api.github.com/repos/dask/dask/labels/array",
            "name": "array",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2018-07-05T17:42:49Z",
    "updated_at": "2019-04-30T15:40:22Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "My environment:\r\nPython: 3.6.6 |Anaconda custom (64-bit)\r\nDask: 0.18.1\r\n\r\nThis fails:\r\n```python\r\nimport dask.array as da\r\ndef testfun(v):\r\n    return v[0] + v[1]\r\ndar = da.random.randint(0,1, size=(2,2), chunks=('auto'))\r\nda.apply_along_axis(testfun, 0, dar)\r\n```\r\n\r\n```pytb\r\n---------------------------------------------------------------------------\r\nIndexError                                Traceback (most recent call last)\r\n<ipython-input-2-43967c9b007c> in <module>\r\n      3     return v[0] + v[1]\r\n      4 dar = da.random.randint(0,1, size=(2,2), chunks=('auto'))\r\n----> 5 da.apply_along_axis(testfun, 0, dar)\r\n\r\n~/sandbox/dask/dask/array/routines.py in apply_along_axis(func1d, axis, arr, *args, **kwargs)\r\n    321     # Test out some data with the function.\r\n    322     test_data = np.ones((1,), dtype=arr.dtype)\r\n--> 323     test_result = np.array(func1d(test_data, *args, **kwargs))\r\n    324\r\n    325     # Rechunk so that func1d is applied over the full axis.\r\n\r\n<ipython-input-2-43967c9b007c> in testfun(v)\r\n      1 import dask.array as da\r\n      2 def testfun(v):\r\n----> 3     return v[0] + v[1]\r\n      4 dar = da.random.randint(0,1, size=(2,2), chunks=('auto'))\r\n      5 da.apply_along_axis(testfun, 0, dar)\r\n\r\nIndexError: index 1 is out of bounds for axis 0 with size 1\r\n```\r\n\r\nThe reason why is because of [this line](https://github.com/dask/dask/blob/36e235d7074f01830dd79a24fd656f4cda9e2c81/dask/array/routines.py#L324) in `apply_along_axis`, where the function arg in `apply_along_axis` is applied to non-representative test data (`np.ones((1,))`) for estimating output dimensionality and dtype.\r\n\r\nAt the least, the properties of the output being inferred here (shape and dtype) should be specifiable as kwargs to `apply_along_axis` so the user can dodge having them inferred. \r\n\r\nIf these properties are going to be inferred, the sample data fed into the test function should at least match the size (and probably the dtype) of the vectors the user wants to feed `apply_along_axis` .\r\n\r\nIf I have the time I can study how this is done for comparable functions (`map_blocks` comes to mind) and submit a PR, but I may not have the time soon. ",
    "closed_by": {
        "login": "mrocklin",
        "id": 306380,
        "node_id": "MDQ6VXNlcjMwNjM4MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mrocklin",
        "html_url": "https://github.com/mrocklin",
        "followers_url": "https://api.github.com/users/mrocklin/followers",
        "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
        "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
        "organizations_url": "https://api.github.com/users/mrocklin/orgs",
        "repos_url": "https://api.github.com/users/mrocklin/repos",
        "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mrocklin/received_events",
        "type": "User",
        "site_admin": false
    },
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/3727/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/3727/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}