{
    "url": "https://api.github.com/repos/dask/dask/issues/6519",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/6519/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/6519/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/6519/events",
    "html_url": "https://github.com/dask/dask/issues/6519",
    "id": 679586602,
    "node_id": "MDU6SXNzdWU2Nzk1ODY2MDI=",
    "number": 6519,
    "title": "Issue running a large number of embarrassingly parallel tasks ",
    "user": {
        "login": "mshaikh786",
        "id": 3212475,
        "node_id": "MDQ6VXNlcjMyMTI0NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3212475?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mshaikh786",
        "html_url": "https://github.com/mshaikh786",
        "followers_url": "https://api.github.com/users/mshaikh786/followers",
        "following_url": "https://api.github.com/users/mshaikh786/following{/other_user}",
        "gists_url": "https://api.github.com/users/mshaikh786/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mshaikh786/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mshaikh786/subscriptions",
        "organizations_url": "https://api.github.com/users/mshaikh786/orgs",
        "repos_url": "https://api.github.com/users/mshaikh786/repos",
        "events_url": "https://api.github.com/users/mshaikh786/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mshaikh786/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2020-08-15T14:49:07Z",
    "updated_at": "2022-10-27T19:16:05Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "I am trying to run the following dask script stops and crashes with no errors. \r\n```\r\n#!/usr/bin/env python\r\n\r\nimport time\r\nimport random\r\nimport numpy as np\r\nimport os\r\nfrom dask.distributed import Client, progress\r\njobid=os.getenv('SLURM_JOBID')\r\nclient= Client(scheduler_file='scheduler_%s.json' %jobid,direct_to_workers=True)\r\nprint(client)\r\n\r\ndef sim(x):\r\n    return np.linalg.inv(x)\r\n\r\nN=1000000\r\nC=15000\r\nprint(\"Creating parameter set\")\r\ninput_params=np.random.randint(0, 100, size=(N,100, 100))\r\nprint(\"Starting computation\")\r\nfutures = client.map(sim,input_params,batch_size=C)\r\nprint(\"Futures length \",len(futures))\r\nclient.close()\r\n```\r\n\r\nSome information about the system and the SLURM jobscript to launch the above python script:\r\n```\r\n#!/bin/bash -l\r\n#SBATCH --ntasks=64\r\n#SBATCH --ntasks-per-node=32\r\n#SBATCH --cpus-per-task=1\r\n#SBATCH --partition=workq\r\n#SBATCH --time=02:00:00\r\n\r\nmodule load dask/2.22.0\r\nsrun -u --hint=nomultithread -n ${SLURM_NTASKS} --ntasks-per-node=${SLURM_NTASKS_PER_NODE} -c ${SLURM_CPUS_PER_TASK} dask-mpi --no-nanny --nthreads=${SLURM_CPUS_PER_TASK} --memory-limit='4GB' --local-directory=workers${SLURM_JOBID} --scheduler-file=scheduler_${SLURM_JOBID}.json --interface=ipogif0 --scheduler-port=6192 --dashboard-address=${node}:8787 &\r\n```\r\nThe jobscript was submitted on CrayXC40 (--interface=ipogif0 for Cray Aries interconnect) but a similar test was also run on a non-Cray machine, (with --interface=ib0). I am launching dask-mpi on multiple nodes to increase the total memory (each node has 128 GB). With --memory-limit=4GB, I can see that Dask Dashboard shows me a total of ~ 4GB * 64 workers (223GB) memory. \r\n\r\nVersion of software are as follows:\r\n\r\n\r\n- Dask version: 2.22.0\r\n- Python version: 3.8.0\r\n- Operating System: Cray Linux Environment 7.01 ( also tested on a different machine with CentOS 7.7)\r\n- Install method (conda, pip, source): pip install --no-cache-dir dask[complete] dask-mpi dask-jobqueue dask-ml\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/6519/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/6519/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}