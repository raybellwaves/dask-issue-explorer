{
    "url": "https://api.github.com/repos/dask/dask/issues/6910",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/6910/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/6910/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/6910/events",
    "html_url": "https://github.com/dask/dask/issues/6910",
    "id": 753791687,
    "node_id": "MDU6SXNzdWU3NTM3OTE2ODc=",
    "number": 6910,
    "title": "Dask changes decorated class module to \"types\" after calling compute making it impossible to pickle the object",
    "user": {
        "login": "gioxc88",
        "id": 41852601,
        "node_id": "MDQ6VXNlcjQxODUyNjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/41852601?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gioxc88",
        "html_url": "https://github.com/gioxc88",
        "followers_url": "https://api.github.com/users/gioxc88/followers",
        "following_url": "https://api.github.com/users/gioxc88/following{/other_user}",
        "gists_url": "https://api.github.com/users/gioxc88/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gioxc88/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gioxc88/subscriptions",
        "organizations_url": "https://api.github.com/users/gioxc88/orgs",
        "repos_url": "https://api.github.com/users/gioxc88/repos",
        "events_url": "https://api.github.com/users/gioxc88/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gioxc88/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2020-11-30T20:49:20Z",
    "updated_at": "2020-12-01T21:50:36Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "It was very difficult to find a minimal reproducible example because I was not sure what was causing the issue. \r\nBut now I am sure it is the class decorator because if I remove it the problem is gone.\r\nAs you can see in the code below I have a decorated class called `MyClass` and an instance on that class called `my_object`.\r\nFinally have a function called `my_function` which takes the object as input and returns the object itself.\r\nThen I call `compute` in a for loop and gather the results.\r\nWell, before calling compute `MyClass.__module__` is `__main__` but for who knows what mysterious reason after calling compute `MyClass.__module__` is `types` and I am not able to pickle the results unless I manually change the module back to `__main__`. \r\n\r\nThis is impacting some production code I have, therefore I would really appreciate even the smallest hint on what could be the cause of this.\r\nMany thanks\r\nGio \r\n\r\n```\r\nfrom dask import compute, delayed\r\nfrom dask.distributed import Client\r\n\r\nclient = Client()\r\n\r\n\r\ndef class_decorator(klass):\r\n    class Wrapper(klass):\r\n\r\n        def new(self):\r\n            return 1\r\n\r\n    Wrapper.__qualname__ = klass.__name__\r\n    Wrapper.__name__ = klass.__name__\r\n    return Wrapper\r\n\r\n\r\n@class_decorator\r\nclass MyClass:\r\n    def __init__(self):\r\n        pass\r\n\r\n\r\ndef my_function(obj):\r\n    return obj\r\n\r\n\r\nmy_object = MyClass()\r\nresults = []\r\n\r\nfor i in range(2):\r\n    results.append(delayed(my_function)(my_object))\r\n\r\nprint('before', MyClass.__module__)\r\nresults = compute(*results)\r\nprint('after', MyClass.__module__)\r\nprint('after', results[0].__module__)\r\n```",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/6910/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/6910/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}