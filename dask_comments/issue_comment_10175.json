[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1503857848",
        "html_url": "https://github.com/dask/dask/issues/10175#issuecomment-1503857848",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10175",
        "id": 1503857848,
        "node_id": "IC_kwDOAbcwm85Zowy4",
        "user": {
            "login": "jrbourbeau",
            "id": 11656932,
            "node_id": "MDQ6VXNlcjExNjU2OTMy",
            "avatar_url": "https://avatars.githubusercontent.com/u/11656932?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jrbourbeau",
            "html_url": "https://github.com/jrbourbeau",
            "followers_url": "https://api.github.com/users/jrbourbeau/followers",
            "following_url": "https://api.github.com/users/jrbourbeau/following{/other_user}",
            "gists_url": "https://api.github.com/users/jrbourbeau/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jrbourbeau/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jrbourbeau/subscriptions",
            "organizations_url": "https://api.github.com/users/jrbourbeau/orgs",
            "repos_url": "https://api.github.com/users/jrbourbeau/repos",
            "events_url": "https://api.github.com/users/jrbourbeau/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jrbourbeau/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-11T18:04:38Z",
        "updated_at": "2023-04-11T18:04:38Z",
        "author_association": "MEMBER",
        "body": "Thanks for the report @zbs. I'm not able to reproduce as I don't have a machine where I can install `cupy` -- cc @pentschev @quasiben who do. ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1503857848/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1503970932",
        "html_url": "https://github.com/dask/dask/issues/10175#issuecomment-1503970932",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10175",
        "id": 1503970932,
        "node_id": "IC_kwDOAbcwm85ZpMZ0",
        "user": {
            "login": "pentschev",
            "id": 4398246,
            "node_id": "MDQ6VXNlcjQzOTgyNDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4398246?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pentschev",
            "html_url": "https://github.com/pentschev",
            "followers_url": "https://api.github.com/users/pentschev/followers",
            "following_url": "https://api.github.com/users/pentschev/following{/other_user}",
            "gists_url": "https://api.github.com/users/pentschev/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pentschev/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pentschev/subscriptions",
            "organizations_url": "https://api.github.com/users/pentschev/orgs",
            "repos_url": "https://api.github.com/users/pentschev/repos",
            "events_url": "https://api.github.com/users/pentschev/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pentschev/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-11T19:20:07Z",
        "updated_at": "2023-04-11T19:20:07Z",
        "author_association": "MEMBER",
        "body": "Thanks for the report @zbs , and @jrbourbeau for the ping.\r\n\r\nDisabling that is currently not possible without removing CuPy from your environment. Would removing CuPy be an alternative for you? The problem is Dask must register CuPy arrays to be aware of them for operating on them (should that be required by the program). I suppose we could introduce a Dask config to explicitly disable that block, but the user would still be required to set such a configuration, other than that I don't immediately see a better way of handling the behavior reported.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1503970932/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1503979877",
        "html_url": "https://github.com/dask/dask/issues/10175#issuecomment-1503979877",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10175",
        "id": 1503979877,
        "node_id": "IC_kwDOAbcwm85ZpOll",
        "user": {
            "login": "quasiben",
            "id": 1403768,
            "node_id": "MDQ6VXNlcjE0MDM3Njg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1403768?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/quasiben",
            "html_url": "https://github.com/quasiben",
            "followers_url": "https://api.github.com/users/quasiben/followers",
            "following_url": "https://api.github.com/users/quasiben/following{/other_user}",
            "gists_url": "https://api.github.com/users/quasiben/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/quasiben/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/quasiben/subscriptions",
            "organizations_url": "https://api.github.com/users/quasiben/orgs",
            "repos_url": "https://api.github.com/users/quasiben/repos",
            "events_url": "https://api.github.com/users/quasiben/events{/privacy}",
            "received_events_url": "https://api.github.com/users/quasiben/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-11T19:28:39Z",
        "updated_at": "2023-04-11T19:28:39Z",
        "author_association": "MEMBER",
        "body": "I agree with @pentschev though I'm curious what version of CuPy you are using.  When I perform the same commands above I see something quite different (using cupy 11.6 / python 3.10)\r\n\r\n```bash\r\n(rapids-23.06-nightly) bzaitlen@dgx15:~$ files=$(strace -fTty python -c \"import cupy\" |& grep -v \"No such\" | grep open | grep -e pyc -e '.so' | cut -d' ' -f3)\r\n(rapids-23.06-nightly) bzaitlen@dgx15:~$ for file in $files; do file=$(echo $file | tr -d \"'\" | tr -d '\"' | tr -d ','); if ls -Lsh $file 2>/dev/null & [ -f $file ]; then ls -Lsh $file; fi; done | grep \"M \" | sort | uniq\r\n1.7M /lib/x86_64-linux-gnu/libm.so.6\r\n2.0M /lib/x86_64-linux-gnu/libc.so.6\r\n36M /datasets/bzaitlen/miniconda3/envs/rapids-23.06-nightly/lib/python3.10/site-packages/numpy/core/../../../../libcblas.so.3\r\n5.3M /datasets/bzaitlen/miniconda3/envs/rapids-23.06-nightly/lib/python3.10/site-packages/numpy/core/_multiarray_umath.cpython-310-x86_64-linux-gnu.so\r\n6.6M /datasets/bzaitlen/miniconda3/envs/rapids-23.06-nightly/lib/python3.10/site-packages/numpy/core/../../../.././libgfortran.so.5\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1503979877/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1509900762",
        "html_url": "https://github.com/dask/dask/issues/10175#issuecomment-1509900762",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10175",
        "id": 1509900762,
        "node_id": "IC_kwDOAbcwm85Z_0Ha",
        "user": {
            "login": "zbs",
            "id": 1444551,
            "node_id": "MDQ6VXNlcjE0NDQ1NTE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1444551?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/zbs",
            "html_url": "https://github.com/zbs",
            "followers_url": "https://api.github.com/users/zbs/followers",
            "following_url": "https://api.github.com/users/zbs/following{/other_user}",
            "gists_url": "https://api.github.com/users/zbs/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/zbs/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zbs/subscriptions",
            "organizations_url": "https://api.github.com/users/zbs/orgs",
            "repos_url": "https://api.github.com/users/zbs/repos",
            "events_url": "https://api.github.com/users/zbs/events{/privacy}",
            "received_events_url": "https://api.github.com/users/zbs/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-15T17:28:28Z",
        "updated_at": "2023-04-15T17:28:28Z",
        "author_association": "NONE",
        "body": "I am using\r\n```\r\n/tmp/tmpt76qy7aa'\r\n```\r\nI don't think removing cupy is an option for us. Some of our users use cupy, but before doing so they configure their LD_LIBRARY_PATH environment variables so the import works correctly.\r\n\r\nWould it be possible to supply an environment variable that controls per runtime whether cupy gets imported? I know it leaks implementation details, but it seems like the easiest solution.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1509900762/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1513157065",
        "html_url": "https://github.com/dask/dask/issues/10175#issuecomment-1513157065",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10175",
        "id": 1513157065,
        "node_id": "IC_kwDOAbcwm85aMPHJ",
        "user": {
            "login": "quasiben",
            "id": 1403768,
            "node_id": "MDQ6VXNlcjE0MDM3Njg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1403768?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/quasiben",
            "html_url": "https://github.com/quasiben",
            "followers_url": "https://api.github.com/users/quasiben/followers",
            "following_url": "https://api.github.com/users/quasiben/following{/other_user}",
            "gists_url": "https://api.github.com/users/quasiben/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/quasiben/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/quasiben/subscriptions",
            "organizations_url": "https://api.github.com/users/quasiben/orgs",
            "repos_url": "https://api.github.com/users/quasiben/repos",
            "events_url": "https://api.github.com/users/quasiben/events{/privacy}",
            "received_events_url": "https://api.github.com/users/quasiben/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-18T13:27:05Z",
        "updated_at": "2023-04-18T13:27:05Z",
        "author_association": "MEMBER",
        "body": "> /tmp/tmpt76qy7aa'\r\n\r\nThis does not look like a valid CuPy version ?\r\n\r\nHow are folks configuring LD_LIBRARY_PATH ?  That would explain why there are things like `/company/software/rhel8/gcc-10.2.0/lib64/libgomp.so` showing up.  \r\n\r\nIt's unlikely that we will implement an env var to control whether cupy get imported .  At the moment, it seems more like internal customizations are causing issues here.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1513157065/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1542373070",
        "html_url": "https://github.com/dask/dask/issues/10175#issuecomment-1542373070",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/10175",
        "id": 1542373070,
        "node_id": "IC_kwDOAbcwm85b7r7O",
        "user": {
            "login": "pentschev",
            "id": 4398246,
            "node_id": "MDQ6VXNlcjQzOTgyNDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4398246?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pentschev",
            "html_url": "https://github.com/pentschev",
            "followers_url": "https://api.github.com/users/pentschev/followers",
            "following_url": "https://api.github.com/users/pentschev/following{/other_user}",
            "gists_url": "https://api.github.com/users/pentschev/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pentschev/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pentschev/subscriptions",
            "organizations_url": "https://api.github.com/users/pentschev/orgs",
            "repos_url": "https://api.github.com/users/pentschev/repos",
            "events_url": "https://api.github.com/users/pentschev/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pentschev/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-10T15:04:17Z",
        "updated_at": "2023-05-10T15:04:17Z",
        "author_association": "MEMBER",
        "body": "https://github.com/cupy/cupy/pull/6908 is being planned for CuPy v13, that will make `import cupy` lazy-loading, which should prevent this memory spike.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1542373070/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]