[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/743237315",
        "html_url": "https://github.com/dask/dask/issues/6956#issuecomment-743237315",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6956",
        "id": 743237315,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc0MzIzNzMxNQ==",
        "user": {
            "login": "mrocklin",
            "id": 306380,
            "node_id": "MDQ6VXNlcjMwNjM4MA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mrocklin",
            "html_url": "https://github.com/mrocklin",
            "followers_url": "https://api.github.com/users/mrocklin/followers",
            "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
            "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
            "organizations_url": "https://api.github.com/users/mrocklin/orgs",
            "repos_url": "https://api.github.com/users/mrocklin/repos",
            "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mrocklin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-12-11T14:52:43Z",
        "updated_at": "2020-12-11T14:52:43Z",
        "author_association": "MEMBER",
        "body": "The right solution here is for Dask to submit everything to one worker, but\nthen when the other workers arrive to start load balancing.  Dask does this\nnormally, but there is an issue that with new types of tasks that it hasn't\nseen before it doesn't have an estimate of how long they will take, so it\nwaits until the first one is done.  This is being resolved, I think, in\nhttps://github.com/dask/distributed/pull/4213\n\nWould that solve your problem?\n\nOn Fri, Dec 11, 2020 at 4:17 AM ben10he <notifications@github.com> wrote:\n\n> By default, looks like dask would distribute tasks at the time when they\n> are submitted. If we have a task run time depends on input and some input\n> may cause the task run much longer than other, we may end up with all long\n> running tasks assigned to one worker. Here is an example to illustrate the\n> issue:\n>\n> import time\n> from distributed import Client, wait\n>\n>\n> def uneven_task(num):\n>     \"\"\"If num is odd number, it will take much longer to complete\"\"\"\n>     print(f\"Running task {num}\")\n>     if num % 2 != 0:\n>         time.sleep(num*100)\n>     print(f\"Task {num} has finished. Worker is free.\")\n>\n>\n> if __name__ == \"__main__\":\n>     client = Client(address=\"xx.xxx.xx.xx:8786\")\n>     futures = []\n>     for i in range(10):\n>         future = client.submit(uneven_task, i, priority=1)\n>         futures.append(future)\n>\n>     wait(futures)\n>\n> 2 workers started. 10 tasks submitted. Odd number input will lead to a\n> long task, but even number task will be quick. I can see all 5 short tasks\n> allocate to one worker and the other 5 long running tasks all allocate to\n> the other workers.\n> [image: image]\n> <https://user-images.githubusercontent.com/31155357/101902515-aeea4580-3baa-11eb-8f41-0a2463023fa0.png>\n>\n> Is there any way we can config dask only assign task when worker is free\n> instead of allocate them at the time when tasks are submitted?\n>\n> \u2014\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/dask/dask/issues/6956>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AACKZTF3W5D3L37QK7CLRJDSUIEUZANCNFSM4UWRT2EQ>\n> .\n>\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/743237315/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/743273601",
        "html_url": "https://github.com/dask/dask/issues/6956#issuecomment-743273601",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6956",
        "id": 743273601,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc0MzI3MzYwMQ==",
        "user": {
            "login": "ben10he",
            "id": 31155357,
            "node_id": "MDQ6VXNlcjMxMTU1MzU3",
            "avatar_url": "https://avatars.githubusercontent.com/u/31155357?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ben10he",
            "html_url": "https://github.com/ben10he",
            "followers_url": "https://api.github.com/users/ben10he/followers",
            "following_url": "https://api.github.com/users/ben10he/following{/other_user}",
            "gists_url": "https://api.github.com/users/ben10he/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ben10he/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ben10he/subscriptions",
            "organizations_url": "https://api.github.com/users/ben10he/orgs",
            "repos_url": "https://api.github.com/users/ben10he/repos",
            "events_url": "https://api.github.com/users/ben10he/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ben10he/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-12-11T15:52:50Z",
        "updated_at": "2020-12-11T15:52:50Z",
        "author_association": "NONE",
        "body": "Took a look at the PR in dask/distributed#4213. Does it mean the free worker will automatically pick up some of the long running tasks in the other worker in my example above?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/743273601/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/803397978",
        "html_url": "https://github.com/dask/dask/issues/6956#issuecomment-803397978",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6956",
        "id": 803397978,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgwMzM5Nzk3OA==",
        "user": {
            "login": "jrbourbeau",
            "id": 11656932,
            "node_id": "MDQ6VXNlcjExNjU2OTMy",
            "avatar_url": "https://avatars.githubusercontent.com/u/11656932?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jrbourbeau",
            "html_url": "https://github.com/jrbourbeau",
            "followers_url": "https://api.github.com/users/jrbourbeau/followers",
            "following_url": "https://api.github.com/users/jrbourbeau/following{/other_user}",
            "gists_url": "https://api.github.com/users/jrbourbeau/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jrbourbeau/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jrbourbeau/subscriptions",
            "organizations_url": "https://api.github.com/users/jrbourbeau/orgs",
            "repos_url": "https://api.github.com/users/jrbourbeau/repos",
            "events_url": "https://api.github.com/users/jrbourbeau/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jrbourbeau/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-20T16:20:50Z",
        "updated_at": "2021-03-20T16:20:50Z",
        "author_association": "MEMBER",
        "body": "Just checking in, @ben10he did the changes in https://github.com/dask/distributed/pull/4213 help with your use case? ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/803397978/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/808156634",
        "html_url": "https://github.com/dask/dask/issues/6956#issuecomment-808156634",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6956",
        "id": 808156634,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgwODE1NjYzNA==",
        "user": {
            "login": "ben10he",
            "id": 31155357,
            "node_id": "MDQ6VXNlcjMxMTU1MzU3",
            "avatar_url": "https://avatars.githubusercontent.com/u/31155357?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ben10he",
            "html_url": "https://github.com/ben10he",
            "followers_url": "https://api.github.com/users/ben10he/followers",
            "following_url": "https://api.github.com/users/ben10he/following{/other_user}",
            "gists_url": "https://api.github.com/users/ben10he/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ben10he/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ben10he/subscriptions",
            "organizations_url": "https://api.github.com/users/ben10he/orgs",
            "repos_url": "https://api.github.com/users/ben10he/repos",
            "events_url": "https://api.github.com/users/ben10he/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ben10he/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-26T11:52:41Z",
        "updated_at": "2021-03-26T11:52:41Z",
        "author_association": "NONE",
        "body": "Not sure if I understand this correctly. I am following this test: https://github.com/dask/distributed/blob/main/distributed/tests/test_steal.py#L815 and thought I would just need to set parameter allow_other_workers=True and give workers address will solve the issue. Here is my updated code:\r\n\r\n```\r\nimport time\r\nfrom distributed import Client, wait\r\n\r\n\r\ndef uneven_task(num):\r\n    \"\"\"If num is odd number, it will take much longer to complete\"\"\"\r\n    print(f\"Running task {num}\")\r\n    if num % 2 != 0:\r\n        time.sleep(num*100)\r\n    print(f\"Task {num} has finished. Worker is free.\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    client = Client(address=\"xx.xxx.xx.xx:8786\")\r\n    futures = []\r\n    for i in range(10):\r\n        future = client.submit(uneven_task, i, priority=1, allow_other_workers=True, workers=[\"worker a address\"])\r\n        futures.append(future)\r\n\r\n    wait(futures)\r\n```\r\n\r\nBut all tasks were run in the worker a. Basically, what I am looking for is something like a queue when I submit tasks to the scheduler, and scheduler will check if any free worker before distribute tasks in the queue. At the moment, as my example suggests, scheduler will distribute the tasks at the time when they are submitted to all workers. When we have 2 wrokers, 5 tasks distributed to each of them. However, the way I set up these tasks were trying to make some tasks run much longer than other. Then I end up with all long running tasks were distributed to one workers and all quick tasks were distributed to the other worker because these tasks were allocated at the time I submitted them.    ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/808156634/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/897191938",
        "html_url": "https://github.com/dask/dask/issues/6956#issuecomment-897191938",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6956",
        "id": 897191938,
        "node_id": "IC_kwDOAbcwm841ehAC",
        "user": {
            "login": "ncclementi",
            "id": 7526622,
            "node_id": "MDQ6VXNlcjc1MjY2MjI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7526622?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ncclementi",
            "html_url": "https://github.com/ncclementi",
            "followers_url": "https://api.github.com/users/ncclementi/followers",
            "following_url": "https://api.github.com/users/ncclementi/following{/other_user}",
            "gists_url": "https://api.github.com/users/ncclementi/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ncclementi/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ncclementi/subscriptions",
            "organizations_url": "https://api.github.com/users/ncclementi/orgs",
            "repos_url": "https://api.github.com/users/ncclementi/repos",
            "events_url": "https://api.github.com/users/ncclementi/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ncclementi/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-11T22:04:44Z",
        "updated_at": "2021-08-11T22:04:44Z",
        "author_association": "MEMBER",
        "body": "Checking in here, on the status of this issue./\r\n@jrbourbeau Would you mind shining some light on the previous comment/question?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/897191938/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]