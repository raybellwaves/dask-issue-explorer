{
    "url": "https://api.github.com/repos/dask/dask/issues/6314",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/6314/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/6314/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/6314/events",
    "html_url": "https://github.com/dask/dask/issues/6314",
    "id": 637104146,
    "node_id": "MDU6SXNzdWU2MzcxMDQxNDY=",
    "number": 6314,
    "title": "Large Dataframe shuffle operations",
    "user": {
        "login": "mrocklin",
        "id": 306380,
        "node_id": "MDQ6VXNlcjMwNjM4MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mrocklin",
        "html_url": "https://github.com/mrocklin",
        "followers_url": "https://api.github.com/users/mrocklin/followers",
        "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
        "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
        "organizations_url": "https://api.github.com/users/mrocklin/orgs",
        "repos_url": "https://api.github.com/users/mrocklin/repos",
        "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mrocklin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862289,
            "node_id": "MDU6TGFiZWwyNDI4NjIyODk=",
            "url": "https://api.github.com/repos/dask/dask/labels/dataframe",
            "name": "dataframe",
            "color": "fbca04",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2020-06-11T15:18:36Z",
    "updated_at": "2021-10-13T05:22:59Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "Some dataframe operations require something like a full sort of the data.  This can be expensive for a variety of reasons.  This limits the scalability of Dask Dataframe to very large datasets.  These operations include:\r\n\r\n1.  set_index\r\n2.  groupby-apply\r\n3.  join on a non-sorted column\r\n\r\nOur current approach is to split every input partition into several pieces, move those pieces around to their final destination, and then merge them into output partitions.  In an unsorted input dataset every input partition will have something to contribute to most output partitions, so this is an `n**2` operation.  As the number of partitions increases this an become debilitating due to scheduler overhead.  \r\n\r\nSo for example if we have 1000 partitions then this might create 1,000,000 tasks, which if overhead is something like 1ms per task (an overetimate) then this would add 1000s of overhead (about 15 minutes) regardless of how large our cluster is.  \r\n\r\n### Staging: Today's approach\r\n\r\nToday we avoid this by staging communication.  We split things up not into 1000 little chunks, but into 30, and we do this a couple of times.  This results in `n * log_n` tasks and `log_n` full communications.  In our example above we would incur something like 30,000 + 30,000 tasks, or about 10s of overhead, but we would have to move our dataset around twice (which if you're on slow network can be troublesome)\r\n\r\nWhat are some other approaches that we could take here?\r\n\r\nSee also\r\n--------\r\n-  A similar issue for Dask Array https://github.com/dask/dask/issues/3514\r\n-  A plan for distributed shuffling service https://github.com/dask/dask/issues/6164\r\n-  An approach to create tasks from tasks https://github.com/dask/distributed/pull/3879",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/6314/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/6314/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}