[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1406651881",
        "html_url": "https://github.com/dask/dask/issues/9882#issuecomment-1406651881",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9882",
        "id": 1406651881,
        "node_id": "IC_kwDOAbcwm85T183p",
        "user": {
            "login": "ncclementi",
            "id": 7526622,
            "node_id": "MDQ6VXNlcjc1MjY2MjI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7526622?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ncclementi",
            "html_url": "https://github.com/ncclementi",
            "followers_url": "https://api.github.com/users/ncclementi/followers",
            "following_url": "https://api.github.com/users/ncclementi/following{/other_user}",
            "gists_url": "https://api.github.com/users/ncclementi/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ncclementi/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ncclementi/subscriptions",
            "organizations_url": "https://api.github.com/users/ncclementi/orgs",
            "repos_url": "https://api.github.com/users/ncclementi/repos",
            "events_url": "https://api.github.com/users/ncclementi/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ncclementi/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-27T15:23:29Z",
        "updated_at": "2023-01-27T15:23:29Z",
        "author_association": "MEMBER",
        "body": "Nice catch, I can reproduce it.\r\nIt seems like this bug has been around for while. I checked on `dask=2022.8.1` before this PR https://github.com/dask/dask/pull/9504 (last PR that touched the code) and the bug was still there. \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1406651881/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1409371412",
        "html_url": "https://github.com/dask/dask/issues/9882#issuecomment-1409371412",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9882",
        "id": 1409371412,
        "node_id": "IC_kwDOAbcwm85UAU0U",
        "user": {
            "login": "jrbourbeau",
            "id": 11656932,
            "node_id": "MDQ6VXNlcjExNjU2OTMy",
            "avatar_url": "https://avatars.githubusercontent.com/u/11656932?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jrbourbeau",
            "html_url": "https://github.com/jrbourbeau",
            "followers_url": "https://api.github.com/users/jrbourbeau/followers",
            "following_url": "https://api.github.com/users/jrbourbeau/following{/other_user}",
            "gists_url": "https://api.github.com/users/jrbourbeau/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jrbourbeau/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jrbourbeau/subscriptions",
            "organizations_url": "https://api.github.com/users/jrbourbeau/orgs",
            "repos_url": "https://api.github.com/users/jrbourbeau/repos",
            "events_url": "https://api.github.com/users/jrbourbeau/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jrbourbeau/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-30T21:31:19Z",
        "updated_at": "2023-01-30T21:31:19Z",
        "author_association": "MEMBER",
        "body": "Thanks @j-bennet. Looking briefly at the existing `idxmax` implementation by guess is that we can't actually express it as a simple single aggregation and instead need to perform an `aca`-style reduction with separate chunk and aggregate functions. Similar in structure to what we're already doing in `cov`\r\n\r\nhttps://github.com/dask/dask/blob/db5b2178a79cacc1c882d60a82bf86e2e188eccb/dask/dataframe/groupby.py#L1892-L1937\r\n\r\nAlso, this probably impacts `idxmin` too",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1409371412/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1414213721",
        "html_url": "https://github.com/dask/dask/issues/9882#issuecomment-1414213721",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9882",
        "id": 1414213721,
        "node_id": "IC_kwDOAbcwm85USzBZ",
        "user": {
            "login": "j-bennet",
            "id": 637013,
            "node_id": "MDQ6VXNlcjYzNzAxMw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/637013?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/j-bennet",
            "html_url": "https://github.com/j-bennet",
            "followers_url": "https://api.github.com/users/j-bennet/followers",
            "following_url": "https://api.github.com/users/j-bennet/following{/other_user}",
            "gists_url": "https://api.github.com/users/j-bennet/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/j-bennet/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/j-bennet/subscriptions",
            "organizations_url": "https://api.github.com/users/j-bennet/orgs",
            "repos_url": "https://api.github.com/users/j-bennet/repos",
            "events_url": "https://api.github.com/users/j-bennet/events{/privacy}",
            "received_events_url": "https://api.github.com/users/j-bennet/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-02-02T18:55:32Z",
        "updated_at": "2023-02-02T19:27:39Z",
        "author_association": "MEMBER",
        "body": "The same thing also happens with `idxmin`, just requires a different data sample. Reproducible example that fails both idxmin and idxmax:\r\n\r\n```python\r\nimport pandas as pd\r\nimport dask.dataframe as dd\r\n\r\npdf = pd.DataFrame({\r\n    \"ints\": [4, 4, 5, 5, 5],\r\n    \"ints2\": [1, 2, 3, 4, 1],\r\n})\r\nddf = dd.from_pandas(pdf, npartitions=4)\r\nfor func in (\"idxmin\", \"idxmax\"):\r\n    print(getattr(pdf.groupby(\"ints\"), func)())\r\n    print()\r\n    print(getattr(ddf.groupby(\"ints\"), func)().sort_values(by=\"ints\").compute())\r\n    print(\"-\" * 20)\r\n```\r\n\r\nOutput:\r\n\r\n```\r\n      ints2\r\nints\r\n4         0\r\n5         4\r\n\r\n      ints2\r\nints\r\n4         0\r\n5         2\r\n--------------------\r\n      ints2\r\nints\r\n4         1\r\n5         3\r\n\r\n      ints2\r\nints\r\n4         1\r\n5         2\r\n--------------------\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1414213721/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1414291749",
        "html_url": "https://github.com/dask/dask/issues/9882#issuecomment-1414291749",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9882",
        "id": 1414291749,
        "node_id": "IC_kwDOAbcwm85UTGEl",
        "user": {
            "login": "jrbourbeau",
            "id": 11656932,
            "node_id": "MDQ6VXNlcjExNjU2OTMy",
            "avatar_url": "https://avatars.githubusercontent.com/u/11656932?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jrbourbeau",
            "html_url": "https://github.com/jrbourbeau",
            "followers_url": "https://api.github.com/users/jrbourbeau/followers",
            "following_url": "https://api.github.com/users/jrbourbeau/following{/other_user}",
            "gists_url": "https://api.github.com/users/jrbourbeau/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jrbourbeau/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jrbourbeau/subscriptions",
            "organizations_url": "https://api.github.com/users/jrbourbeau/orgs",
            "repos_url": "https://api.github.com/users/jrbourbeau/repos",
            "events_url": "https://api.github.com/users/jrbourbeau/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jrbourbeau/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-02-02T19:59:02Z",
        "updated_at": "2023-02-02T20:16:19Z",
        "author_association": "MEMBER",
        "body": "Gotcha, thanks for the nice example @j-bennet. @charlesbluca, I know you've been working on our groupby code recently, is this something you'd be interested in fixing? ",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1414291749/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1414331560",
        "html_url": "https://github.com/dask/dask/issues/9882#issuecomment-1414331560",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/9882",
        "id": 1414331560,
        "node_id": "IC_kwDOAbcwm85UTPyo",
        "user": {
            "login": "charlesbluca",
            "id": 20627856,
            "node_id": "MDQ6VXNlcjIwNjI3ODU2",
            "avatar_url": "https://avatars.githubusercontent.com/u/20627856?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/charlesbluca",
            "html_url": "https://github.com/charlesbluca",
            "followers_url": "https://api.github.com/users/charlesbluca/followers",
            "following_url": "https://api.github.com/users/charlesbluca/following{/other_user}",
            "gists_url": "https://api.github.com/users/charlesbluca/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/charlesbluca/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/charlesbluca/subscriptions",
            "organizations_url": "https://api.github.com/users/charlesbluca/orgs",
            "repos_url": "https://api.github.com/users/charlesbluca/repos",
            "events_url": "https://api.github.com/users/charlesbluca/events{/privacy}",
            "received_events_url": "https://api.github.com/users/charlesbluca/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-02-02T20:26:20Z",
        "updated_at": "2023-02-02T20:26:20Z",
        "author_association": "MEMBER",
        "body": "Sure, can look into this",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1414331560/reactions",
            "total_count": 1,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 1,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]