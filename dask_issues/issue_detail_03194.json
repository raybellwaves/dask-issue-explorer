{
    "url": "https://api.github.com/repos/dask/dask/issues/3194",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/3194/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/3194/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/3194/events",
    "html_url": "https://github.com/dask/dask/issues/3194",
    "id": 299433383,
    "node_id": "MDU6SXNzdWUyOTk0MzMzODM=",
    "number": 3194,
    "title": "Dask Arrays with unknown length fail on ravel",
    "user": {
        "login": "jakirkham",
        "id": 3019665,
        "node_id": "MDQ6VXNlcjMwMTk2NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jakirkham",
        "html_url": "https://github.com/jakirkham",
        "followers_url": "https://api.github.com/users/jakirkham/followers",
        "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
        "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
        "organizations_url": "https://api.github.com/users/jakirkham/orgs",
        "repos_url": "https://api.github.com/users/jakirkham/repos",
        "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jakirkham/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862305,
            "node_id": "MDU6TGFiZWwyNDI4NjIzMDU=",
            "url": "https://api.github.com/repos/dask/dask/labels/array",
            "name": "array",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 12,
    "created_at": "2018-02-22T17:06:30Z",
    "updated_at": "2021-03-31T09:07:00Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "Appears that it is not possible to use `ravel` with a Dask Array that has an unknown number of dimensions. Below is one case where a 2-D array with both dimensions as unknown length fails with `ravel`. Though there are a few other such cases like 1-D arrays with unknown length or even 2-D arrays with only one dimension of unknown length.\r\n\r\n<details>\r\n<summary>Example:</summary>\r\n\r\n```python\r\nIn [1]: import dask.array as da\r\n\r\nIn [2]: a = da.random.random((110, 120), chunks=(11, 12))\r\n\r\nIn [3]: b = a[a[:, 0] < 0.5, a[1] > 0.6]\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/array/core.py:2177: UserWarning: Increasing number of chunks by factor of 10\r\n  (nparts / max_parts))\r\n\r\nIn [4]: b\r\nOut[4]: dask.array<getitem_variadic, shape=(nan, nan), dtype=float64, chunksize=(nan, nan)>\r\n\r\nIn [5]: b.ravel()\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-5-999f388470b7> in <module>()\r\n----> 1 b.ravel()\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/array/core.py in ravel(self)\r\n   1382     def ravel(self):\r\n   1383         from .routines import ravel\r\n-> 1384         return ravel(self)\r\n   1385 \r\n   1386     flatten = ravel\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/array/routines.py in ravel(array)\r\n    832 @wraps(np.ravel)\r\n    833 def ravel(array):\r\n--> 834     return array.reshape((-1,))\r\n    835 \r\n    836 \r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/array/core.py in reshape(self, *shape)\r\n   1396         if len(shape) == 1 and not isinstance(shape[0], Number):\r\n   1397             shape = shape[0]\r\n-> 1398         return reshape(self, shape)\r\n   1399 \r\n   1400     def topk(self, k):\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/array/reshape.py in reshape(x, shape)\r\n    156         if len(known_sizes) - len(shape) > 1:\r\n    157             raise ValueError('can only specify one unknown dimension')\r\n--> 158         missing_size = sanitize_index(x.size / reduce(mul, known_sizes, 1))\r\n    159         shape = tuple(missing_size if s == -1 else s for s in shape)\r\n    160 \r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/array/slicing.py in sanitize_index(ind)\r\n     57                      _sanitize_index_element(ind.step))\r\n     58     elif isinstance(ind, Number):\r\n---> 59         return _sanitize_index_element(ind)\r\n     60     elif is_dask_collection(ind):\r\n     61         return ind\r\n\r\n/zopt/conda2/envs/test/lib/python3.6/site-packages/dask/array/slicing.py in _sanitize_index_element(ind)\r\n     19     \"\"\"Sanitize a one-element index.\"\"\"\r\n     20     if isinstance(ind, Number):\r\n---> 21         ind2 = int(ind)\r\n     22         if ind2 != ind:\r\n     23             raise IndexError(\"Bad index.  Must be integer-like: %s\" % ind)\r\n\r\nValueError: cannot convert float NaN to integer\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>Environment:</summary>\r\n\r\n```yaml\r\nname: test\r\nchannels:\r\n- conda-forge\r\n- defaults\r\ndependencies:\r\n- appnope=0.1.0=py36_0\r\n- blas=1.1=openblas\r\n- bokeh=0.12.13=py36_0\r\n- ca-certificates=2018.1.18=0\r\n- certifi=2018.1.18=py36_0\r\n- click=6.7=py_1\r\n- cloudpickle=0.5.2=py_0\r\n- dask=0.17.0=py_0\r\n- dask-core=0.17.0=py_0\r\n- decorator=4.1.2=py36_0\r\n- distributed=1.21.0=py36_0\r\n- heapdict=1.0.0=py36_0\r\n- ipython=6.2.1=py36_1\r\n- ipython_genutils=0.2.0=py36_0\r\n- jedi=0.11.1=py36_0\r\n- jinja2=2.10=py36_0\r\n- libgfortran=3.0.0=0\r\n- locket=0.2.0=py36_1\r\n- markupsafe=1.0=py36_0\r\n- msgpack-python=0.5.1=py36_0\r\n- ncurses=5.9=10\r\n- numpy=1.14.0=py36_blas_openblas_200\r\n- openblas=0.2.20=7\r\n- openssl=1.0.2n=0\r\n- pandas=0.22.0=py36_0\r\n- parso=0.1.1=py_0\r\n- partd=0.3.8=py36_0\r\n- pexpect=4.4.0=py36_0\r\n- pickleshare=0.7.4=py36_0\r\n- pip=9.0.1=py36_1\r\n- prompt_toolkit=1.0.15=py36_0\r\n- psutil=5.4.0=py36_0\r\n- ptyprocess=0.5.2=py36_0\r\n- pygments=2.2.0=py36_0\r\n- python=3.6.4=0\r\n- python-dateutil=2.6.1=py36_0\r\n- pytz=2018.3=py_0\r\n- pyyaml=3.12=py36_1\r\n- readline=7.0=0\r\n- setuptools=38.5.1=py36_0\r\n- simplegeneric=0.8.1=py36_0\r\n- six=1.11.0=py36_1\r\n- sortedcontainers=1.5.7=py36_0\r\n- sqlite=3.20.1=2\r\n- tblib=1.3.2=py36_0\r\n- tk=8.6.7=0\r\n- toolz=0.8.2=py_2\r\n- tornado=4.5.3=py36_0\r\n- traitlets=4.3.2=py36_0\r\n- wcwidth=0.1.7=py36_0\r\n- wheel=0.30.0=py36_2\r\n- xz=5.2.3=0\r\n- yaml=0.1.7=0\r\n- zict=0.1.3=py_0\r\n- zlib=1.2.11=0\r\n```\r\n\r\n</details>\r\n\r\n<br>\r\n\r\nxref: https://github.com/dask/dask/issues/1839",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/3194/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/3194/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}