{
    "url": "https://api.github.com/repos/dask/dask/issues/2648",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/2648/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/2648/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/2648/events",
    "html_url": "https://github.com/dask/dask/issues/2648",
    "id": 254684474,
    "node_id": "MDU6SXNzdWUyNTQ2ODQ0NzQ=",
    "number": 2648,
    "title": "Optimization of commutable operations",
    "user": {
        "login": "jakirkham",
        "id": 3019665,
        "node_id": "MDQ6VXNlcjMwMTk2NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3019665?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jakirkham",
        "html_url": "https://github.com/jakirkham",
        "followers_url": "https://api.github.com/users/jakirkham/followers",
        "following_url": "https://api.github.com/users/jakirkham/following{/other_user}",
        "gists_url": "https://api.github.com/users/jakirkham/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jakirkham/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jakirkham/subscriptions",
        "organizations_url": "https://api.github.com/users/jakirkham/orgs",
        "repos_url": "https://api.github.com/users/jakirkham/repos",
        "events_url": "https://api.github.com/users/jakirkham/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jakirkham/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 1342304743,
            "node_id": "MDU6TGFiZWwxMzQyMzA0NzQz",
            "url": "https://api.github.com/repos/dask/dask/labels/core",
            "name": "core",
            "color": "000000",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2017-09-01T16:01:28Z",
    "updated_at": "2021-10-12T00:49:36Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "Some (mathematical) operations are commutable (e.g. `+`). In cases where a commutable operator is found, it would be nice to \"sort\" the arguments in a standard way. Thus if the user writes something like `a + b` at one point and `b + a` at another, these will both be replaced by `a + b` thus computing it only once.\r\n\r\nJust for additional context, running the code below results in the comparison being computed twice. Namely `d_a[0] == d_a[1]` is the same as `d_a[1] == d_a[0]`. So it would be better to compute one of them, say `d_a[0] == d_a[1]`, and replace the other one, `d_a[1] == d_a[0]`, with the result of the first computation. By inspecting the graph from this result, we can see the comparison does get computed two different ways instead of taking advantage of commutation.\r\n\r\nCode:\r\n\r\n<details>\r\n\r\n```python\r\nIn [1]: import numpy as np\r\n\r\nIn [2]: import dask.array as da\r\n\r\nIn [3]: a = np.arange(6).reshape(2, 3)\r\n\r\nIn [4]: d_a = da.from_array(a, chunks=(1, 3))\r\n\r\nIn [5]: d_r = (d_a[0] == d_a[1]).astype(int) + (d_a[1] == d_a[0]).astype(int)\r\n\r\nIn [6]: d_r.visualize()\r\nOut[6]: <IPython.core.display.Image object>\r\n```\r\n\r\n</details>\r\n\r\n<br>\r\n\r\nGraph:\r\n\r\n<details>\r\n\r\n![mydask](https://user-images.githubusercontent.com/3019665/29977602-f3ffa1fa-8f0b-11e7-90aa-0d26bb14ae38.png)\r\n\r\n</details>",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/2648/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/2648/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}