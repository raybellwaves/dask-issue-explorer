{
    "url": "https://api.github.com/repos/dask/dask/issues/10432",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/10432/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/10432/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/10432/events",
    "html_url": "https://github.com/dask/dask/pull/10432",
    "id": 1826839824,
    "node_id": "PR_kwDOAbcwm85WrU1Y",
    "number": 10432,
    "title": "Prevent an error caused by concurrent use of a cache on multiple threads",
    "user": {
        "login": "andy-sweet",
        "id": 2608297,
        "node_id": "MDQ6VXNlcjI2MDgyOTc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2608297?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andy-sweet",
        "html_url": "https://github.com/andy-sweet",
        "followers_url": "https://api.github.com/users/andy-sweet/followers",
        "following_url": "https://api.github.com/users/andy-sweet/following{/other_user}",
        "gists_url": "https://api.github.com/users/andy-sweet/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/andy-sweet/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/andy-sweet/subscriptions",
        "organizations_url": "https://api.github.com/users/andy-sweet/orgs",
        "repos_url": "https://api.github.com/users/andy-sweet/repos",
        "events_url": "https://api.github.com/users/andy-sweet/events{/privacy}",
        "received_events_url": "https://api.github.com/users/andy-sweet/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2023-07-28T17:54:10Z",
    "updated_at": "2023-07-28T20:28:54Z",
    "closed_at": null,
    "author_association": "FIRST_TIME_CONTRIBUTOR",
    "active_lock_reason": null,
    "draft": true,
    "pull_request": {
        "url": "https://api.github.com/repos/dask/dask/pulls/10432",
        "html_url": "https://github.com/dask/dask/pull/10432",
        "diff_url": "https://github.com/dask/dask/pull/10432.diff",
        "patch_url": "https://github.com/dask/dask/pull/10432.patch",
        "merged_at": null
    },
    "body": "This modifies the cache's cost calculation so that determining the start time of the task never raises a `KeyError`. This can happen due to interleaving of the cache's `_posttask` method (which accesses `starttimes`) and the `_finish` method (which clears `starttimes`). Now, when the start time is not present, the initial duration (not including dependencies) is 0, so that the task has no extra power to evict other results from the cache, but can still be put in there when there's space. This also makes access of `starttimes` more consistent with `durations`.\r\n\r\nThis adds a parametrized test to reproduce that specific case as described in #10396. That test needs some specific concurrency control, so seems a little artificial, but it does reproduce a possible interleaving of task and callback execution. The control also means that it runs fast and should not be flaky.\r\n\r\nThis also adds implementation comments to explain the new code and some of the existing code.\r\n\r\nCloses #10396\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/10432/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/10432/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}