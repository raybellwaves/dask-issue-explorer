{
    "url": "https://api.github.com/repos/dask/dask/issues/7416",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/7416/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/7416/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/7416/events",
    "html_url": "https://github.com/dask/dask/issues/7416",
    "id": 835822983,
    "node_id": "MDU6SXNzdWU4MzU4MjI5ODM=",
    "number": 7416,
    "title": "compute_chunk_sizes could be more efficient for arrays with >1 dimension",
    "user": {
        "login": "alimanfoo",
        "id": 703554,
        "node_id": "MDQ6VXNlcjcwMzU1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/703554?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alimanfoo",
        "html_url": "https://github.com/alimanfoo",
        "followers_url": "https://api.github.com/users/alimanfoo/followers",
        "following_url": "https://api.github.com/users/alimanfoo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alimanfoo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alimanfoo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alimanfoo/subscriptions",
        "organizations_url": "https://api.github.com/users/alimanfoo/orgs",
        "repos_url": "https://api.github.com/users/alimanfoo/repos",
        "events_url": "https://api.github.com/users/alimanfoo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alimanfoo/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862305,
            "node_id": "MDU6TGFiZWwyNDI4NjIzMDU=",
            "url": "https://api.github.com/repos/dask/dask/labels/array",
            "name": "array",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2021-03-19T10:37:55Z",
    "updated_at": "2021-05-26T14:57:46Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "MCVE: https://colab.research.google.com/drive/1KNlfPiZECPcCestEh3gzpDrB9mvbbN2H?usp=sharing\r\n\r\nIn the above example, after indexing a 3d dask array with a 1d dask array via `da.compress()`, I would like to then compute the chunk sizes. Running `compute_chunk_sizes()` takes 44 s. Manually computing the chunk sizes requires ~200 ms. \r\n\r\nLooking at the source code for `compute_chunk_sizes()` I suspect the inefficiency comes because it is mapping a function across all blocks in the array, whereas it only needs to compute the chunk sizes along the margin of each dimension. I.e., a lot of work is being duplicated.\r\n\r\nBtw this is a usability issue that's come up in working with large genomic datasets. When there are multiple large n-d arrays that need to be indexed and have their chunk sizes computed, it is inconvenient to have to wait minutes for that operation to complete. This came up in the course of investigating https://github.com/pydata/xarray/issues/4663.\r\n\r\n**Environment**:\r\n\r\n- Dask version: 2021.3.0\r\n- Python version: 3.6\r\n- Operating System: Ubuntu\r\n- Install method (conda, pip, source): pip\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/7416/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/7416/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}