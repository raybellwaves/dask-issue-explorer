[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/777873590",
        "html_url": "https://github.com/dask/dask/issues/7206#issuecomment-777873590",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7206",
        "id": 777873590,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc3Nzg3MzU5MA==",
        "user": {
            "login": "TomAugspurger",
            "id": 1312546,
            "node_id": "MDQ6VXNlcjEzMTI1NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1312546?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomAugspurger",
            "html_url": "https://github.com/TomAugspurger",
            "followers_url": "https://api.github.com/users/TomAugspurger/followers",
            "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
            "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
            "repos_url": "https://api.github.com/users/TomAugspurger/repos",
            "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-02-11T23:54:11Z",
        "updated_at": "2021-02-11T23:54:11Z",
        "author_association": "MEMBER",
        "body": "Is the `.values` necessary to trigger the bug? There's another issue with `.values` causing issues with extension arrays.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/777873590/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/777892956",
        "html_url": "https://github.com/dask/dask/issues/7206#issuecomment-777892956",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7206",
        "id": 777892956,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc3Nzg5Mjk1Ng==",
        "user": {
            "login": "jborchma",
            "id": 20072839,
            "node_id": "MDQ6VXNlcjIwMDcyODM5",
            "avatar_url": "https://avatars.githubusercontent.com/u/20072839?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jborchma",
            "html_url": "https://github.com/jborchma",
            "followers_url": "https://api.github.com/users/jborchma/followers",
            "following_url": "https://api.github.com/users/jborchma/following{/other_user}",
            "gists_url": "https://api.github.com/users/jborchma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jborchma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jborchma/subscriptions",
            "organizations_url": "https://api.github.com/users/jborchma/orgs",
            "repos_url": "https://api.github.com/users/jborchma/repos",
            "events_url": "https://api.github.com/users/jborchma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jborchma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-02-12T00:44:40Z",
        "updated_at": "2021-02-12T00:44:40Z",
        "author_association": "CONTRIBUTOR",
        "body": "> Is the `.values` necessary to trigger the bug? There's another issue with `.values` causing issues with extension arrays.\r\n\r\nYeah, `dask_df[\"d\"].head(compute=False)` doesn't error.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/777892956/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/797221227",
        "html_url": "https://github.com/dask/dask/issues/7206#issuecomment-797221227",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7206",
        "id": 797221227,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc5NzIyMTIyNw==",
        "user": {
            "login": "gjoseph92",
            "id": 3309802,
            "node_id": "MDQ6VXNlcjMzMDk4MDI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3309802?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/gjoseph92",
            "html_url": "https://github.com/gjoseph92",
            "followers_url": "https://api.github.com/users/gjoseph92/followers",
            "following_url": "https://api.github.com/users/gjoseph92/following{/other_user}",
            "gists_url": "https://api.github.com/users/gjoseph92/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/gjoseph92/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/gjoseph92/subscriptions",
            "organizations_url": "https://api.github.com/users/gjoseph92/orgs",
            "repos_url": "https://api.github.com/users/gjoseph92/repos",
            "events_url": "https://api.github.com/users/gjoseph92/events{/privacy}",
            "received_events_url": "https://api.github.com/users/gjoseph92/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-12T04:09:16Z",
        "updated_at": "2021-03-12T04:09:16Z",
        "author_association": "MEMBER",
        "body": "So this doesn't have anything to do with `head()`; in fact, it's just about `.values` on a delayed Series where the dtype is a pandas extension dtype:\r\n\r\n```python\r\nimport dask.dataframe as dd\r\nimport pandas as pd\r\n\r\ns = pd.Series([\"foo\"], dtype=\"string\")\r\ndd.from_pandas(s, 1).values\r\n# same TypeError: Cannot interpret 'StringDtype' as a data type\r\n```\r\n\r\nWhen constructing the dask Array's `meta` object, we're currently assuming the underlying array type is a NumPy array, when in this case, it's actually going to be a pandas [StringArray](https://pandas.pydata.org/docs/reference/api/pandas.arrays.StringArray.html#pandas.arrays.StringArray). But unlike pandas, NumPy doesn't know how to handle a [StringDtype](https://pandas.pydata.org/docs/reference/api/pandas.StringDtype.html#pandas.StringDtype).\r\n\r\nI'll push up a potential fix for this in a moment.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/797221227/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/815945747",
        "html_url": "https://github.com/dask/dask/issues/7206#issuecomment-815945747",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7206",
        "id": 815945747,
        "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTk0NTc0Nw==",
        "user": {
            "login": "devyzr",
            "id": 14828684,
            "node_id": "MDQ6VXNlcjE0ODI4Njg0",
            "avatar_url": "https://avatars.githubusercontent.com/u/14828684?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/devyzr",
            "html_url": "https://github.com/devyzr",
            "followers_url": "https://api.github.com/users/devyzr/followers",
            "following_url": "https://api.github.com/users/devyzr/following{/other_user}",
            "gists_url": "https://api.github.com/users/devyzr/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/devyzr/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/devyzr/subscriptions",
            "organizations_url": "https://api.github.com/users/devyzr/orgs",
            "repos_url": "https://api.github.com/users/devyzr/repos",
            "events_url": "https://api.github.com/users/devyzr/events{/privacy}",
            "received_events_url": "https://api.github.com/users/devyzr/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-04-08T16:00:34Z",
        "updated_at": "2021-04-08T16:01:58Z",
        "author_association": "NONE",
        "body": "I'm getting a similar error when using a string column as an index for set_index on a DataFrame:\r\n\r\n`TypeError: Cannot interpret 'StringDtype' as a data type`\r\n\r\nMy code is basically the following:\r\n\r\n```\r\ndataframe = dd.read_csv(file_path, dtype={\"colName\": \"string\"}, blocksize=100e6)\r\ndataframe.set_index(\"colName\")\r\n```\r\n\r\nAnd my pip freeze file is the following:\r\n```\r\ncloudpickle==1.6.0\r\ndask==2021.4.0\r\ndocopt==0.6.2\r\nfsspec==0.9.0\r\nlocket==0.2.1\r\nnumpy==1.20.2\r\npandas==1.2.3\r\npartd==1.1.0\r\npycodestyle==2.7.0\r\npython-dateutil==2.8.1\r\npytz==2021.1\r\nPyYAML==5.4.1\r\nsix==1.15.0\r\ntoml==0.10.2\r\ntoolz==0.11.1\r\n```\r\n\r\nIs this a bug or expected behavior? Changing the index to an object type solved my issue.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/815945747/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/894795812",
        "html_url": "https://github.com/dask/dask/issues/7206#issuecomment-894795812",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7206",
        "id": 894795812,
        "node_id": "IC_kwDOAbcwm841VYAk",
        "user": {
            "login": "dhirschfeld",
            "id": 881019,
            "node_id": "MDQ6VXNlcjg4MTAxOQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/881019?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/dhirschfeld",
            "html_url": "https://github.com/dhirschfeld",
            "followers_url": "https://api.github.com/users/dhirschfeld/followers",
            "following_url": "https://api.github.com/users/dhirschfeld/following{/other_user}",
            "gists_url": "https://api.github.com/users/dhirschfeld/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/dhirschfeld/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/dhirschfeld/subscriptions",
            "organizations_url": "https://api.github.com/users/dhirschfeld/orgs",
            "repos_url": "https://api.github.com/users/dhirschfeld/repos",
            "events_url": "https://api.github.com/users/dhirschfeld/events{/privacy}",
            "received_events_url": "https://api.github.com/users/dhirschfeld/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-08T13:14:09Z",
        "updated_at": "2021-08-08T13:14:09Z",
        "author_association": "NONE",
        "body": "I have `pd.DataFrame` with string columns and am hitting this bug when simply trying to convert it to a dask dataframe:\r\n```python\r\n>>> df = dd.from_pandas(packed_data, npartitions=1).set_index('Reference')\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\IPython\\core\\magics\\execution.py\", line 1321, in time\r\n    exec(code, glob, local_ns)\r\n  File \"<timed exec>\", line 1, in <module>\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\dataframe\\core.py\", line 4249, in set_index\r\n    **kwargs,\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\dataframe\\shuffle.py\", line 163, in set_index\r\n    df, index2, repartition, npartitions, upsample, partition_size\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\dataframe\\shuffle.py\", line 35, in _calculate_divisions\r\n    divisions, sizes, mins, maxes = base.compute(divisions, sizes, mins, maxes)\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\base.py\", line 568, in compute\r\n    results = schedule(dsk, keys, **kwargs)\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\threaded.py\", line 87, in get\r\n    **kwargs\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\local.py\", line 514, in get_async\r\n    raise_exception(exc, tb)\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\local.py\", line 325, in reraise\r\n    raise exc\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\local.py\", line 223, in execute_task\r\n    result = _execute_task(task, data)\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\core.py\", line 121, in _execute_task\r\n    return func(*(_execute_task(a, cache) for a in args))\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\dask\\dataframe\\partitionquantiles.py\", line 416, in percentiles_summary\r\n    elif np.issubdtype(data.dtype, np.integer) and not is_cupy_type(data):\r\n  File \"C:\\Users\\dhirschf\\envs\\dev\\lib\\site-packages\\numpy\\core\\numerictypes.py\", line 419, in issubdtype\r\n    arg1 = dtype(arg1).type\r\nTypeError: Cannot interpret 'StringDtype' as a data type\r\n```\r\n\r\nIn my case it looks like it's casting to `numpy` with `.values` here:\r\nhttps://github.com/dask/dask/blob/758f4e4b97c985fc84fd0b9d5fa0abcf8fda760d/dask/dataframe/partitionquantiles.py#L411\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/894795812/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/1049922684",
        "html_url": "https://github.com/dask/dask/issues/7206#issuecomment-1049922684",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/7206",
        "id": 1049922684,
        "node_id": "IC_kwDOAbcwm84-lIx8",
        "user": {
            "login": "jorloplaz",
            "id": 12827365,
            "node_id": "MDQ6VXNlcjEyODI3MzY1",
            "avatar_url": "https://avatars.githubusercontent.com/u/12827365?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jorloplaz",
            "html_url": "https://github.com/jorloplaz",
            "followers_url": "https://api.github.com/users/jorloplaz/followers",
            "following_url": "https://api.github.com/users/jorloplaz/following{/other_user}",
            "gists_url": "https://api.github.com/users/jorloplaz/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jorloplaz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jorloplaz/subscriptions",
            "organizations_url": "https://api.github.com/users/jorloplaz/orgs",
            "repos_url": "https://api.github.com/users/jorloplaz/repos",
            "events_url": "https://api.github.com/users/jorloplaz/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jorloplaz/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-24T14:35:29Z",
        "updated_at": "2022-02-24T14:36:26Z",
        "author_association": "CONTRIBUTOR",
        "body": "This is similar to what we're discussing in #5720 . The problem appears to be in `partitionquantiles.py`, which thinks that numpy `dtypes` are being used, instead of extended Pandas ones. However, I'm not sure about how to proceed.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/1049922684/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]