{
    "url": "https://api.github.com/repos/dask/dask/issues/7999",
    "repository_url": "https://api.github.com/repos/dask/dask",
    "labels_url": "https://api.github.com/repos/dask/dask/issues/7999/labels{/name}",
    "comments_url": "https://api.github.com/repos/dask/dask/issues/7999/comments",
    "events_url": "https://api.github.com/repos/dask/dask/issues/7999/events",
    "html_url": "https://github.com/dask/dask/issues/7999",
    "id": 962042007,
    "node_id": "MDU6SXNzdWU5NjIwNDIwMDc=",
    "number": 7999,
    "title": "Possible bug when using dask.array.bincount and dask.array.apply_along_axis",
    "user": {
        "login": "miguelcarcamov",
        "id": 5432126,
        "node_id": "MDQ6VXNlcjU0MzIxMjY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5432126?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/miguelcarcamov",
        "html_url": "https://github.com/miguelcarcamov",
        "followers_url": "https://api.github.com/users/miguelcarcamov/followers",
        "following_url": "https://api.github.com/users/miguelcarcamov/following{/other_user}",
        "gists_url": "https://api.github.com/users/miguelcarcamov/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/miguelcarcamov/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/miguelcarcamov/subscriptions",
        "organizations_url": "https://api.github.com/users/miguelcarcamov/orgs",
        "repos_url": "https://api.github.com/users/miguelcarcamov/repos",
        "events_url": "https://api.github.com/users/miguelcarcamov/events{/privacy}",
        "received_events_url": "https://api.github.com/users/miguelcarcamov/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 242862305,
            "node_id": "MDU6TGFiZWwyNDI4NjIzMDU=",
            "url": "https://api.github.com/repos/dask/dask/labels/array",
            "name": "array",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2021-08-05T17:24:13Z",
    "updated_at": "2023-09-13T13:48:54Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "After hours of scratching my head, I believe that I have found a bug when using bincount and apply_along_axis. The error returned is a bit weird, since it tells me that my dask arrays does not have the chunks attribute, when they clearly have it.\r\nI will attach both the numpy behaviour and the dask behaviour with the same data.\r\n\r\nNumpy:\r\n```python\r\nimport numpy as np\r\nimport dask.array as da\r\n\r\ndef bincount(weight, x):\r\n    return np.bincount(x, weight)\r\n\r\nidx_np = np.random.randint(0, 1024, 1000)\r\nweight_np = np.random.random((1000,2))\r\nresult = np.apply_along_axis(bincount, 0, weight_np, idx_np)\r\narray([[0.55832968, 0.82649572],\r\n       [0.69563411, 0.51647341],\r\n       [0.        , 0.        ],\r\n       ...,\r\n       [0.        , 0.        ],\r\n       [0.67865151, 1.09591976],\r\n       [2.09644783, 2.00890233]])\r\n```\r\n\r\nDask:\r\n```python\r\nimport numpy as np\r\nimport dask.array as da\r\n\r\ndef bincount_dask(weight, x):\r\n    return da.bincount(x, weight).compute_chunk_sizes()\r\n\r\nidx = da.random.randint(0, 1024, 1000)\r\nweight = da.random.random((1000, 2))\r\n\r\nda.apply_along_axis(bincount_dask, 1, weight, idx) # I don't know why the axis are different on numpy and dask (?)\r\n\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-272-953d6609330b> in <module>\r\n----> 1 da.apply_along_axis(bincount_dask, 1, weight, idx)\r\n\r\n~/.local/lib/python3.9/site-packages/dask/array/routines.py in apply_along_axis(func1d, axis, arr, dtype, shape, *args, **kwargs)\r\n    454     if shape is None or dtype is None:\r\n    455         test_data = np.ones((1,), dtype=arr.dtype)\r\n--> 456         test_result = np.array(func1d(test_data, *args, **kwargs))\r\n    457         if shape is None:\r\n    458             shape = test_result.shape\r\n\r\n<ipython-input-271-38b0783af9ef> in bincount_dask(weight, x)\r\n      1 def bincount_dask(weight, x):\r\n----> 2     return da.bincount(x, weight).compute_chunk_sizes()\r\n\r\n~/.local/lib/python3.9/site-packages/dask/array/routines.py in bincount(x, weights, minlength, split_every)\r\n    670         raise ValueError(\"Input array must be one dimensional. Try using x.ravel()\")\r\n    671     if weights is not None:\r\n--> 672         if weights.chunks != x.chunks:\r\n    673             raise ValueError(\"Chunks of input array x and weights must match.\")\r\n    674 \r\n\r\nAttributeError: 'numpy.ndarray' object has no attribute 'chunks'\r\n\r\n\r\n```\r\n\r\n\r\n- Dask version: dask==2021.6.1\r\n- Python version: 3.9\r\n- Operating System: Manjaro Linux\r\n- Install method (conda, pip, source): pip3\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/dask/dask/issues/7999/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/dask/dask/issues/7999/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}