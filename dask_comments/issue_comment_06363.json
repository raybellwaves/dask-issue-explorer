[
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/652953412",
        "html_url": "https://github.com/dask/dask/issues/6363#issuecomment-652953412",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6363",
        "id": 652953412,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY1Mjk1MzQxMg==",
        "user": {
            "login": "TomAugspurger",
            "id": 1312546,
            "node_id": "MDQ6VXNlcjEzMTI1NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1312546?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomAugspurger",
            "html_url": "https://github.com/TomAugspurger",
            "followers_url": "https://api.github.com/users/TomAugspurger/followers",
            "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
            "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
            "repos_url": "https://api.github.com/users/TomAugspurger/repos",
            "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-07-02T11:33:58Z",
        "updated_at": "2020-07-02T11:33:58Z",
        "author_association": "MEMBER",
        "body": "A few things: \r\n\r\n1. Can you share a code snippet of how you're loading the data? Are you using `xr.open_zarr`?\r\n2. Are you using consolidated metadata? http://xarray.pydata.org/en/stable/io.html#consolidated-metadata\r\n3. https://github.com/dask/dask/issues/5918 has some general thoughts on slicing\r\n\r\nAnd finally, is this specific to loading from GCS, or can you recreate it locally?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/652953412/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/653488411",
        "html_url": "https://github.com/dask/dask/issues/6363#issuecomment-653488411",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6363",
        "id": 653488411,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzQ4ODQxMQ==",
        "user": {
            "login": "rafa-guedes",
            "id": 7799184,
            "node_id": "MDQ6VXNlcjc3OTkxODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7799184?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafa-guedes",
            "html_url": "https://github.com/rafa-guedes",
            "followers_url": "https://api.github.com/users/rafa-guedes/followers",
            "following_url": "https://api.github.com/users/rafa-guedes/following{/other_user}",
            "gists_url": "https://api.github.com/users/rafa-guedes/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/rafa-guedes/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/rafa-guedes/subscriptions",
            "organizations_url": "https://api.github.com/users/rafa-guedes/orgs",
            "repos_url": "https://api.github.com/users/rafa-guedes/repos",
            "events_url": "https://api.github.com/users/rafa-guedes/events{/privacy}",
            "received_events_url": "https://api.github.com/users/rafa-guedes/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-07-03T10:57:54Z",
        "updated_at": "2020-07-03T10:57:54Z",
        "author_association": "NONE",
        "body": "Thanks @TomAugspurger ,\r\n\r\n> Can you share a code snippet of how you're loading the data? Are you using xr.open_zarr?\r\n\r\n```\r\nimport xarray as xr\r\nfrom fsspec import get_mapper\r\ndset = xr.open_zarr(get_mapper(\"gs://store_with_many_objects.zarr/\"), consolidated=True)\r\n```\r\n\r\n> Are you using consolidated metadata? http://xarray.pydata.org/en/stable/io.html#consolidated-metadata\r\n\r\nYep\r\n\r\n> And finally, is this specific to loading from GCS, or can you recreate it locally?\r\n\r\nI can actually recreate it locally. I just copied the full dataset locally into a vm and loading metadata also takes a fair bit, around 10s or so for a few tries on this dataset.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/653488411/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/654338123",
        "html_url": "https://github.com/dask/dask/issues/6363#issuecomment-654338123",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6363",
        "id": 654338123,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY1NDMzODEyMw==",
        "user": {
            "login": "TomAugspurger",
            "id": 1312546,
            "node_id": "MDQ6VXNlcjEzMTI1NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1312546?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomAugspurger",
            "html_url": "https://github.com/TomAugspurger",
            "followers_url": "https://api.github.com/users/TomAugspurger/followers",
            "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
            "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
            "repos_url": "https://api.github.com/users/TomAugspurger/repos",
            "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-07-06T16:25:33Z",
        "updated_at": "2020-07-06T16:25:33Z",
        "author_association": "MEMBER",
        "body": "Thanks, are you able to add a reproducible example to the original post?\r\n\r\nThe next step is probably to look into what route to take: micro-optimizations to `slices_from_chunks`, or larger changes to the structure. Do you have a sense for which is more likely to be better?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/654338123/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/741265022",
        "html_url": "https://github.com/dask/dask/issues/6363#issuecomment-741265022",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6363",
        "id": 741265022,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTI2NTAyMg==",
        "user": {
            "login": "rafa-guedes",
            "id": 7799184,
            "node_id": "MDQ6VXNlcjc3OTkxODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7799184?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafa-guedes",
            "html_url": "https://github.com/rafa-guedes",
            "followers_url": "https://api.github.com/users/rafa-guedes/followers",
            "following_url": "https://api.github.com/users/rafa-guedes/following{/other_user}",
            "gists_url": "https://api.github.com/users/rafa-guedes/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/rafa-guedes/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/rafa-guedes/subscriptions",
            "organizations_url": "https://api.github.com/users/rafa-guedes/orgs",
            "repos_url": "https://api.github.com/users/rafa-guedes/repos",
            "events_url": "https://api.github.com/users/rafa-guedes/events{/privacy}",
            "received_events_url": "https://api.github.com/users/rafa-guedes/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-12-08T23:56:01Z",
        "updated_at": "2020-12-09T05:30:13Z",
        "author_association": "NONE",
        "body": "@TomAugspurger sorry for taking ages to respond. I wrote some code [in this notebook](https://github.com/rafa-guedes/notebooks/blob/master/zarr_metadata_scaling.ipynb) to demonstrate this behaviour. In this example the zarr archives are small and metadata reading is fast but it it does show how it scales with the number of chunk objects for each variable in the dataset.\r\n\r\nMost of the time seems to be spent within `slices_from_chunks` function (mostly in the list comprehension) which is called once for each of the 8 variables in these test datasets. I'm not sure if these calls can be optimised, or if there is a way to bypass those calls altogether - I don't know the code very well but I would hope the information to build the metadata would be defined in the consolidated zarr metadata file and the data variables chunks would not need to be accessed. I'm also not sure if this issue is pertinent to dask, zarr or xarray.",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/741265022/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/753549743",
        "html_url": "https://github.com/dask/dask/issues/6363#issuecomment-753549743",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6363",
        "id": 753549743,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzU0OTc0Mw==",
        "user": {
            "login": "TomAugspurger",
            "id": 1312546,
            "node_id": "MDQ6VXNlcjEzMTI1NDY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1312546?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomAugspurger",
            "html_url": "https://github.com/TomAugspurger",
            "followers_url": "https://api.github.com/users/TomAugspurger/followers",
            "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
            "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
            "repos_url": "https://api.github.com/users/TomAugspurger/repos",
            "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-03T00:43:44Z",
        "updated_at": "2021-01-03T00:43:44Z",
        "author_association": "MEMBER",
        "body": "Does this zarr dataset have consolidated metadata?",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/753549743/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/dask/dask/issues/comments/753578983",
        "html_url": "https://github.com/dask/dask/issues/6363#issuecomment-753578983",
        "issue_url": "https://api.github.com/repos/dask/dask/issues/6363",
        "id": 753578983,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzU3ODk4Mw==",
        "user": {
            "login": "rafa-guedes",
            "id": 7799184,
            "node_id": "MDQ6VXNlcjc3OTkxODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7799184?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafa-guedes",
            "html_url": "https://github.com/rafa-guedes",
            "followers_url": "https://api.github.com/users/rafa-guedes/followers",
            "following_url": "https://api.github.com/users/rafa-guedes/following{/other_user}",
            "gists_url": "https://api.github.com/users/rafa-guedes/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/rafa-guedes/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/rafa-guedes/subscriptions",
            "organizations_url": "https://api.github.com/users/rafa-guedes/orgs",
            "repos_url": "https://api.github.com/users/rafa-guedes/repos",
            "events_url": "https://api.github.com/users/rafa-guedes/events{/privacy}",
            "received_events_url": "https://api.github.com/users/rafa-guedes/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-03T07:17:48Z",
        "updated_at": "2021-01-03T07:17:48Z",
        "author_association": "NONE",
        "body": "Yep",
        "reactions": {
            "url": "https://api.github.com/repos/dask/dask/issues/comments/753578983/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]